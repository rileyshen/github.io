<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Flash Sale on Website of Riley</title>
    <link>https://rileyshen.github.io/tags/flash-sale/</link>
    <description>Recent content in Flash Sale on Website of Riley</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <lastBuildDate>Tue, 01 Mar 2022 15:56:39 +0800</lastBuildDate><atom:link href="https://rileyshen.github.io/tags/flash-sale/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>learning System design as a landscape architect 2</title>
      <link>https://rileyshen.github.io/post/sys2/</link>
      <pubDate>Tue, 01 Mar 2022 15:56:39 +0800</pubDate>
      
      <guid>https://rileyshen.github.io/post/sys2/</guid>
      
        <description>&lt;p&gt;Rethink system design in a much fun way, as a former urban planner/landscape planner. Take Flash Sale as example&lt;/p&gt;
&lt;!-- more --&gt;
&lt;!-- TOC --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#whats-is-the-scenario-planning-of-this-project&#34; &gt;what&amp;amp;rsquo;s is the &amp;lt;strong&amp;gt;scenario&amp;lt;/strong&amp;gt; planning of this project&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#service&#34; &gt;Service&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#select-database-for-each-service&#34; &gt;select database for each service&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#design-schema&#34; &gt;design schema&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#data-flow&#34; &gt;data flow&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#limited-time-offer&#34; &gt;Limited Time Offer&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#deduct-a-quantity-from-a-database&#34; &gt;deduct a quantity from a database&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#transaction-database-and-lock-slow&#34; &gt;transaction database and lock slow&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#update-lock-the-row-recommend&#34; &gt;UPDATE lock the row recommend&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#over-sale-problem&#34; &gt;over sale problem&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#lua-check-and-set&#34; &gt;Lua: check-and-set&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#message-queue-for-the-peak-clipping&#34; &gt;Message Queue for the Peak Clipping&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#deduct-quantity-timing&#34; &gt;deduct quantity timing&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#limit-orders-per-customer&#34; &gt;Limit Orders Per Customer&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#redis-data-verification&#34; &gt;Redis data verification&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#data-consistency-for-payments-and-destocking&#34; &gt;Data consistency for payments and destocking&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#scale&#34; &gt;scale&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#prevent-overload-of-product-pages&#34; &gt;Prevent overload of product pages&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#front-end-static-rescouces-cdn&#34; &gt;Front-end Static Rescouces CDN&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#front-end-current-limiting&#34; &gt;Front-end current-limiting&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#flash-sale-server-crash&#34; &gt;flash sale server crash&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#fuse-or-circuit-breaker&#34; &gt;Fuse or Circuit-breaker&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#prevent-malicious-requests-or-crawler-requests&#34; &gt;Prevent malicious requests or crawler requests&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#verification-code-mechanism&#34; &gt;Verification Code Mechanism&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#ratelimit-mechanism&#34; &gt;Ratelimit Mechanism&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#blacklist-mechanism&#34; &gt;Blacklist Mechanism&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- /TOC --&gt;
&lt;p&gt;Flash Sale &amp;ndash;&lt;/p&gt;
&lt;h2 id=&#34;1-whats-is-the-scenario-planning-of-this-project&#34;&gt;1. what&amp;rsquo;s is the &lt;strong&gt;scenario&lt;/strong&gt; planning of this project&lt;/h2&gt;
&lt;p&gt;&lt;a id=&#34;markdown-what&#39;s-is-the-**scenario**-planning-of-this-project&#34; name=&#34;what&#39;s-is-the-**scenario**-planning-of-this-project&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;QPS&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;1000 people were coming to the site per second, but there will be 100 k people when an attractive limited-time offer include a big discount.&lt;/p&gt;
&lt;p&gt;QPS then increased by 100&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;Analyzing flash sale Problems&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;Large flow and high concurrency&lt;/li&gt;
&lt;li&gt;Over sale&lt;/li&gt;
&lt;li&gt;Malicious ticked grab&lt;/li&gt;
&lt;li&gt;fixed schedule&lt;/li&gt;
&lt;li&gt;Purchase limit&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;Demand disassembly
shops:&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;register for sales on&lt;/li&gt;
&lt;li&gt;set up detail information&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;clients:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;flash sale page&lt;/li&gt;
&lt;li&gt;buy&lt;/li&gt;
&lt;li&gt;order&lt;/li&gt;
&lt;li&gt;pay&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;21-service&#34;&gt;2.1 Service&lt;/h2&gt;
&lt;p&gt;&lt;a id=&#34;markdown-service&#34; name=&#34;service&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Gateway&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;limited time pomotion Service + database&lt;/li&gt;
&lt;li&gt;Commodity info &amp;amp; Stock service + database&lt;/li&gt;
&lt;li&gt;Order Service + database&lt;/li&gt;
&lt;li&gt;Payment Service + database&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;22-select-database-for-each-service&#34;&gt;2.2 select database for each service&lt;/h2&gt;
&lt;p&gt;&lt;a id=&#34;markdown-select-database-for-each-service&#34; name=&#34;select-database-for-each-service&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;23-design-schema&#34;&gt;2.3 design schema&lt;/h2&gt;
&lt;p&gt;&lt;a id=&#34;markdown-design-schema&#34; name=&#34;design-schema&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;commodity_info&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;n&#34;&gt;commodity_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;desc&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;price&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;iphone&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;xxxxx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5999&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;stock_info&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;n&#34;&gt;stock_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;commodity_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;event_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stock&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;               &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;300&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;               &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;flashSale_info&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;n&#34;&gt;flashSale_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flashSale_name&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;commodity_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;price&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;number&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;xxxx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;               &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;189&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4000&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;order_info&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;n&#34;&gt;order_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flashSale_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;commodity_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;paid&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;              &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;189&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;jack&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;Indexing can dramatically increase query speed&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;24-data-flow&#34;&gt;2.4 data flow&lt;/h2&gt;
&lt;p&gt;&lt;a id=&#34;markdown-data-flow&#34; name=&#34;data-flow&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;store&lt;/code&gt; &amp;ndash;select &amp;ndash;&amp;gt; &lt;code&gt;commodity_info&lt;/code&gt;
|&amp;mdash;-insert &amp;ndash;&amp;gt; &lt;code&gt;stock_info &lt;/code&gt;
|&amp;ndash;select &amp;ndash;&amp;gt; &lt;code&gt;flashSale_info &lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;user&lt;/code&gt; &amp;ndash;select &amp;ndash;&amp;gt; &lt;code&gt;flashSale_info&lt;/code&gt;&amp;ndash;&amp;gt; &lt;code&gt;commodity_info&lt;/code&gt;&amp;ndash;&amp;gt; &lt;code&gt;stock_info&lt;/code&gt;
|&amp;mdash;-insert &amp;ndash;&amp;gt; &lt;code&gt;order_info&lt;/code&gt;
|&amp;ndash;update &amp;ndash;&amp;gt; &lt;code&gt;stock_info&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;25-limited-time-offer&#34;&gt;2.5 Limited Time Offer&lt;/h2&gt;
&lt;p&gt;&lt;a id=&#34;markdown-limited-time-offer&#34; name=&#34;limited-time-offer&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;deduct-a-quantity-from-a-database&#34;&gt;deduct a quantity from a database&lt;/h3&gt;
&lt;p&gt;&lt;a id=&#34;markdown-deduct-a-quantity-from-a-database&#34; name=&#34;deduct-a-quantity-from-a-database&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stock&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stock_info&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;commodity_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flashSale_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;UPDATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stock_info&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stock&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stock&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;commodity_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flashSale_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;solve oversale problem&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;transaction-database-and-lock-slow&#34;&gt;transaction database and lock (slow)&lt;/h4&gt;
&lt;p&gt;&lt;a id=&#34;markdown-transaction-database-and-lock-slow&#34; name=&#34;transaction-database-and-lock-slow&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;ol&gt;
&lt;li&gt;Start Transcation&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;add lock&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stock&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stock_info&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;commodity_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flashSale_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FOR&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;UPDATE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;deducted&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;UPDATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stock_info&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stock&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stock&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;commodity_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flashSale_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;commit&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;update-lock-the-row-recommend&#34;&gt;UPDATE lock the row (recommend)&lt;/h4&gt;
&lt;p&gt;&lt;a id=&#34;markdown-update-lock-the-row-recommend&#34; name=&#34;update-lock-the-row-recommend&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;ol&gt;
&lt;li&gt;add lock&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stock&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stock_info&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;commodity_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flashSale_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;deducted&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;k&#34;&gt;UPDATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stock_info&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;`&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stock&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stock&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;commodity_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flashSale_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stock&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;how about too many concurrent connections cause mysql crash&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;On average, a mysql web server can handle 1000 requests per second
but a single point of Redis can support 100,000 QPS. Consider loading stock information into Redis. update quantity directly through Redis&lt;/p&gt;
&lt;p&gt;before the event begin,&lt;/p&gt;
&lt;p&gt;&lt;code&gt;store&lt;/code&gt; &amp;ndash;&amp;gt; read from mysql &lt;code&gt;flashSale_info&lt;/code&gt;&amp;ndash;&amp;gt;`add in Redis&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;SET flashSale:30:commodity:11:stock 10&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;SET KEY&lt;/strong&gt;(flashSale:30:commodity:11:stock) &lt;strong&gt;VALUE&lt;/strong&gt; (10)&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;deduct quantity through Redis&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;data flow:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;user&lt;/code&gt; &amp;ndash;&amp;gt; read from redis &amp;ndash;&amp;gt; stock &amp;gt; 0 &amp;ndash; NO &amp;ndash; &amp;gt; the end of event&lt;/p&gt;
&lt;p&gt;&lt;code&gt;user&lt;/code&gt; &amp;ndash;&amp;gt; read from redis &amp;ndash;&amp;gt; stock &amp;gt; 0 &amp;ndash; YES &amp;ndash; &amp;gt; stock - 1 (redis) &amp;ndash;&amp;gt; lock the quentity, create order &amp;ndash;&amp;gt; pay &amp;ndash;&amp;gt; stock -1&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;GET flashSale:30:commodity:11:stock&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;DECR flashSale:30:commodity:11:stock&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Most requests are blocked by Redis.&lt;/p&gt;
&lt;p&gt;For example, if there are only 100 iPhones, then The volume of requests to MySQL is theoretically 100.&lt;/p&gt;
&lt;h4 id=&#34;over-sale-problem&#34;&gt;over sale problem&lt;/h4&gt;
&lt;p&gt;&lt;a id=&#34;markdown-over-sale-problem&#34; name=&#34;over-sale-problem&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h5 id=&#34;lua-check-and-set&#34;&gt;Lua: check-and-set&lt;/h5&gt;
&lt;p&gt;&lt;a id=&#34;markdown-lua%3A-check-and-set&#34; name=&#34;lua%3A-check-and-set&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;the limited time traffic is still too much for mysql, sell 100000&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;h5 id=&#34;message-queue-for-the-peak-clipping&#34;&gt;Message Queue for the Peak Clipping&lt;/h5&gt;
&lt;p&gt;&lt;a id=&#34;markdown-message-queue-for-the-peak-clipping&#34; name=&#34;message-queue-for-the-peak-clipping&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;deduct-quantity-timing&#34;&gt;deduct quantity timing&lt;/h3&gt;
&lt;p&gt;&lt;a id=&#34;markdown-deduct-quantity-timing&#34; name=&#34;deduct-quantity-timing&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Lock the stock after placing the order, and reduce the quantity after the payment is successful&lt;/p&gt;
&lt;h3 id=&#34;limit-orders-per-customer&#34;&gt;Limit Orders Per Customer&lt;/h3&gt;
&lt;p&gt;&lt;a id=&#34;markdown-limit-orders-per-customer&#34; name=&#34;limit-orders-per-customer&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&#34;redis-data-verification&#34;&gt;Redis data verification&lt;/h4&gt;
&lt;p&gt;&lt;a id=&#34;markdown-redis-data-verification&#34; name=&#34;redis-data-verification&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;user&lt;/code&gt; &amp;mdash;-&amp;gt; &lt;code&gt;check user id in Redis set or not&lt;/code&gt;&amp;mdash;-YES&amp;ndash;&amp;gt; &lt;code&gt;fail to buy&lt;/code&gt;
.                                               |
.                                               |- &amp;ndash;&amp;gt; &lt;code&gt;deduct quantity&lt;/code&gt;&amp;ndash;&amp;gt; &lt;code&gt;add user id in Redis set&lt;/code&gt;
.                                                               |&amp;mdash;-&amp;gt; &lt;code&gt;order, pay&lt;/code&gt;
.                                                                           |&amp;ndash;&amp;gt; success? 
.                                                                                   |-NO-&amp;gt; delete user id in Redis set&lt;/p&gt;
&lt;h3 id=&#34;data-consistency-for-payments-and-destocking&#34;&gt;Data consistency for payments and destocking&lt;/h3&gt;
&lt;p&gt;&lt;a id=&#34;markdown-data-consistency-for-payments-and-destocking&#34; name=&#34;data-consistency-for-payments-and-destocking&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Distributed transaction&lt;/p&gt;
&lt;h3 id=&#34;scale&#34;&gt;scale&lt;/h3&gt;
&lt;p&gt;&lt;a id=&#34;markdown-scale&#34; name=&#34;scale&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&#34;prevent-overload-of-product-pages&#34;&gt;Prevent overload of product pages&lt;/h4&gt;
&lt;p&gt;&lt;a id=&#34;markdown-prevent-overload-of-product-pages&#34; name=&#34;prevent-overload-of-product-pages&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h5 id=&#34;front-end-static-rescouces-cdn&#34;&gt;Front-end Static Rescouces CDN&lt;/h5&gt;
&lt;p&gt;&lt;a id=&#34;markdown-front-end-static-rescouces-cdn&#34; name=&#34;front-end-static-rescouces-cdn&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h5 id=&#34;front-end-current-limiting&#34;&gt;Front-end current-limiting&lt;/h5&gt;
&lt;p&gt;&lt;a id=&#34;markdown-front-end-current-limiting&#34; name=&#34;front-end-current-limiting&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&#34;flash-sale-server-crash&#34;&gt;flash sale server crash&lt;/h4&gt;
&lt;p&gt;&lt;a id=&#34;markdown-flash-sale-server-crash&#34; name=&#34;flash-sale-server-crash&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h5 id=&#34;fuse-or-circuit-breaker&#34;&gt;Fuse or Circuit-breaker&lt;/h5&gt;
&lt;p&gt;&lt;a id=&#34;markdown-fuse-or-circuit-breaker&#34; name=&#34;fuse-or-circuit-breaker&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&#34;prevent-malicious-requests-or-crawler-requests&#34;&gt;Prevent malicious requests or crawler requests&lt;/h4&gt;
&lt;p&gt;&lt;a id=&#34;markdown-prevent-malicious-requests-or-crawler-requests&#34; name=&#34;prevent-malicious-requests-or-crawler-requests&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h5 id=&#34;verification-code-mechanism&#34;&gt;Verification Code Mechanism&lt;/h5&gt;
&lt;p&gt;&lt;a id=&#34;markdown-verification-code-mechanism&#34; name=&#34;verification-code-mechanism&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h5 id=&#34;ratelimit-mechanism&#34;&gt;Ratelimit Mechanism&lt;/h5&gt;
&lt;p&gt;&lt;a id=&#34;markdown-ratelimit-mechanism&#34; name=&#34;ratelimit-mechanism&#34;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h5 id=&#34;blacklist-mechanism&#34;&gt;Blacklist Mechanism&lt;/h5&gt;
&lt;p&gt;&lt;a id=&#34;markdown-blacklist-mechanism&#34; name=&#34;blacklist-mechanism&#34;&gt;&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
  </channel>
</rss>