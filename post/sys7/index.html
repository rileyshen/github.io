<!DOCTYPE html>
<html  dir="ltr" lang="en" data-theme=""><head>
    <title> Riley Shen | learning System design as a landscape architect 7 </title>

    
    <meta charset="utf-8"><meta name="generator" content="Hugo 0.83.1" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <meta name="description"
        content="
Riley likes to push her limits 
and always keep learning new things. 
She shares her weekly learnings 
because &#34;if you can&#39;t explain it simply,
it means you didn&#39;t understand it well enough&#34;.
">
    <meta name="google-site-verification" content="Nac1UrFTdr1E1F48JLe7XQhIbKn2_WtF4VnJI8KOtew" />
    

    
    
    
    <link rel="stylesheet" href="/css/main.min.a7c9793b97840076bef76d2743ee1c90b13bd21c18674076a0cccd5dd54c723b.css" integrity="sha256-p8l5O5eEAHa&#43;920nQ&#43;4ckLE70hwYZ0B2oMzNXdVMcjs="
        crossorigin="anonymous" type="text/css">
    
    
    <link rel="stylesheet" href="/css/markupHighlight.min.f798cbda9aaa38f89eb38be6414bd082cfd71a6780375cbf67b6d2fb2b96491e.css"
        integrity="sha256-95jL2pqqOPies4vmQUvQgs/XGmeAN1y/Z7bS&#43;yuWSR4=" crossorigin="anonymous" type="text/css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
        integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA=="
        crossorigin="anonymous" />

    
    <link rel="shortcut icon" href="/favicons/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">

    <link rel="canonical" href="/post/sys7/">

    <link rel="preconnect" href="https://fonts.gstatic.com">



    
    
    
    
    <script type="text/javascript" src="/js/anatole-header.min.0c05c0a90d28c968a1cad4fb31abd0b8e1264e788ccefed022ae1d3b6f627514.js"
        integrity="sha256-DAXAqQ0oyWihytT7MavQuOEmTniMzv7QIq4dO29idRQ=" crossorigin="anonymous"></script>


    
    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://rileyshen.github.io/images/site-feature-image.png"/>

<meta name="twitter:title" content="learning System design as a landscape architect 7"/>
<meta name="twitter:description" content="Rethink system design in a much fun way, as a former urban planner/landscape planner."/>


    
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,300;0,400;0,500;0,600;0,700;1,500;1,600;1,700&display=swap"
        rel="stylesheet">

</head><body><div class="sidebar animated fadeInDown ">
    <div class="logo-title">
        <div class="title">
            <img src="/images/profileS.jpg" alt="profile picture">
            <h3 title=""><a href="/">I&#39;m Riley Shen</a></h3>
            <div class="description">
                <p><br>Riley likes to push her limits <br>and always keep learning new things. <br>She shares her weekly learnings <br>because "if you can't explain it simply,<br>it means you didn't understand it well enough".<br></p>
            </div>
        </div>
    </div>
    <ul class="social-links">
        
            <li>
                <a href="mailto:ripple.shen31@gmail.com" rel="me" aria-label="e-mail">
                    <i class="fas fa-envelope fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="https://github.com/rileyshen" rel="me" aria-label="GitHub">
                    <i class="fab fa-github fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
    </ul>
    <div class="footer">
        <div class="by_farbox">&copy;  Riley Shen 2022 </div>
    </div>
</div>
<div class="main">
    <div class="page-top  animated fadeInDown ">
    <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
    </a>
    <ul class="nav" id="navMenu">
        
        
            
            <li><a 
                   href="/"
                        
                   title="">Home</a></li>
        
            
            <li><a 
                   href="/post/"
                        
                   title="">Posts</a></li>
        
            
            <li><a 
                   href="/about/"
                        
                   title="">About Me</a></li>
        
            
            <li><a 
                   href="/contact/"
                        
                   title="">Contact</a></li>
        
        
        
    </ul>
</div>

    <div class="autopagerize_page_element">
        <div class="content">
<div class="post  animated fadeInDown ">
    <div class="post-content">
        
        <div class="post-title">
            <h2>learning System design as a landscape architect 7</h2>
            
            <div class="info">
                <em class="fas fa-calendar-day"></em>
                <span class="date">
                    Tue, Mar 1, 2022
                    </span>
                <em class="fas fa-stopwatch"></em>
                <span class="reading-time">5-minute read</span>
            </div>
            
        </div>

        <p>Rethink system design in a much fun way, as a former urban planner/landscape planner. Take Collaborative Editing System as example</p>
<!-- more -->
<!-- TOC -->
<ul>
<li><a href="#collaborative-editing-system" >Collaborative Editing System</a>
<ul>
<li><a href="#scenario-analysis" >Scenario analysis</a>
<ul>
<li><a href="#basic-function" >basic function</a></li>
</ul>
</li>
<li><a href="#http-10" >HTTP 1.0</a></li>
<li><a href="#http-11" >HTTP 1.1</a></li>
<li><a href="#websocket" >WebSocket</a></li>
<li><a href="#service-analysis" >Service analysis</a>
<ul>
<li><a href="#request-files" >request files</a>
<ul>
<li><a href="#url-design" >URL design</a></li>
<li><a href="#simple-file-request-process" >simple file request process</a></li>
</ul>
</li>
<li><a href="#save-files" >save files</a>
<ul>
<li><a href="#metadata--content" >Metadata &amp;amp; Content</a></li>
<li><a href="#file-operation" >file operation</a></li>
<li><a href="#save-struture" >save struture</a></li>
<li><a href="#lru-cache" >LRU CACHE</a></li>
<li><a href="#why-doubly-linked-list" >why doubly linked list</a></li>
<li><a href="#how-to-convert-the-file-into-a-linked-list" >How to convert the file into a linked list</a></li>
<li><a href="#modify-content" >modify content</a></li>
</ul>
</li>
<li><a href="#edit-files" >edit files</a>
<ul>
<li><a href="#create-file-data-flow" >create file data flow</a></li>
<li><a href="#edit-file-data-flow" >edit file data flow</a></li>
</ul>
</li>
<li><a href="#table" >Table</a>
<ul>
<li><a href="#add-new-row" >add new row</a></li>
<li><a href="#modify-new-col" >modify new col</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#collaborative-editin" >Collaborative Editin</a>
<ul>
<li><a href="#display-avatars-edited-by-multiple-people-at-the-same-time" >display avatars edited by multiple people at the same time</a></li>
<li><a href="#display-avater-data-flow" >display avater data flow</a></li>
<li><a href="#display-who-is-editing-the-row" >display who is editing the row</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- /TOC -->
<hr>
<h2 id="collaborative-editing-system">Collaborative Editing System</h2>
<p><a id="markdown-collaborative-editing-system" name="collaborative-editing-system"></a></p>
<p>Google Docs</p>
<h3 id="scenario-analysis">Scenario analysis</h3>
<p><a id="markdown-scenario-analysis" name="scenario-analysis"></a></p>
<h4 id="basic-function">basic function</h4>
<p><a id="markdown-basic-function" name="basic-function"></a></p>
<ol>
<li>What is the main function of documentation editor(word)</li>
</ol>
<ul>
<li>New/Load File</li>
<li>Edit File</li>
<li>Save File</li>
</ul>
<ol start="2">
<li>What is the main function of Collaborative Editor (Google Docs)</li>
</ol>
<ul>
<li>Collaboration</li>
<li>Display Co-Authoring</li>
<li>Who updat</li>
<li>Content lock</li>
</ul>
<hr>
<h3 id="http-10">HTTP 1.0</h3>
<p><a id="markdown-http-1.0" name="http-1.0"></a></p>
<ul>
<li>don&rsquo;t support Long Connection
<ul>
<li>Three-way Hand</li>
<li>Slow Star</li>
<li>TCP Connection</li>
</ul>
</li>
<li>Head of Line Blocking</li>
</ul>
<h3 id="http-11">HTTP 1.1</h3>
<p><a id="markdown-http-1.1" name="http-1.1"></a></p>
<ul>
<li>dsupport Long Connection
<ul>
<li>one TCP Connection: mutiple Request + Response</li>
</ul>
</li>
<li>Pipeline</li>
</ul>
<p>Neither HTTP1.0 nor HTTP1.1 can send data from the server to the client.</p>
<p>WebSocket can communicate in both directions (server and client).</p>
<h3 id="websocket">WebSocket</h3>
<p><a id="markdown-websocket" name="websocket"></a></p>
<ol>
<li>build up connection</li>
<li>keep the session</li>
<li>update the content</li>
</ol>
<p>Features</p>
<ul>
<li>Support two-way communication</li>
</ul>
<ol start="2">
<li>Strong real-time performance
The server actively sends requests to the client, which solves the real-time problem</li>
</ol>
<p>stock system</p>
<hr>
<h3 id="service-analysis">Service analysis</h3>
<p><a id="markdown-service-analysis" name="service-analysis"></a></p>
<h4 id="request-files">request files</h4>
<p><a id="markdown-request-files" name="request-files"></a></p>
<h5 id="url-design">URL design</h5>
<p><a id="markdown-url-design" name="url-design"></a></p>
<p>You cannot use <code>http://xxx.com/aa/bb/cc.mp4</code> when sharing this file, because of safty reason and the links is too long for sharing.</p>
<p>Generate a unique key or uuid for each file.</p>
<blockquote>
<p><a href="http://xxx.com/avbnjnciej">http://xxx.com/avbnjnciej</a></p>
</blockquote>
<p>improve the readability</p>
<p>add file slugify string as suffix</p>
<blockquote>
<p><a href="http://xxx.com/avbnjnciej/collaborative-editing">http://xxx.com/avbnjnciej/collaborative-editing</a></p>
</blockquote>
<h5 id="simple-file-request-process">simple file request process</h5>
<p><a id="markdown-simple-file-request-process" name="simple-file-request-process"></a></p>
<p><strong>Clint</strong> &ndash;1. Request URL &ndash;&gt; <strong>Web Server</strong> &ndash; 2. Locate File &ndash;&gt; <strong>File System</strong></p>
<p><strong>File System</strong> &ndash;3. Get File &ndash;&gt; <strong>Web Server</strong> &ndash; 4. Response &ndash;&gt; <strong>Clint</strong></p>
<h4 id="save-files">save files</h4>
<p><a id="markdown-save-files" name="save-files"></a></p>
<h5 id="metadata--content">Metadata &amp; Content</h5>
<p><a id="markdown-metadata-%26-content" name="metadata-%26-content"></a></p>
<ul>
<li>Metadata &ndash;&gt; DB
<ul>
<li>key</li>
<li>filename</li>
<li>size
&hellip;</li>
</ul>
</li>
<li>Content &ndash;&gt; File System</li>
</ul>
<h5 id="file-operation">file operation</h5>
<p><a id="markdown-file-operation" name="file-operation"></a></p>
<p>basic file operation: CRUD</p>
<p>Granularity: what if take the whole file as Granularity?</p>
<p><strong>improve:</strong></p>
<p>use a row as Granularity,</p>
<p>use a word as Granularity: google docs</p>
<h5 id="save-struture">save struture</h5>
<p><a id="markdown-save-struture" name="save-struture"></a></p>
<hr>
<h5 id="lru-cache">LRU CACHE</h5>
<p><a id="markdown-lru-cache" name="lru-cache"></a></p>
<p>conbine quick search(hashset) and quick insert/remove (LinkedNode)</p>
<ol>
<li>
<p>If we add elements from the tail of the linked list by default, then obviously the elements closer to the tail are the most recently used, and the elements closer to the head are the ones that have not been used for the longest time.</p>
</li>
<li>
<p>For a certain key, we can quickly locate the node in the linked list through the hash table to obtain the corresponding val.</p>
</li>
<li>
<p>The linked list obviously supports fast insertion and deletion at any position, just change the pointer. It&rsquo;s just that the traditional linked list cannot quickly access an element at a certain position according to the index, but here with the help of the hash table, you can quickly map to any linked list node through the key, and then insert and delete.</p>
</li>
</ol>
<h5 id="why-doubly-linked-list">why doubly linked list</h5>
<p><a id="markdown-why-doubly-linked-list" name="why-doubly-linked-list"></a></p>
<p>• It is stored as a specific file on the file server
• The application server is loaded from the file server, and the content of the file is stored in memory
• Advantages of linked list Insert or delete at any position, good performance
• Each line of data in the file matches a node in the linked list
• Changes in content are equivalent to changes in linked list nodes</p>
<h5 id="how-to-convert-the-file-into-a-linked-list">How to convert the file into a linked list</h5>
<p><a id="markdown-how-to-convert-the-file-into-a-linked-list" name="how-to-convert-the-file-into-a-linked-list"></a></p>
<p>aa.txt</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">aaaaaaa
bbbbbbb
ccccc
...
</code></pre></div><p>Each row is a struct
Key: Unique identifier for each line of the file
Value: the content of each row
preId: predecessor Id, the previous line
afterId: follow-up Id, next line</p>
<p>Frontend generate the key and the uuid of each row when the front-end page is rendered and record it.</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">key</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span><span class="w">   </span><span class="n">value</span><span class="w">       </span><span class="n">preId</span><span class="w">       </span><span class="n">afterId</span><span class="w">
</span><span class="w"></span><span class="mi">00</span><span class="w">          </span><span class="n">aaaaaaa</span><span class="w">                    </span><span class="mi">11</span><span class="w">
</span><span class="w"></span><span class="mi">11</span><span class="w">          </span><span class="n">bbbbbbb</span><span class="w">      </span><span class="mi">00</span><span class="w">            </span><span class="mi">22</span><span class="w">
</span><span class="w"></span><span class="mi">22</span><span class="w">          </span><span class="n">ccccc</span><span class="w">        </span><span class="mi">11</span><span class="w">            </span><span class="p">..</span><span class="w">
</span></code></pre></div><h5 id="modify-content">modify content</h5>
<p><a id="markdown-modify-content" name="modify-content"></a>
What information needs to be sent to the server when adding or changing content on the front end</p>
<hr>
<h4 id="edit-files">edit files</h4>
<p><a id="markdown-edit-files" name="edit-files"></a></p>
<h5 id="create-file-data-flow">create file data flow</h5>
<p><a id="markdown-create-file-data-flow" name="create-file-data-flow"></a></p>
<p><code>Client</code> &ndash;1. create file request&ndash;&gt; <code>Web Server</code></p>
<p><code>Web Server</code> &ndash;2. transfer the created file&ndash;&gt; <code>File Server</code></p>
<p><code>Web Server</code> &ndash;3. save Metadata&ndash;&gt; <code>MySQL DB</code></p>
<p><code>File Serve</code> &ndash;4. save file&ndash;&gt; <code>File System</code></p>
<h5 id="edit-file-data-flow">edit file data flow</h5>
<p><a id="markdown-edit-file-data-flow" name="edit-file-data-flow"></a></p>
<p><code>Client</code> &ndash;1. edit file &ndash;&gt; <code>Web Server</code></p>
<p><code>Web Server</code> &ndash;2. save the modified part&ndash;&gt; <code>Redis</code> &ndash;&gt; <code>Scheduled Task</code></p>
<p><code>Web Server</code> &ndash;3. update Metadata&ndash;&gt; <code>MySQL DB</code></p>
<p><code>Scheduled Task</code> &ndash;4. combine modify&ndash;&gt; <code>File Server</code></p>
<p><code>File Server</code> &ndash;5. save file&ndash;&gt; <code>Distributed File System</code></p>
<p>When editing, the changed content is saved in Redis as linked list + hash table, and writes asynchronously to the file server.</p>
<h4 id="table">Table</h4>
<p><a id="markdown-table" name="table"></a></p>
<p>MySQL</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">fileid</span><span class="w">      </span><span class="n">filename</span><span class="w">       </span><span class="n">fileURL</span><span class="w">      </span><span class="n">filesurfix</span><span class="w">
</span><span class="w">
</span></code></pre></div><p>Redis contains 2 keys, one records head and tail; one records each row content after modifying.</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">Key: file key
Value: {
dummy: string;
tail: string;
}

Key: file key + row key
Value: {
content: string;
preID: string;
nextID: string;
}
</code></pre></div><h5 id="add-new-row">add new row</h5>
<p><a id="markdown-add-new-row" name="add-new-row"></a></p>
<p>aa.txt</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">aaaaaaa
bbbbbbb
&lt;!-- add new row --&gt;
eee
ccccc
...
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">key</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span><span class="w">   </span><span class="n">value</span><span class="w">       </span><span class="n">preId</span><span class="w">       </span><span class="n">afterId</span><span class="w">
</span><span class="w"></span><span class="mi">00</span><span class="w">          </span><span class="n">aaaaaaa</span><span class="w">                    </span><span class="mi">11</span><span class="w">
</span><span class="w"></span><span class="mi">11</span><span class="w">          </span><span class="n">bbbbbbb</span><span class="w">      </span><span class="mi">00</span><span class="w">            </span><span class="mi">99</span><span class="w">
</span><span class="w"></span><span class="mi">99</span><span class="w">          </span><span class="n">eee</span><span class="w">          </span><span class="mi">11</span><span class="w">            </span><span class="mi">11</span><span class="w">
</span><span class="w"></span><span class="mi">22</span><span class="w">          </span><span class="n">ccccc</span><span class="w">        </span><span class="mi">99</span><span class="w">            </span><span class="p">..</span><span class="w">
</span></code></pre></div><blockquote>
<p>How to guarante mutiple users generate the same uuid when operating on the same row</p>
</blockquote>
<h5 id="modify-new-col">modify new col</h5>
<p><a id="markdown-modify-new-col" name="modify-new-col"></a></p>
<p>aa.txt</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">aaaaaaa
bbbbxxx
&lt;!-- add new row --&gt;
eee
ccccc
...
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">key</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span><span class="w">   </span><span class="n">value</span><span class="w">       </span><span class="n">preId</span><span class="w">       </span><span class="n">afterId</span><span class="w">
</span><span class="w"></span><span class="mi">00</span><span class="w">          </span><span class="n">aaaaaaa</span><span class="w">                    </span><span class="mi">11</span><span class="w">
</span><span class="w"></span><span class="mi">11</span><span class="w">          </span><span class="n">bbbbxxx</span><span class="w">      </span><span class="mi">00</span><span class="w">            </span><span class="mi">99</span><span class="w">
</span><span class="w"></span><span class="mi">99</span><span class="w">          </span><span class="n">eee</span><span class="w">          </span><span class="mi">11</span><span class="w">            </span><span class="mi">11</span><span class="w">
</span><span class="w"></span><span class="mi">22</span><span class="w">          </span><span class="n">ccccc</span><span class="w">        </span><span class="mi">99</span><span class="w">            </span><span class="p">..</span><span class="w">
</span></code></pre></div><h3 id="collaborative-editin">Collaborative Editin</h3>
<p><a id="markdown-collaborative-editin" name="collaborative-editin"></a></p>
<h4 id="display-avatars-edited-by-multiple-people-at-the-same-time">display avatars edited by multiple people at the same time</h4>
<p><a id="markdown-display-avatars-edited-by-multiple-people-at-the-same-time" name="display-avatars-edited-by-multiple-people-at-the-same-time"></a></p>
<p>user lists saved in NoSQL (The data information of the user list is frequently changed)</p>
<h4 id="display-avater-data-flow">display avater data flow</h4>
<p><a id="markdown-display-avater-data-flow" name="display-avater-data-flow"></a></p>
<p><code>user 1</code> : &ndash;1. Update while editing user list &ndash;&gt; <code>server</code></p>
<p><code>user 2</code> : &ndash;1. Update while editing user list &ndash;&gt; <code>server</code></p>
<p><code>server</code> : &ndash;2. query user information &ndash;&gt; <code>user list</code></p>
<p><code>server</code> : &ndash;3. save the file when editing user list &ndash;&gt; <code>user list</code></p>
<h4 id="display-who-is-editing-the-row">display who is editing the row</h4>
<p><a id="markdown-display-who-is-editing-the-row" name="display-who-is-editing-the-row"></a></p>
<p><code>user 1</code> &ndash; when editing upload user id and row id&ndash;&gt; <code>server</code></p>
<p><code>server</code> &ndash;  synchronic data to user 2&ndash;&gt; <code>user 2</code></p>
<p><code>server</code> &mdash;-&gt; <code>Redis key:value&lt; row id : user id&gt;</code></p>
<blockquote>
<p>What cases may be encountered when multiple users edit at the same time?</p>
</blockquote>
<ul>
<li>
<p>Multiple people editing a row at the same time</p>
</li>
<li>
<p>One is deleting a row, one is adding</p>
</li>
</ul>
<p>Simultaneous locking, Decide who to adopt by the time it arrives at the server</p>
<p>Or use two methods no need lock.</p>
<ol>
<li>OT(Operational Transform) &ndash;&gt; Google Docs</li>
<li>CRDT(Conflict-Free Repicated Data Type)</li>
</ol>
<figure><img src="/images/system9.png"
         alt="image"/><figcaption>
            <h4>send coupon</h4>
        </figcaption>
</figure>

</div>
    <div class="post-footer">
        <div class="info">
            
            <span class="separator"><a class="tag" href="/tags/system-design/">System design</a><a class="tag" href="/tags/java/">java</a><a class="tag" href="/tags/interview/">interview</a><a class="tag" href="/tags/sde/">SDE</a><a class="tag" href="/tags/collaborative-editing-system/">Collaborative Editing System</a></span>
        </div>
    </div>

    
</div>


        </div>
    </div>
</div>

<script type="text/javascript"
        src="/js/medium-zoom.min.83cb1dd5fea8d42d87d1e601a07faa73089ad0ef9ccfe5daf6041289ebcc4e46.js"
        integrity="sha256-g8sd1f6o1C2H0eYBoH&#43;qcwia0O&#43;cz&#43;Xa9gQSievMTkY="
        crossorigin="anonymous"></script>
<script async defer src="//latest.js"></script>
<noscript><img src="//noscript.gif" alt=""/></noscript>

</body>

</html>
