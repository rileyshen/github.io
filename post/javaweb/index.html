<!DOCTYPE html>
<html  dir="ltr" lang="en" data-theme=""><head>
    <title> Riley Shen | java web project--learning through building </title>

    
    <meta charset="utf-8"><meta name="generator" content="Hugo 0.83.1" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <meta name="description"
        content="a full-stack web application for users to understand java web system">
    <meta name="google-site-verification" content="Nac1UrFTdr1E1F48JLe7XQhIbKn2_WtF4VnJI8KOtew" />
    

    
    
    
    <link rel="stylesheet" href="/css/main.min.a7c9793b97840076bef76d2743ee1c90b13bd21c18674076a0cccd5dd54c723b.css" integrity="sha256-p8l5O5eEAHa&#43;920nQ&#43;4ckLE70hwYZ0B2oMzNXdVMcjs="
        crossorigin="anonymous" type="text/css">
    
    
    <link rel="stylesheet" href="/css/markupHighlight.min.f798cbda9aaa38f89eb38be6414bd082cfd71a6780375cbf67b6d2fb2b96491e.css"
        integrity="sha256-95jL2pqqOPies4vmQUvQgs/XGmeAN1y/Z7bS&#43;yuWSR4=" crossorigin="anonymous" type="text/css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
        integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA=="
        crossorigin="anonymous" />

    
    <link rel="shortcut icon" href="/favicons/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">

    <link rel="canonical" href="/post/javaweb/">

    <link rel="preconnect" href="https://fonts.gstatic.com">



    
    
    
    
    <script type="text/javascript" src="/js/anatole-header.min.0c05c0a90d28c968a1cad4fb31abd0b8e1264e788ccefed022ae1d3b6f627514.js"
        integrity="sha256-DAXAqQ0oyWihytT7MavQuOEmTniMzv7QIq4dO29idRQ=" crossorigin="anonymous"></script>


    
    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://rileyshen.github.io/images/site-feature-image.png"/>

<meta name="twitter:title" content="java web project--learning through building"/>
<meta name="twitter:description" content="a full-stack web application for users to understand java web system"/>


    
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,300;0,400;0,500;0,600;0,700;1,500;1,600;1,700&display=swap"
        rel="stylesheet">

</head><body><div class="sidebar animated fadeInDown ">
    <div class="logo-title">
        <div class="title">
            <img src="/images/profileS.jpg" alt="profile picture">
            <h3 title=""><a href="/">I&#39;m Riley Shen</a></h3>
            <div class="description">
                <p><br>Riley likes to push her limits <br>and always keep learning new things. <br>She shares her weekly learnings <br>because "if you can't explain it simply,<br>it means you didn't understand it well enough".<br></p>
            </div>
        </div>
    </div>
    <ul class="social-links">
        
            <li>
                <a href="mailto:ripple.shen31@gmail.com" rel="me" aria-label="e-mail">
                    <i class="fas fa-envelope fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="https://github.com/rileyshen" rel="me" aria-label="GitHub">
                    <i class="fab fa-github fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
    </ul>
    <div class="footer">
        <div class="by_farbox">&copy;  Riley Shen 2022 </div>
    </div>
</div>
<div class="main">
    <div class="page-top  animated fadeInDown ">
    <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
    </a>
    <ul class="nav" id="navMenu">
        
        
            
            <li><a 
                   href="/"
                        
                   title="">Home</a></li>
        
            
            <li><a 
                   href="/post/"
                        
                   title="">Posts</a></li>
        
            
            <li><a 
                   href="/about/"
                        
                   title="">About Me</a></li>
        
            
            <li><a 
                   href="/contact/"
                        
                   title="">Contact</a></li>
        
        
        
    </ul>
</div>

    <div class="autopagerize_page_element">
        <div class="content">
<div class="post  animated fadeInDown ">
    <div class="post-content">
        
        <div class="post-title">
            <h2>java web project--learning through building</h2>
            
            <div class="info">
                <em class="fas fa-calendar-day"></em>
                <span class="date">
                    Tue, Jan 12, 2021
                    </span>
                <em class="fas fa-stopwatch"></em>
                <span class="reading-time">18-minute read</span>
            </div>
            
        </div>

        <p>a full-stack web application for users to understand java web system</p>
<!-- TOC -->
<ul>
<li><a href="#htmlcss" >HTML/CSS</a>
<ul>
<li><a href="#%E8%B6%85%E9%93%BE%E6%8E%A5" >超链接</a></li>
</ul>
</li>
<li><a href="#form-tag" >form tag</a>
<ul>
<li><a href="#t1-design-a-form-with-head-3-rows-3-cols-with-frame" >&lt;em&gt;&lt;strong&gt;t1: design a form with head, 3 rows 3 cols with frame&lt;/strong&gt;&lt;/em&gt;</a></li>
<li><a href="#t2-modify-the-form-width-heightformat-align-cellspacing" >&lt;em&gt;&lt;strong&gt;t2: modify the form width, height，format align, cellspacing&lt;/strong&gt;&lt;/em&gt;</a></li>
<li><a href="#5-row-5-col-the-first-row-and-col-a-cell-can-span-2-cols" >&lt;em&gt;&lt;strong&gt;5 row 5 col, the first row and col A cell can span 2 cols&lt;/strong&gt;&lt;/em&gt;</a></li>
<li><a href="#the-second-row-first-col-cell-spans-2-row-the-forth-row-and-forth-col-cell-spans-two-rows-and-2-cols" >&lt;em&gt;&lt;strong&gt;the second row first col cell spans 2 row, the forth row and forth col cell spans two rows and 2 cols&lt;/strong&gt;&lt;/em&gt;</a></li>
</ul>
</li>
<li><a href="#form" >form</a>
<ul>
<li><a href="#t1-create-a--register-form-inlucing-the-username-password-gender-hobbiesmultiple-nationsroll-down-hidden-field" >&lt;em&gt;&lt;strong&gt;t1: create a  register form, inlucing the username, password, gender, hobbiesmultiple, nationsroll down hidden field&lt;/strong&gt;&lt;/em&gt;</a></li>
</ul>
</li>
<li><a href="#jquery" >jQuery</a>
<ul>
<li><a href="#attr" >attr</a></li>
<li><a href="#prop-checked-readonly-selected-disabled" >prop checked, readOnly, selected, disabled</a></li>
<li><a href="#xml" >xml</a></li>
</ul>
</li>
<li><a href="#servlet" >Servlet</a>
<ul>
<li><a href="#httpservlet" >HttpServlet</a></li>
<li><a href="#" >/</a></li>
<li><a href="#garbled-languagee" >garbled languagee</a></li>
</ul>
</li>
<li><a href="#javaee-three-tier-system-decouple" >JavaEE three-tier system, decouple</a></li>
<li><a href="#servlet-thymeleaf" >servlet thymeleaf</a>
<ul>
<li><a href="#index" >index</a></li>
<li><a href="#thymeleaf-%E8%A7%86%E5%9B%BE%E6%A8%A1%E6%9D%BF%E6%8A%80%E6%9C%AF" >Thymeleaf 视图模板技术</a></li>
<li><a href="#viewbaseservlet" >ViewBaseServlet</a></li>
<li><a href="#templateengine-%E7%94%A8%E6%B3%95" >TemplateEngine 用法</a></li>
<li><a href="#index-thif--thless-%E7%94%A8%E6%B3%95" >index th:if &amp;amp;&amp;amp; th:less 用法</a></li>
<li><a href="#webservleteditdo-putget-%E9%97%AE%E9%A2%98" >@WebServlet&amp;quot;/edit.do&amp;quot; put/get 问题</a></li>
</ul>
</li>
<li><a href="#%E5%BC%95%E8%BF%9B-dispatchservlet-%E5%90%8E%E4%BB%A3%E7%A0%81%E6%94%B9%E5%8F%98" >引进 dispatchServlet 后代码改变</a>
<ul>
<li><a href="#servlets-%E5%90%88%E5%B9%B6" >servlets 合并</a></li>
<li><a href="#%E5%8F%8D%E5%B0%84%E6%96%B9%E6%B3%95%E8%BF%99%E6%A0%B7%E5%8F%AF%E4%BB%A5%E5%A2%9E%E5%8A%A0%E6%9B%B4%E5%A4%9A%E7%9A%84-method%E8%80%8C%E4%B8%8D%E7%94%A8-switch-%E6%9D%A5%E5%A2%9E%E5%8A%A0%E4%BB%A3%E7%A0%81" >反射方法，这样可以增加更多的 method，而不用 switch 来增加代码</a></li>
<li><a href="#dispatcherservlet-%E5%BC%95%E5%85%A5" >dispatcherServlet 引入</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E6%8E%A7%E5%88%B6%E5%99%A8%E7%BB%9F%E4%B8%80%E8%8E%B7%E5%8F%96%E5%8F%82%E6%95%B0" >核心控制器统一获取参数</a></li>
</ul>
</li>
<li><a href="#mvc-service-%E5%92%8C-dao-%E8%AF%A6%E7%BB%86%E5%8C%BA%E5%88%86" >mvc service 和 dao 详细区分</a></li>
<li><a href="#mvc-ioc-%E8%80%A6%E5%90%88%E9%97%AE%E9%A2%98" >mvc ioc 耦合问题</a>
<ul>
<li><a href="#-%E8%80%A6%E5%90%88%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5" >&#43; 耦合/依赖注入</a></li>
<li><a href="#2-%E9%85%8D%E7%BD%AE-bean-%E5%B7%A5%E5%8E%82%E5%AE%9E%E7%8E%B0%E6%A0%B9%E6%8D%AE-id-%E8%8E%B7%E5%BE%97%E4%B8%80%E4%B8%AA%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD" >&lt;strong&gt;2. 配置 bean 工厂，实现根据 id 获得一个类的功能&lt;/strong&gt;</a></li>
<li><a href="#3-%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0-bean-%E5%B7%A5%E5%8E%82" >&lt;strong&gt;3. 配置方法实现 bean 工厂&lt;/strong&gt;</a></li>
</ul>
</li>
<li><a href="#ioc---%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC--di---%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5" >IOC - 控制反转 / DI - 依赖注入</a>
<ul>
<li><a href="#%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC" >&lt;strong&gt;控制反转&lt;/strong&gt;</a></li>
<li><a href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5" >&lt;strong&gt;依赖注入&lt;/strong&gt;</a></li>
</ul>
</li>
<li><a href="#three-tier-system-of-the-project" >three-tier system of the project</a>
<ul>
<li><a href="#sp1-create-sql-forms" >sp1. create sql forms</a></li>
<li><a href="#sp2-javebean-user-id-username-password-email" >sp2. JaveBean User id, username, password, email</a></li>
<li><a href="#sp3-jdbcutils" >sp3. JdbcUtils</a></li>
<li><a href="#sp4-basedao" >sp4. BaseDao</a></li>
<li><a href="#sp5-userdao--test" >sp5. UserDao &amp;amp;&amp;amp; test</a></li>
<li><a href="#sp6-userservice--test" >sp6. UserService &amp;amp;&amp;amp; test</a></li>
<li><a href="#sp7-web" >sp7. web</a></li>
</ul>
</li>
<li><a href="#file-upload-and-download" >file upload and download</a>
<ul>
<li><a href="#file-upload" >file upload</a></li>
<li><a href="#commos-fileuploadjar" >commos-fileupload.jar</a></li>
<li><a href="#fileupload" >fileupload</a></li>
<li><a href="#file-download" >file download</a></li>
</ul>
</li>
<li><a href="#cookie--session" >Cookie &amp;amp;&amp;amp; Session</a>
<ul>
<li><a href="#use-cookie-to-save-users-information" >use Cookie to save user&amp;rsquo;s information</a></li>
<li><a href="#session-to-invalidate-the-user-infomation" >Session to invalidate the user infomation</a></li>
</ul>
</li>
<li><a href="#order-module" >Order module</a>
<ul>
<li><a href="#order-page" >Order page</a></li>
</ul>
</li>
<li><a href="#filter" >Filter</a>
<ul>
<li><a href="#%E8%BF%87%E6%BB%A4%E5%99%A8-filter" >过滤器 Filter</a></li>
</ul>
</li>
<li><a href="#%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86" >事务管理</a>
<ul>
<li><a href="#%E6%B6%89%E5%8F%8A%E5%88%B0%E7%9A%84%E7%BB%84%E4%BB%B6" >涉及到的组件</a></li>
<li><a href="#threadlocal" >ThreadLocal</a></li>
<li><a href="#threadlocal-and-filter-manage-transactions" >ThreadLocal and Filter manage transactions</a></li>
<li><a href="#modify-jdbcutils" >modify JdbcUtils</a></li>
<li><a href="#basedao" >BaseDao</a></li>
<li><a href="#filter-add-try-catch-to-service" >Filter add try-catch to Service</a></li>
<li><a href="#throw-new-runexception-in-baseservlet-to-filter" >throw new RunException in BaseServlet to Filter</a></li>
<li><a href="#tomcat-display-error-page" >tomcat display error page</a></li>
</ul>
</li>
<li><a href="#listener" >listener</a>
<ul>
<li><a href="#contextloaderlistener" >ContextLoaderListener</a></li>
</ul>
</li>
<li><a href="#json" >JSON</a>
<ul>
<li><a href="#json--javabean" >JSON &amp;amp;&amp;amp; JavaBean</a></li>
<li><a href="#json--list" >JSON &amp;amp;&amp;amp; List</a></li>
<li><a href="#json--map" >JSON &amp;amp;&amp;amp; Map</a></li>
</ul>
</li>
<li><a href="#ajax" >AJAX</a></li>
<li><a href="#use-ajax-invalidate-the-username" >use AJAX invalidate the username</a></li>
<li><a href="#use-ajax-to-add-the-item-to-the-cart" >use AJAX to add the item to the cart</a></li>
</ul>
<!-- /TOC -->
<h3 id="htmlcss">HTML/CSS</h3>
<p><a id="markdown-html%2Fcss" name="html%2Fcss"></a></p>
<h4 id="超链接">超链接</h4>
<p><a id="markdown-%E8%B6%85%E9%93%BE%E6%8E%A5" name="%E8%B6%85%E9%93%BE%E6%8E%A5"></a></p>
<blockquote>
<p><a href = "http://localhost:8080" target="_self">open current page </a></p>
</blockquote>
<blockquote>
<p><a href = "http://localhost:8080" target="_blank">open the new page </a></p>
</blockquote>
<h3 id="form-tag">form tag</h3>
<p><a id="markdown-form-tag" name="form-tag"></a></p>
<h4 id="t1-design-a-form-with-head-3-rows-3-cols-with-frame"><em><strong>t1: design a form with head, 3 rows 3 cols with frame</strong></em></h4>
<p><a id="markdown-***t1%3A-design-a-form-with-head%2C-3-rows-3-cols-with-frame***" name="***t1%3A-design-a-form-with-head%2C-3-rows-3-cols-with-frame***"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="cm">/**
</span><span class="cm">* table 
</span><span class="cm">* border 
</span><span class="cm">* width
</span><span class="cm">* align
</span><span class="cm">* cellspacing 
</span><span class="cm">* tr row tag
</span><span class="cm">* th from head tag
</span><span class="cm">* td table space tag
</span><span class="cm">*/</span>

<span class="o">&lt;</span><span class="nx">table</span> <span class="nx">align</span><span class="o">=</span><span class="s2">&#34;center&#34;</span> <span class="nx">border</span><span class="o">=</span><span class="s2">&#34;1&#34;</span> <span class="nx">width</span><span class="o">=</span><span class="s2">&#34;300&#34;</span> <span class="nx">height</span><span class="o">=</span><span class="s2">&#34;300&#34;</span> <span class="nx">cellspacing</span><span class="o">=</span><span class="s2">&#34;0&#34;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;</span><span class="mf">1.1</span><span class="o">&lt;</span><span class="err">/th&gt;</span>
        <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;</span><span class="mf">1.2</span><span class="o">&lt;</span><span class="err">/th&gt;</span>
        <span class="o">&lt;</span><span class="nx">th</span><span class="o">&gt;</span><span class="mf">1.3</span><span class="o">&lt;</span><span class="err">/th&gt;</span>
    <span class="o">&lt;</span><span class="err">/tr&gt;</span>
    <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="mf">2.1</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="mf">2.2</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="mf">2.3</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
    <span class="o">&lt;</span><span class="err">/tr&gt;</span>
    <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="mf">3.1</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="mf">3.2</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="mf">3.3</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
    <span class="o">&lt;</span><span class="err">/tr&gt;</span>
<span class="o">&lt;</span><span class="err">/table&gt;</span>

</code></pre></div><h4 id="t2-modify-the-form-width-heightformat-align-cellspacing"><em><strong>t2: modify the form width, height，format align, cellspacing</strong></em></h4>
<p><a id="markdown-***t2%3A-modify-the-form-width%2C-height%EF%BC%8Cformat-align%2C-cellspacing***" name="***t2%3A-modify-the-form-width%2C-height%EF%BC%8Cformat-align%2C-cellspacing***"></a></p>
<h4 id="5-row-5-col-the-first-row-and-col-a-cell-can-span-2-cols"><em><strong>5 row 5 col, the first row and col A cell can span 2 cols</strong></em></h4>
<p><a id="markdown-***5-row-5-col%2C-the-first-row-and-col-a-cell-can-span-2-cols***" name="***5-row-5-col%2C-the-first-row-and-col-a-cell-can-span-2-cols***"></a></p>
<h4 id="the-second-row-first-col-cell-spans-2-row-the-forth-row-and-forth-col-cell-spans-two-rows-and-2-cols"><em><strong>the second row first col cell spans 2 row, the forth row and forth col cell spans two rows and 2 cols</strong></em></h4>
<p><a id="markdown-***the-second-row-first-col-cell-spans-2-row%2C-the-forth-row-and-forth-col-cell-spans-two-rows-and-2-cols***" name="***the-second-row-first-col-cell-spans-2-row%2C-the-forth-row-and-forth-col-cell-spans-two-rows-and-2-cols***"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="cm">/**
</span><span class="cm">* table 
</span><span class="cm">* border 
</span><span class="cm">* width
</span><span class="cm">* align
</span><span class="cm">* cellspacing 
</span><span class="cm">* tr row tag
</span><span class="cm">* th from head tag
</span><span class="cm">* td table space tag
</span><span class="cm">*/</span>
<span class="o">&lt;</span><span class="nx">table</span> <span class="nx">align</span><span class="o">=</span><span class="s2">&#34;center&#34;</span> <span class="nx">border</span><span class="o">=</span><span class="s2">&#34;1&#34;</span> <span class="nx">width</span><span class="o">=</span><span class="s2">&#34;300&#34;</span> <span class="nx">height</span><span class="o">=</span><span class="s2">&#34;300&#34;</span> <span class="nx">cellspacing</span><span class="o">=</span><span class="s2">&#34;0&#34;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">td</span> <span class="nx">colspan</span><span class="o">=</span><span class="s2">&#34;2&#34;</span><span class="o">&gt;</span><span class="mf">1.1</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="mf">1.3</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="mf">1.4</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="mf">1.5</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
    <span class="o">&lt;</span><span class="err">/tr&gt;</span>
    <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">td</span> <span class="nx">rowspan</span><span class="o">=</span><span class="s2">&#34;2&#34;</span><span class="o">&gt;</span><span class="mf">2.1</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="mf">2.2</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="mf">2.3</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="mf">2.4</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="mf">2.5</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
    <span class="o">&lt;</span><span class="err">/tr&gt;</span>
    <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>    
        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="mf">3.2</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="mf">3.3</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="mf">3.4</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="mf">3.5</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
    <span class="o">&lt;</span><span class="err">/tr&gt;</span>
    <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>    
        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="mf">4.1</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="mf">4.2</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="mf">4.3</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
        <span class="o">&lt;</span><span class="nx">td</span> <span class="nx">colspan</span><span class="o">=</span><span class="s2">&#34;2&#34;</span> <span class="nx">rowspan</span><span class="o">=</span><span class="s2">&#34;2&#34;</span><span class="o">&gt;</span><span class="mf">4.4</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
    <span class="o">&lt;</span><span class="err">/tr&gt;</span>
    <span class="o">&lt;</span><span class="nx">tr</span><span class="o">&gt;</span>    
        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="mf">5.1</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="mf">5.2</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
        <span class="o">&lt;</span><span class="nx">td</span><span class="o">&gt;</span><span class="mf">5.3</span><span class="o">&lt;</span><span class="err">/td&gt;</span>
    <span class="o">&lt;</span><span class="err">/tr&gt;</span>
<span class="o">&lt;</span><span class="err">/table&gt;</span>

</code></pre></div><h3 id="form">form</h3>
<p><a id="markdown-form" name="form"></a></p>
<h4 id="t1-create-a--register-form-inlucing-the-username-password-gender-hobbiesmultiple-nationsroll-down-hidden-field"><em><strong>t1: create a  register form, inlucing the username, password, gender, hobbies(multiple), nations(roll down) hidden field</strong></em></h4>
<p><a id="markdown-***t1%3A-create-a--register-form%2C-inlucing-the-username%2C-password%2C-gender%2C-hobbiesmultiple%2C-nationsroll-down-hidden-field***" name="***t1%3A-create-a--register-form%2C-inlucing-the-username%2C-password%2C-gender%2C-hobbiesmultiple%2C-nationsroll-down-hidden-field***"></a></p>
<ul>
<li>form</li>
<li>input type=text value (display default content)</li>
<li>input type=password  value</li>
<li>input type=radio (single selection) name (for group) checked=&ldquo;checked&rdquo; (default selected)</li>
<li>input type=checkbox (multiple selection) checked=&ldquo;checked&rdquo;</li>
<li>input type=reset   value</li>
<li>input type=submit value</li>
<li>input type=button  value</li>
<li>input type=file (used for uploading files)</li>
<li>input type=hidden (hidden message for sending to service)</li>
<li>select</li>
<li>option  selected=&ldquo;selected&quot;设置默认选中</li>
<li>textarea</li>
<li>rows</li>
<li>cols</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="nx">form</span><span class="o">&gt;</span>
<span class="nx">username</span><span class="err">：</span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;text&#34;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&#34;default&#34;</span><span class="o">/&gt;&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
<span class="nx">password</span><span class="err">：</span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;password&#34;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&#34;abc&#34;</span><span class="o">/&gt;&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
<span class="nx">password</span><span class="err">：</span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;password&#34;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&#34;abc&#34;</span><span class="o">/&gt;&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
<span class="nx">gender</span><span class="err">：</span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;radio&#34;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&#34;sex&#34;</span><span class="o">/&gt;</span><span class="nx">male</span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;radio&#34;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&#34;sex&#34;</span> <span class="nx">checked</span><span class="o">=</span><span class="s2">&#34;checked&#34;</span> <span class="o">/&gt;</span><span class="nx">female</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
<span class="nx">hobbies</span><span class="err">：</span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;checkbox&#34;</span> <span class="nx">checked</span><span class="o">=</span><span class="s2">&#34;checked&#34;</span> <span class="o">/&gt;</span><span class="nx">Java</span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;checkbox&#34;</span> <span class="o">/&gt;</span><span class="nx">JavaScript</span><span class="o">&lt;</span><span class="nx">input</span>
<span class="nx">type</span><span class="o">=</span><span class="s2">&#34;checkbox&#34;</span> <span class="o">/&gt;</span><span class="nx">C</span><span class="o">++&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
<span class="nx">nations</span><span class="err">：</span><span class="o">&lt;</span><span class="nx">select</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">option</span><span class="o">&gt;--</span><span class="nx">please</span> <span class="nx">select</span> <span class="nx">your</span> <span class="nx">nation</span><span class="o">--&lt;</span><span class="err">/option&gt;</span>
<span class="o">&lt;</span><span class="nx">option</span> <span class="nx">selected</span><span class="o">=</span><span class="s2">&#34;selected&#34;</span><span class="o">&gt;</span><span class="nx">China</span><span class="o">&lt;</span><span class="err">/option&gt;</span>
<span class="o">&lt;</span><span class="nx">option</span><span class="o">&gt;</span><span class="nx">U</span><span class="p">.</span><span class="nx">S</span><span class="p">.</span><span class="o">&lt;</span><span class="err">/option&gt;</span>
<span class="o">&lt;</span><span class="nx">option</span><span class="o">&gt;</span><span class="nx">Japan</span><span class="o">&lt;</span><span class="err">/option&gt;</span>
<span class="o">&lt;</span><span class="sr">/select&gt;&lt;br/</span><span class="o">&gt;</span>
<span class="nx">introduce</span> <span class="nx">yourself</span><span class="err">：</span><span class="o">&lt;</span><span class="nx">textarea</span> <span class="nx">rows</span><span class="o">=</span><span class="s2">&#34;10&#34;</span> <span class="nx">cols</span><span class="o">=</span><span class="s2">&#34;20&#34;</span><span class="o">&gt;</span><span class="nx">xxxxx</span><span class="o">&lt;</span><span class="sr">/textarea&gt;&lt;br/</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;reset&#34;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&#34;abc&#34;</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;submit&#34;</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="err">/form&gt;</span>
<span class="o">&lt;</span><span class="err">/body&gt; </span>


</code></pre></div><h3 id="jquery">jQuery</h3>
<p><a id="markdown-jquery" name="jquery"></a></p>
<p><a href="" >jQuery</a></p>
<h4 id="attr">attr()</h4>
<p><a id="markdown-attr" name="attr"></a></p>
<h4 id="prop-checked-readonly-selected-disabled">prop() (checked, readOnly, selected, disabled)</h4>
<p><a id="markdown-prop-checked%2C-readonly%2C-selected%2C-disabled" name="prop-checked%2C-readonly%2C-selected%2C-disabled"></a></p>
<h4 id="xml">xml</h4>
<p><a id="markdown-xml" name="xml"></a></p>
<h3 id="servlet">Servlet</h3>
<p><a id="markdown-servlet" name="servlet"></a></p>
<h4 id="httpservlet">HttpServlet</h4>
<p><a id="markdown-httpservlet" name="httpservlet"></a></p>
<p>in real life always use HttpServlet instead of the GenericServlet. HttpServlet is easier to work with, and has more methods to work with than GenericServlet.</p>
<h4 id="heading">/</h4>
<p>/ decode by web</p>
<blockquote>
<p><a href="/">/ </a> /  is a absolute path: http:ip:port/</p>
</blockquote>
<p>/ decode by service</p>
<blockquote>
<p><url-pattern>/servlet </url-pattern>/  is a absolute path: http:ip:port/project</p>
</blockquote>
<blockquote>
<p>servletContext.getRealPath(&quot;/&quot;)</p>
</blockquote>
<blockquote>
<p>request.getRequestDispatcher(&quot;/&quot;)</p>
</blockquote>
<blockquote>
<p>reponse.sendRediect(&quot;/&quot;) // send / to web get http:ip:port/</p>
</blockquote>
<h4 id="garbled-languagee">garbled languagee</h4>
<p><a id="markdown-garbled-languagee" name="garbled-languagee"></a></p>
<blockquote>
<p>resp.setContentType(&ldquo;text/html; charset=UTF-8&rdquo;);</p>
</blockquote>
<h3 id="javaee-three-tier-system-decouple">JavaEE three-tier system, decouple</h3>
<p><a id="markdown-javaee-three-tier-system%2C-decouple" name="javaee-three-tier-system%2C-decouple"></a></p>
<p>client(Web Browser)</p>
<p>⬇️</p>
<p>JaveEE three-tier system</p>
<p>⬇️</p>
<p>1️⃣ web/view</p>
<ul>
<li>
<ol>
<li>get request parameter, encapsulate into a single standardized Bean object;</li>
</ol>
</li>
<li>
<ol start="2">
<li>invoke Service layer to deal with business;</li>
</ol>
</li>
<li>
<ol start="3">
<li>response to client, sendRediect, getRequestDispatcher;</li>
</ol>
</li>
</ul>
<p>⬇️ ⬇️</p>
<p>2️⃣ Serveice</p>
<ul>
<li>
<ol>
<li>deal with business layer</li>
</ol>
</li>
<li>
<ol start="2">
<li>invoke Dao save date</li>
</ol>
</li>
</ul>
<p>⬇️ ⬇️</p>
<p>3️⃣ Dao persistence layer</p>
<ul>
<li>only interact with Sql
<ul>
<li>CRUD</li>
<li>Create</li>
<li>Read</li>
<li>Update</li>
<li>Delete</li>
</ul>
</li>
</ul>
<p>⤵️</p>
<p>MySQL, Oracle, SqlServer</p>
<p>↩️</p>
<ul>
<li>Dao
<ul>
<li>Jdbc</li>
<li>DbUtile</li>
<li>JdbcTemplate</li>
<li>Mybatis</li>
<li>Hiberante</li>
<li>JPA</li>
</ul>
</li>
</ul>
<p>↩️</p>
<ul>
<li>Serveice
<ul>
<li>Spring frame</li>
</ul>
</li>
</ul>
<p>↩️</p>
<ul>
<li>Web
<ul>
<li>Service</li>
<li>Webwork</li>
<li>Strtus1.x/2.x</li>
<li>SpringMVC</li>
</ul>
</li>
</ul>
<h3 id="servlet-thymeleaf">servlet thymeleaf</h3>
<p><a id="markdown-servlet-thymeleaf" name="servlet-thymeleaf"></a></p>
<h4 id="index">index</h4>
<p><a id="markdown-index" name="index"></a></p>
<blockquote>
<p>index -》 IndexServlet （service（） -》 doGet（） ） -》《- xxDAOImpl -》 《- BaseDAO -》 《- 向数据库发起请求  -》 IndexServlet （service（） -》 doGet（） ） -》《- xxDAOImpl -》 《- BaseDAO -》 《- 向数据库发起请求</p>
</blockquote>
<h4 id="thymeleaf-视图模板技术">Thymeleaf 视图模板技术</h4>
<p><a id="markdown-thymeleaf-%E8%A7%86%E5%9B%BE%E6%A8%A1%E6%9D%BF%E6%8A%80%E6%9C%AF" name="thymeleaf-%E8%A7%86%E5%9B%BE%E6%A8%A1%E6%9D%BF%E6%8A%80%E6%9C%AF"></a></p>
<ul>
<li>添加 Thymeleaf jar 包</li>
<li>web.xml 添加配置</li>
<li>新建一个 ViewBaseServlet
<ul>
<li>配置前缀 prefix</li>
<li>配置后缀 suffix</li>
</ul>
</li>
<li>servlet 继承 ViewBaseServlet</li>
</ul>
<h4 id="viewbaseservlet">ViewBaseServlet</h4>
<p><a id="markdown-viewbaseservlet" name="viewbaseservlet"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ViewBaseServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">TemplateEngine</span> <span class="n">templateEngine</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">ServletException</span> <span class="o">{</span>

        <span class="c1">// 1.获取ServletContext对象
</span><span class="c1"></span>        <span class="n">ServletContext</span> <span class="n">servletContext</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">();</span>

        <span class="c1">// 2.创建Thymeleaf解析器对象
</span><span class="c1"></span>        <span class="n">ServletContextTemplateResolver</span> <span class="n">templateResolver</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServletContextTemplateResolver</span><span class="o">(</span><span class="n">servletContext</span><span class="o">);</span>

        <span class="c1">// 3.给解析器对象设置参数
</span><span class="c1"></span>        <span class="c1">// ①HTML是默认模式，明确设置是为了代码更容易理解
</span><span class="c1"></span>        <span class="n">templateResolver</span><span class="o">.</span><span class="na">setTemplateMode</span><span class="o">(</span><span class="n">TemplateMode</span><span class="o">.</span><span class="na">HTML</span><span class="o">);</span>

        <span class="c1">// ②设置前缀
</span><span class="c1"></span>        <span class="n">String</span> <span class="n">viewPrefix</span> <span class="o">=</span> <span class="n">servletContext</span><span class="o">.</span><span class="na">getInitParameter</span><span class="o">(</span><span class="s">&#34;view-prefix&#34;</span><span class="o">);</span>

        <span class="n">templateResolver</span><span class="o">.</span><span class="na">setPrefix</span><span class="o">(</span><span class="n">viewPrefix</span><span class="o">);</span>

        <span class="c1">// ③设置后缀
</span><span class="c1"></span>        <span class="n">String</span> <span class="n">viewSuffix</span> <span class="o">=</span> <span class="n">servletContext</span><span class="o">.</span><span class="na">getInitParameter</span><span class="o">(</span><span class="s">&#34;view-suffix&#34;</span><span class="o">);</span>

        <span class="n">templateResolver</span><span class="o">.</span><span class="na">setSuffix</span><span class="o">(</span><span class="n">viewSuffix</span><span class="o">);</span>

        <span class="c1">// ④设置缓存过期时间（毫秒）
</span><span class="c1"></span>        <span class="n">templateResolver</span><span class="o">.</span><span class="na">setCacheTTLMs</span><span class="o">(</span><span class="n">60000L</span><span class="o">);</span>

        <span class="c1">// ⑤设置是否缓存
</span><span class="c1"></span>        <span class="n">templateResolver</span><span class="o">.</span><span class="na">setCacheable</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

        <span class="c1">// ⑥设置服务器端编码方式
</span><span class="c1"></span>        <span class="n">templateResolver</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span><span class="s">&#34;utf-8&#34;</span><span class="o">);</span>

        <span class="c1">// 4.创建模板引擎对象
</span><span class="c1"></span>        <span class="n">templateEngine</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TemplateEngine</span><span class="o">();</span>

        <span class="c1">// 5.给模板引擎对象设置模板解析器
</span><span class="c1"></span>        <span class="n">templateEngine</span><span class="o">.</span><span class="na">setTemplateResolver</span><span class="o">(</span><span class="n">templateResolver</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">processTemplate</span><span class="o">(</span><span class="n">String</span> <span class="n">templateName</span><span class="o">,</span> <span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="c1">// 1.设置响应体内容类型和字符集
</span><span class="c1"></span>        <span class="n">resp</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">&#34;text/html;charset=UTF-8&#34;</span><span class="o">);</span>

        <span class="c1">// 2.创建WebContext对象
</span><span class="c1"></span>        <span class="n">WebContext</span> <span class="n">webContext</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WebContext</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">resp</span><span class="o">,</span> <span class="n">getServletContext</span><span class="o">());</span>

        <span class="c1">// 3.处理模板数据
</span><span class="c1"></span>        <span class="n">templateEngine</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">templateName</span><span class="o">,</span> <span class="n">webContext</span><span class="o">,</span> <span class="n">resp</span><span class="o">.</span><span class="na">getWriter</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div><h4 id="templateengine-用法">TemplateEngine 用法</h4>
<p><a id="markdown-templateengine-%E7%94%A8%E6%B3%95" name="templateengine-%E7%94%A8%E6%B3%95"></a></p>
<h4 id="index-thif--thless-用法">index th:if &amp;&amp; th:less 用法</h4>
<p><a id="markdown-index-th%3Aif-%26%26-th%3Aless-%E7%94%A8%E6%B3%95" name="index-th%3Aif-%26%26-th%3Aless-%E7%94%A8%E6%B3%95"></a></p>
<p>th:if 是条件为 true</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="o">&lt;</span><span class="n">tr</span> <span class="n">th</span><span class="o">:</span><span class="k">if</span><span class="o">=</span><span class="s">&#34;${#lists.isEmpty(session.bookList)}&#34;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">td</span> <span class="n">colspan</span><span class="o">=</span><span class="s">&#34;4&#34;</span><span class="o">&gt;</span><span class="n">库存为空</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</code></pre></div><p>th:unless 是条件为 false</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="o">&lt;</span><span class="n">tr</span> <span class="n">th</span><span class="o">:</span><span class="n">unless</span><span class="o">=</span><span class="s">&#34;${#lists.isEmpty(session.bookList)}&#34;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">book1</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
    <span class="n">td</span><span class="o">&gt;</span><span class="n">200</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
    <span class="n">td</span><span class="o">&gt;</span><span class="n">30</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
</code></pre></div><h4 id="webservleteditdo-putget-问题">@WebServlet(&quot;/edit.do&rdquo;) put/get 问题</h4>
<p><a id="markdown-%40webservlet%22%2Fedit.do%22-put%2Fget-%E9%97%AE%E9%A2%98" name="%40webservlet%22%2Fedit.do%22-put%2Fget-%E9%97%AE%E9%A2%98"></a></p>
<p>先理解只要不是 form 表单，修改也是 get</p>
<p>游览器只能发送 get 和 post</p>
<h3 id="引进-dispatchservlet-后代码改变">引进 dispatchServlet 后代码改变</h3>
<p><a id="markdown-%E5%BC%95%E8%BF%9B-dispatchservlet-%E5%90%8E%E4%BB%A3%E7%A0%81%E6%94%B9%E5%8F%98" name="%E5%BC%95%E8%BF%9B-dispatchservlet-%E5%90%8E%E4%BB%A3%E7%A0%81%E6%94%B9%E5%8F%98"></a></p>
<figure><img src="/images/jwb1.png"
         alt="image"/><figcaption>
            <h4>springmvc</h4>
        </figcaption>
</figure>

<h4 id="servlets-合并">servlets 合并</h4>
<p><a id="markdown-servlets-%E5%90%88%E5%B9%B6" name="servlets-%E5%90%88%E5%B9%B6"></a></p>
<ul>
<li>AddServlet.java</li>
</ul>
<figure><img src="/images/jwb2.png"
         alt="image"/><figcaption>
            <h4>servlets</h4>
        </figcaption>
</figure>

<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@WebServlet</span><span class="o">(</span><span class="s">&#34;/add.do&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AddServlet</span> <span class="kd">extends</span> <span class="n">ViewBaseServlet</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">FruitDAO</span> <span class="n">fruitDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FruitDAOImpl</span><span class="o">();</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doPost</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span><span class="s">&#34;UTF-8&#34;</span><span class="o">);</span>

        <span class="n">String</span> <span class="n">fname</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;fname&#34;</span><span class="o">);</span>
        <span class="n">Integer</span> <span class="n">price</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;price&#34;</span><span class="o">))</span> <span class="o">;</span>
        <span class="n">Integer</span> <span class="n">fcount</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;fcount&#34;</span><span class="o">));</span>
        <span class="n">String</span> <span class="n">remark</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;remark&#34;</span><span class="o">);</span>

        <span class="n">Fruit</span> <span class="n">fruit</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Fruit</span><span class="o">(</span><span class="n">0</span><span class="o">,</span><span class="n">fname</span> <span class="o">,</span> <span class="n">price</span> <span class="o">,</span> <span class="n">fcount</span> <span class="o">,</span> <span class="n">remark</span> <span class="o">)</span> <span class="o">;</span>

        <span class="n">fruitDAO</span><span class="o">.</span><span class="na">addFruit</span><span class="o">(</span><span class="n">fruit</span><span class="o">);</span>

        <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">&#34;index&#34;</span><span class="o">);</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><ul>
<li>Servelt 过多</li>
</ul>
<figure><img src="/images/jwb3.png"
         alt="image"/><figcaption>
            <h4>servlets</h4>
        </figcaption>
</figure>

<p>在方法中用</p>
<p>switch{
case &ldquo;index&rdquo; 
}</p>
<figure><img src="/images/jwb4.png"
         alt="image"/><figcaption>
            <h4>servlets</h4>
        </figcaption>
</figure>

<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">
<span class="nd">@WebServlet</span><span class="o">(</span><span class="s">&#34;/fruit.do&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FruitServlet</span> <span class="kd">extends</span> <span class="n">ViewBaseServlet</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">FruitDAO</span> <span class="n">fruitDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FruitDAOImpl</span><span class="o">();</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="c1">//设置编码
</span><span class="c1"></span>        <span class="n">request</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span><span class="s">&#34;UTF-8&#34;</span><span class="o">);</span>

        <span class="n">String</span> <span class="n">operate</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;operate&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">StringUtil</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">operate</span><span class="o">)){</span>
            <span class="n">operate</span> <span class="o">=</span> <span class="s">&#34;index&#34;</span> <span class="o">;</span>
        <span class="o">}</span>

        <span class="k">switch</span><span class="o">(</span><span class="n">operate</span><span class="o">){</span>
            <span class="k">case</span> <span class="s">&#34;index&#34;</span><span class="o">:</span>
                <span class="n">index</span><span class="o">(</span><span class="n">request</span><span class="o">,</span><span class="n">response</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="s">&#34;add&#34;</span><span class="o">:</span>
                <span class="n">add</span><span class="o">(</span><span class="n">request</span><span class="o">,</span><span class="n">response</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="s">&#34;del&#34;</span><span class="o">:</span>
                <span class="n">del</span><span class="o">(</span><span class="n">request</span><span class="o">,</span><span class="n">response</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="s">&#34;edit&#34;</span><span class="o">:</span>
                <span class="n">edit</span><span class="o">(</span><span class="n">request</span><span class="o">,</span><span class="n">response</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="s">&#34;update&#34;</span><span class="o">:</span>
                <span class="n">update</span><span class="o">(</span><span class="n">request</span><span class="o">,</span><span class="n">response</span><span class="o">);</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="s">&#34;operate值非法!&#34;</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="c1">//1.设置编码
</span><span class="c1"></span>        <span class="n">request</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span><span class="s">&#34;utf-8&#34;</span><span class="o">);</span>

        <span class="c1">//2.获取参数
</span><span class="c1"></span>        <span class="n">String</span> <span class="n">fidStr</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;fid&#34;</span><span class="o">);</span>
        <span class="n">Integer</span> <span class="n">fid</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">fidStr</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">fname</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;fname&#34;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">priceStr</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;price&#34;</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">price</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">priceStr</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">fcountStr</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;fcount&#34;</span><span class="o">);</span>
        <span class="n">Integer</span> <span class="n">fcount</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">fcountStr</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">remark</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;remark&#34;</span><span class="o">);</span>

        <span class="c1">//3.执行更新
</span><span class="c1"></span>        <span class="n">fruitDAO</span><span class="o">.</span><span class="na">updateFruit</span><span class="o">(</span><span class="k">new</span> <span class="n">Fruit</span><span class="o">(</span><span class="n">fid</span><span class="o">,</span><span class="n">fname</span><span class="o">,</span> <span class="n">price</span> <span class="o">,</span><span class="n">fcount</span> <span class="o">,</span><span class="n">remark</span> <span class="o">));</span>

        <span class="c1">//4.资源跳转
</span><span class="c1"></span>        <span class="c1">//super.processTemplate(&#34;index&#34;,request,response);
</span><span class="c1"></span>        <span class="c1">//request.getRequestDispatcher(&#34;index.html&#34;).forward(request,response);
</span><span class="c1"></span>        <span class="c1">//此处需要重定向，目的是重新给IndexServlet发请求，重新获取furitList，然后覆盖到session中，这样index.html页面上显示的session中的数据才是最新的
</span><span class="c1"></span>        <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">&#34;fruit.do&#34;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">edit</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span> <span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span><span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">fidStr</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;fid&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">StringUtil</span><span class="o">.</span><span class="na">isNotEmpty</span><span class="o">(</span><span class="n">fidStr</span><span class="o">)){</span>
            <span class="kt">int</span> <span class="n">fid</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">fidStr</span><span class="o">);</span>
            <span class="n">Fruit</span> <span class="n">fruit</span> <span class="o">=</span> <span class="n">fruitDAO</span><span class="o">.</span><span class="na">getFruitByFid</span><span class="o">(</span><span class="n">fid</span><span class="o">);</span>
            <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;fruit&#34;</span><span class="o">,</span><span class="n">fruit</span><span class="o">);</span>
            <span class="kd">super</span><span class="o">.</span><span class="na">processTemplate</span><span class="o">(</span><span class="s">&#34;edit&#34;</span><span class="o">,</span><span class="n">request</span><span class="o">,</span><span class="n">response</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">del</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span> <span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span><span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">fidStr</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;fid&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">StringUtil</span><span class="o">.</span><span class="na">isNotEmpty</span><span class="o">(</span><span class="n">fidStr</span><span class="o">)){</span>
            <span class="kt">int</span> <span class="n">fid</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">fidStr</span><span class="o">);</span>
            <span class="n">fruitDAO</span><span class="o">.</span><span class="na">delFruit</span><span class="o">(</span><span class="n">fid</span><span class="o">);</span>

            <span class="c1">//super.processTemplate(&#34;index&#34;,request,response);
</span><span class="c1"></span>            <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">&#34;fruit.do&#34;</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span><span class="s">&#34;UTF-8&#34;</span><span class="o">);</span>

        <span class="n">String</span> <span class="n">fname</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;fname&#34;</span><span class="o">);</span>
        <span class="n">Integer</span> <span class="n">price</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;price&#34;</span><span class="o">))</span> <span class="o">;</span>
        <span class="n">Integer</span> <span class="n">fcount</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;fcount&#34;</span><span class="o">));</span>
        <span class="n">String</span> <span class="n">remark</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;remark&#34;</span><span class="o">);</span>

        <span class="n">Fruit</span> <span class="n">fruit</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Fruit</span><span class="o">(</span><span class="n">0</span><span class="o">,</span><span class="n">fname</span> <span class="o">,</span> <span class="n">price</span> <span class="o">,</span> <span class="n">fcount</span> <span class="o">,</span> <span class="n">remark</span> <span class="o">)</span> <span class="o">;</span>

        <span class="n">fruitDAO</span><span class="o">.</span><span class="na">addFruit</span><span class="o">(</span><span class="n">fruit</span><span class="o">);</span>

        <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">&#34;fruit.do&#34;</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">index</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span> <span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span><span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span> <span class="o">{</span>
        <span class="n">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">()</span> <span class="o">;</span>

        <span class="c1">// 设置当前页，默认值1
</span><span class="c1"></span>        <span class="n">Integer</span> <span class="n">pageNo</span> <span class="o">=</span> <span class="n">1</span> <span class="o">;</span>

        <span class="n">String</span> <span class="n">oper</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;oper&#34;</span><span class="o">);</span>

        <span class="c1">//如果oper!=null 说明 通过表单的查询按钮点击过来的
</span><span class="c1"></span>        <span class="c1">//如果oper是空的，说明 不是通过表单的查询按钮点击过来的
</span><span class="c1"></span>        <span class="n">String</span> <span class="n">keyword</span> <span class="o">=</span> <span class="kc">null</span> <span class="o">;</span>
        <span class="k">if</span><span class="o">(</span><span class="n">StringUtil</span><span class="o">.</span><span class="na">isNotEmpty</span><span class="o">(</span><span class="n">oper</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="s">&#34;search&#34;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">oper</span><span class="o">)){</span>
            <span class="c1">//说明是点击表单查询发送过来的请求
</span><span class="c1"></span>            <span class="c1">//此时，pageNo应该还原为1 ， keyword应该从请求参数中获取
</span><span class="c1"></span>            <span class="n">pageNo</span> <span class="o">=</span> <span class="n">1</span> <span class="o">;</span>
            <span class="n">keyword</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;keyword&#34;</span><span class="o">);</span>
            <span class="c1">//如果keyword为null，需要设置为空字符串&#34;&#34;，否则查询时会拼接成 %null% , 我们期望的是 %%
</span><span class="c1"></span>            <span class="k">if</span><span class="o">(</span><span class="n">StringUtil</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">keyword</span><span class="o">)){</span>
                <span class="n">keyword</span> <span class="o">=</span> <span class="s">&#34;&#34;</span> <span class="o">;</span>
            <span class="o">}</span>
            <span class="c1">//将keyword保存（覆盖）到session中
</span><span class="c1"></span>            <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;keyword&#34;</span><span class="o">,</span><span class="n">keyword</span><span class="o">);</span>
        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
            <span class="c1">//说明此处不是点击表单查询发送过来的请求（比如点击下面的上一页下一页或者直接在地址栏输入网址）
</span><span class="c1"></span>            <span class="c1">//此时keyword应该从session作用域获取
</span><span class="c1"></span>            <span class="n">String</span> <span class="n">pageNoStr</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;pageNo&#34;</span><span class="o">);</span>
            <span class="k">if</span><span class="o">(</span><span class="n">StringUtil</span><span class="o">.</span><span class="na">isNotEmpty</span><span class="o">(</span><span class="n">pageNoStr</span><span class="o">)){</span>
                <span class="n">pageNo</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">pageNoStr</span><span class="o">);</span>   <span class="c1">//如果从请求中读取到pageNo，则类型转换。否则，pageNo默认就是1
</span><span class="c1"></span>            <span class="o">}</span>
            <span class="c1">//如果不是点击的查询按钮，那么查询是基于session中保存的现有keyword进行查询
</span><span class="c1"></span>            <span class="n">Object</span> <span class="n">keywordObj</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;keyword&#34;</span><span class="o">);</span>
            <span class="k">if</span><span class="o">(</span><span class="n">keywordObj</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                <span class="n">keyword</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">keywordObj</span> <span class="o">;</span>
            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
                <span class="n">keyword</span> <span class="o">=</span> <span class="s">&#34;&#34;</span> <span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="c1">// 重新更新当前页的值
</span><span class="c1"></span>        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;pageNo&#34;</span><span class="o">,</span><span class="n">pageNo</span><span class="o">);</span>

        <span class="n">FruitDAO</span> <span class="n">fruitDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FruitDAOImpl</span><span class="o">();</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Fruit</span><span class="o">&gt;</span> <span class="n">fruitList</span> <span class="o">=</span> <span class="n">fruitDAO</span><span class="o">.</span><span class="na">getFruitList</span><span class="o">(</span><span class="n">keyword</span> <span class="o">,</span> <span class="n">pageNo</span><span class="o">);</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;fruitList&#34;</span><span class="o">,</span><span class="n">fruitList</span><span class="o">);</span>

        <span class="c1">//总记录条数
</span><span class="c1"></span>        <span class="kt">int</span> <span class="n">fruitCount</span> <span class="o">=</span> <span class="n">fruitDAO</span><span class="o">.</span><span class="na">getFruitCount</span><span class="o">(</span><span class="n">keyword</span><span class="o">);</span>
        <span class="c1">//总页数
</span><span class="c1"></span>        <span class="kt">int</span> <span class="n">pageCount</span> <span class="o">=</span> <span class="o">(</span><span class="n">fruitCount</span><span class="o">+</span><span class="n">5</span><span class="o">-</span><span class="n">1</span><span class="o">)/</span><span class="n">5</span> <span class="o">;</span>
        <span class="cm">/*
</span><span class="cm">        总记录条数       总页数
</span><span class="cm">        1               1
</span><span class="cm">        5               1
</span><span class="cm">        6               2
</span><span class="cm">        10              2
</span><span class="cm">        11              3
</span><span class="cm">        fruitCount      (fruitCount+5-1)/5
</span><span class="cm">         */</span>
        <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;pageCount&#34;</span><span class="o">,</span><span class="n">pageCount</span><span class="o">);</span>

        <span class="c1">//此处的视图名称是 index
</span><span class="c1"></span>        <span class="c1">//那么thymeleaf会将这个 逻辑视图名称 对应到 物理视图 名称上去
</span><span class="c1"></span>        <span class="c1">//逻辑视图名称 ：   index
</span><span class="c1"></span>        <span class="c1">//物理视图名称 ：   view-prefix + 逻辑视图名称 + view-suffix
</span><span class="c1"></span>        <span class="c1">//所以真实的视图名称是：      /       index       .html
</span><span class="c1"></span>        <span class="kd">super</span><span class="o">.</span><span class="na">processTemplate</span><span class="o">(</span><span class="s">&#34;index&#34;</span><span class="o">,</span><span class="n">request</span><span class="o">,</span><span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>


</code></pre></div><h4 id="反射方法这样可以增加更多的-method而不用-switch-来增加代码">反射方法，这样可以增加更多的 method，而不用 switch 来增加代码</h4>
<p><a id="markdown-%E5%8F%8D%E5%B0%84%E6%96%B9%E6%B3%95%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%8F%AF%E4%BB%A5%E5%A2%9E%E5%8A%A0%E6%9B%B4%E5%A4%9A%E7%9A%84-method%EF%BC%8C%E8%80%8C%E4%B8%8D%E7%94%A8-switch-%E6%9D%A5%E5%A2%9E%E5%8A%A0%E4%BB%A3%E7%A0%81" name="%E5%8F%8D%E5%B0%84%E6%96%B9%E6%B3%95%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%8F%AF%E4%BB%A5%E5%A2%9E%E5%8A%A0%E6%9B%B4%E5%A4%9A%E7%9A%84-method%EF%BC%8C%E8%80%8C%E4%B8%8D%E7%94%A8-switch-%E6%9D%A5%E5%A2%9E%E5%8A%A0%E4%BB%A3%E7%A0%81"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@WebServlet</span><span class="o">(</span><span class="s">&#34;/fruit.do&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FruitServlet</span> <span class="kd">extends</span> <span class="n">ViewBaseServlet</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">FruitDAO</span> <span class="n">fruitDAO</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FruitDAOImpl</span><span class="o">();</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="c1">//设置编码
</span><span class="c1"></span>        <span class="n">request</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span><span class="s">&#34;UTF-8&#34;</span><span class="o">);</span>

        <span class="n">String</span> <span class="n">operate</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;operate&#34;</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">StringUtil</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">operate</span><span class="o">)){</span>
            <span class="n">operate</span> <span class="o">=</span> <span class="s">&#34;index&#34;</span> <span class="o">;</span>
        <span class="o">}</span>

        <span class="c1">// 获取当前类中所有方法
</span><span class="c1"></span>        <span class="n">Method</span><span class="o">[]</span> <span class="n">methods</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclareMethods</span><span class="o">();</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">Method</span> <span class="n">m</span> <span class="o">:</span> <span class="n">methods</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">methodName</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">operate</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">methodName</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="c1">// 找到和 operate 同名的方法， 那么通过反射技术调用它
</span><span class="c1"></span>                    <span class="n">m</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
                    <span class="k">return</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">IllegalAcc</span><span class="o">....)</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printS</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="s">&#34;operate值非法!&#34;</span><span class="o">);</span>
    <span class="o">}</span>

        <span class="c1">// switch(operate){
</span><span class="c1"></span>        <span class="c1">//     case &#34;index&#34;:
</span><span class="c1"></span>        <span class="c1">//         index(request,response);
</span><span class="c1"></span>        <span class="c1">//         break;
</span><span class="c1"></span>        <span class="c1">//     case &#34;add&#34;:
</span><span class="c1"></span>        <span class="c1">//         add(request,response);
</span><span class="c1"></span>        <span class="c1">//         break;
</span><span class="c1"></span>        <span class="c1">//     case &#34;del&#34;:
</span><span class="c1"></span>        <span class="c1">//         del(request,response);
</span><span class="c1"></span>        <span class="c1">//         break;
</span><span class="c1"></span>        <span class="c1">//     case &#34;edit&#34;:
</span><span class="c1"></span>        <span class="c1">//         edit(request,response);
</span><span class="c1"></span>        <span class="c1">//         break;
</span><span class="c1"></span>        <span class="c1">//     case &#34;update&#34;:
</span><span class="c1"></span>        <span class="c1">//         update(request,response);
</span><span class="c1"></span>        <span class="c1">//         break;
</span><span class="c1"></span>        <span class="c1">//     default:
</span><span class="c1"></span>                <span class="c1">//  throw new RuntimeException(&#34;operate值非法!&#34;);
</span><span class="c1"></span>        <span class="c1">// }
</span><span class="c1"></span>    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> 

</code></pre></div><h4 id="dispatcherservlet-引入">dispatcherServlet 引入</h4>
<p><a id="markdown-dispatcherservlet-%E5%BC%95%E5%85%A5" name="dispatcherservlet-%E5%BC%95%E5%85%A5"></a></p>
<figure><img src="/images/jwb5.png"
         alt="image"/><figcaption>
            <h4>servlets</h4>
        </figcaption>
</figure>

<p>用 dispatcherServelet 控制 controller， 把反射放到父类</p>
<h4 id="核心控制器统一获取参数">核心控制器统一获取参数</h4>
<p><a id="markdown-%E6%A0%B8%E5%BF%83%E6%8E%A7%E5%88%B6%E5%99%A8%E7%BB%9F%E4%B8%80%E8%8E%B7%E5%8F%96%E5%8F%82%E6%95%B0" name="%E6%A0%B8%E5%BF%83%E6%8E%A7%E5%88%B6%E5%99%A8%E7%BB%9F%E4%B8%80%E8%8E%B7%E5%8F%96%E5%8F%82%E6%95%B0"></a></p>
<p><a href="https://rileyshen.github.io/post/springmvc/" >springmvc</a></p>
<figure><img src="/images/jwb6.png"
         alt="image"/><figcaption>
            <h4>servlets</h4>
        </figcaption>
</figure>

<h3 id="mvc-service-和-dao-详细区分">mvc service 和 dao 详细区分</h3>
<p><a id="markdown-mvc-service-%E5%92%8C-dao-%E8%AF%A6%E7%BB%86%E5%8C%BA%E5%88%86" name="mvc-service-%E5%92%8C-dao-%E8%AF%A6%E7%BB%86%E5%8C%BA%E5%88%86"></a></p>
<figure><img src="/images/jwb7.png"
         alt="image"/><figcaption>
            <h4>servlets</h4>
        </figcaption>
</figure>

<figure><img src="/images/jwb8.png"
         alt="image"/><figcaption>
            <h4>servlets</h4>
        </figcaption>
</figure>

<h3 id="mvc-ioc-耦合问题">mvc ioc 耦合问题</h3>
<p><a id="markdown-mvc-ioc-%E8%80%A6%E5%90%88%E9%97%AE%E9%A2%98" name="mvc-ioc-%E8%80%A6%E5%90%88%E9%97%AE%E9%A2%98"></a></p>
<h4 id="-耦合依赖注入">+ 耦合/依赖注入</h4>
<p><a id="markdown-%2B-%E8%80%A6%E5%90%88%2F%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5" name="%2B-%E8%80%A6%E5%90%88%2F%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"></a></p>
<p>在软件系统中，层与层之间是存在依赖的。我们也称之为耦合。</p>
<p>我们系统架构或者是设计的一个原则是： 高内聚低耦合。</p>
<p>层内部的组成应该是高度聚合的，而层与层之间的关系应该是低耦合的，最理想的情况 0 耦合（就是没有耦合）</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FruitController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">FruitService</span> <span class="n">fruitService</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FruitServiceImpl</span><span class="o">()</span> <span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="nf">update</span><span class="o">(</span><span class="n">Integer</span> <span class="n">fid</span> <span class="o">,</span> <span class="n">String</span> <span class="n">fname</span> <span class="o">,</span> <span class="n">Integer</span> <span class="n">price</span> <span class="o">,</span> <span class="n">Integer</span> <span class="n">fcount</span> <span class="o">,</span> <span class="n">String</span> <span class="n">remark</span> <span class="o">){</span>
    <span class="o">}</span>
</code></pre></div><ul>
<li>step 1：</li>
</ul>
<blockquote>
<p>private FruitService fruitService = null ;</p>
</blockquote>
<ul>
<li>解决空指针问题：</li>
</ul>
<p><strong>1. 配置 3 个 bean，对应 3 个组件</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;beans&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;fruitDAO&#34;</span> <span class="na">class=</span><span class="s">&#34;com.atguigu.fruit.dao.impl.FruitDAOImpl&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;fruitService&#34;</span> <span class="na">class=</span><span class="s">&#34;com.atguigu.fruit.service.impl.FruitServiceImpl&#34;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- property标签用来表示属性；name表示属性名；ref表示引用其他bean的id值--&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;fruitDAO&#34;</span> <span class="na">ref=</span><span class="s">&#34;fruitDAO&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;fruit&#34;</span> <span class="na">class=</span><span class="s">&#34;com.atguigu.fruit.controllers.FruitController&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;fruitService&#34;</span> <span class="na">ref=</span><span class="s">&#34;fruitService&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre></div><h4 id="2-配置-bean-工厂实现根据-id-获得一个类的功能"><strong>2. 配置 bean 工厂，实现根据 id 获得一个类的功能</strong></h4>
<p><a id="markdown-**2.-%E9%85%8D%E7%BD%AE-bean-%E5%B7%A5%E5%8E%82%EF%BC%8C%E5%AE%9E%E7%8E%B0%E6%A0%B9%E6%8D%AE-id-%E8%8E%B7%E5%BE%97%E4%B8%80%E4%B8%AA%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD**" name="**2.-%E9%85%8D%E7%BD%AE-bean-%E5%B7%A5%E5%8E%82%EF%BC%8C%E5%AE%9E%E7%8E%B0%E6%A0%B9%E6%8D%AE-id-%E8%8E%B7%E5%BE%97%E4%B8%80%E4%B8%AA%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD**"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">BeanFactory</span> <span class="o">{</span>
    <span class="n">Object</span> <span class="nf">getBean</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><h4 id="3-配置方法实现-bean-工厂"><strong>3. 配置方法实现 bean 工厂</strong></h4>
<p><a id="markdown-**3.-%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0-bean-%E5%B7%A5%E5%8E%82**" name="**3.-%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0-bean-%E5%B7%A5%E5%8E%82**"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClassPathXmlApplicationContext</span> <span class="kd">implements</span> <span class="n">BeanFactory</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">beanMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>

    <span class="kd">public</span> <span class="nf">ClassPathXmlApplicationContext</span><span class="o">(){</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">InputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="n">getClass</span><span class="o">().</span><span class="na">getClassLoader</span><span class="o">().</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="s">&#34;applicationContext.xml&#34;</span><span class="o">);</span>
            <span class="c1">//1.创建DocumentBuilderFactory
</span><span class="c1"></span>            <span class="n">DocumentBuilderFactory</span> <span class="n">documentBuilderFactory</span> <span class="o">=</span> <span class="n">DocumentBuilderFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
            <span class="c1">//2.创建DocumentBuilder对象
</span><span class="c1"></span>            <span class="n">DocumentBuilder</span> <span class="n">documentBuilder</span> <span class="o">=</span> <span class="n">documentBuilderFactory</span><span class="o">.</span><span class="na">newDocumentBuilder</span><span class="o">()</span> <span class="o">;</span>
            <span class="c1">//3.创建Document对象
</span><span class="c1"></span>            <span class="n">Document</span> <span class="n">document</span> <span class="o">=</span> <span class="n">documentBuilder</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">inputStream</span><span class="o">);</span>

            <span class="c1">//4.获取所有的bean节点
</span><span class="c1"></span>            <span class="n">NodeList</span> <span class="n">beanNodeList</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="s">&#34;bean&#34;</span><span class="o">);</span>
            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span> <span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">beanNodeList</span><span class="o">.</span><span class="na">getLength</span><span class="o">()</span> <span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                <span class="n">Node</span> <span class="n">beanNode</span> <span class="o">=</span> <span class="n">beanNodeList</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="k">if</span><span class="o">(</span><span class="n">beanNode</span><span class="o">.</span><span class="na">getNodeType</span><span class="o">()</span> <span class="o">==</span> <span class="n">Node</span><span class="o">.</span><span class="na">ELEMENT_NODE</span><span class="o">){</span>
                    <span class="n">Element</span> <span class="n">beanElement</span> <span class="o">=</span> <span class="o">(</span><span class="n">Element</span><span class="o">)</span><span class="n">beanNode</span> <span class="o">;</span>
                    <span class="n">String</span> <span class="n">beanId</span> <span class="o">=</span>  <span class="n">beanElement</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">);</span>
                    <span class="n">String</span> <span class="n">className</span> <span class="o">=</span> <span class="n">beanElement</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;class&#34;</span><span class="o">);</span>
                    <span class="n">Class</span> <span class="n">beanClass</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">className</span><span class="o">);</span>
                    <span class="c1">//创建bean实例
</span><span class="c1"></span>                    <span class="n">Object</span> <span class="n">beanObj</span> <span class="o">=</span> <span class="n">beanClass</span><span class="o">.</span><span class="na">newInstance</span><span class="o">()</span> <span class="o">;</span>
                    <span class="c1">//将bean实例对象保存到map容器中
</span><span class="c1"></span>                    <span class="n">beanMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">beanId</span> <span class="o">,</span> <span class="n">beanObj</span><span class="o">)</span> <span class="o">;</span>
                    <span class="c1">//到目前为止，此处需要注意的是，bean和bean之间的依赖关系还没有设置
</span><span class="c1"></span>                <span class="o">}</span>
            <span class="o">}</span>
            <span class="c1">//5.组装bean之间的依赖关系
</span><span class="c1"></span>            <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span> <span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">beanNodeList</span><span class="o">.</span><span class="na">getLength</span><span class="o">()</span> <span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
                <span class="n">Node</span> <span class="n">beanNode</span> <span class="o">=</span> <span class="n">beanNodeList</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
                <span class="k">if</span><span class="o">(</span><span class="n">beanNode</span><span class="o">.</span><span class="na">getNodeType</span><span class="o">()</span> <span class="o">==</span> <span class="n">Node</span><span class="o">.</span><span class="na">ELEMENT_NODE</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">Element</span> <span class="n">beanElement</span> <span class="o">=</span> <span class="o">(</span><span class="n">Element</span><span class="o">)</span> <span class="n">beanNode</span><span class="o">;</span>
                    <span class="n">String</span> <span class="n">beanId</span> <span class="o">=</span> <span class="n">beanElement</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">);</span>
                    <span class="n">NodeList</span> <span class="n">beanChildNodeList</span> <span class="o">=</span> <span class="n">beanElement</span><span class="o">.</span><span class="na">getChildNodes</span><span class="o">();</span>
                    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">beanChildNodeList</span><span class="o">.</span><span class="na">getLength</span><span class="o">()</span> <span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
                        <span class="n">Node</span> <span class="n">beanChildNode</span> <span class="o">=</span> <span class="n">beanChildNodeList</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">j</span><span class="o">);</span>
                        <span class="k">if</span><span class="o">(</span><span class="n">beanChildNode</span><span class="o">.</span><span class="na">getNodeType</span><span class="o">()==</span><span class="n">Node</span><span class="o">.</span><span class="na">ELEMENT_NODE</span> <span class="o">&amp;&amp;</span> <span class="s">&#34;property&#34;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">beanChildNode</span><span class="o">.</span><span class="na">getNodeName</span><span class="o">())){</span>
                            <span class="n">Element</span> <span class="n">propertyElement</span> <span class="o">=</span> <span class="o">(</span><span class="n">Element</span><span class="o">)</span> <span class="n">beanChildNode</span><span class="o">;</span>
                            <span class="n">String</span> <span class="n">propertyName</span> <span class="o">=</span> <span class="n">propertyElement</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">);</span>
                            <span class="n">String</span> <span class="n">propertyRef</span> <span class="o">=</span> <span class="n">propertyElement</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;ref&#34;</span><span class="o">);</span>
                            <span class="c1">//1) 找到propertyRef对应的实例
</span><span class="c1"></span>                            <span class="n">Object</span> <span class="n">refObj</span> <span class="o">=</span> <span class="n">beanMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">propertyRef</span><span class="o">);</span>
                            <span class="c1">//2) 将refObj设置到当前bean对应的实例的property属性上去
</span><span class="c1"></span>                            <span class="n">Object</span> <span class="n">beanObj</span> <span class="o">=</span> <span class="n">beanMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">beanId</span><span class="o">);</span>
                            <span class="n">Class</span> <span class="n">beanClazz</span> <span class="o">=</span> <span class="n">beanObj</span><span class="o">.</span><span class="na">getClass</span><span class="o">();</span>
                            <span class="n">Field</span> <span class="n">propertyField</span> <span class="o">=</span> <span class="n">beanClazz</span><span class="o">.</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="n">propertyName</span><span class="o">);</span>
                            <span class="n">propertyField</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
                            <span class="n">propertyField</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">beanObj</span><span class="o">,</span><span class="n">refObj</span><span class="o">);</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ParserConfigurationException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SAXException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IllegalAccessException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InstantiationException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ClassNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NoSuchFieldException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>


    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getBean</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">beanMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div><h3 id="ioc---控制反转--di---依赖注入">IOC - 控制反转 / DI - 依赖注入</h3>
<p><a id="markdown-ioc---%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC-%2F-di---%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5" name="ioc---%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC-%2F-di---%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"></a></p>
<h4 id="控制反转"><strong>控制反转</strong></h4>
<p><a id="markdown-**%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC**" name="**%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC**"></a></p>
<ul>
<li>之前在 Servlet 中，我们创建 service 对象 ， FruitService fruitService = new FruitServiceImpl(); 这句话如果出现在 servlet 中的某个方法内部，那么这个 fruitService 的作用域（生命周期）应该就是这个方法级别；<strong>(需要大量的创建销毁过程)</strong></li>
</ul>
<p>如果这句话出现在 servlet 的类中，也就是说 fruitService 是一个成员变量，那么这个 fruitService 的作用域（生命周期）应该就是这个 servlet 实例级别 <strong>(不需要大量的创建销毁过程，但生命周期扩大，有线程不安全问题)</strong></p>
<ul>
<li>之后我们在 applicationContext.xml 中定义了这个 fruitService。然后通过解析 XML，产生 fruitService 实例，存放在 beanMap 中，这个 beanMap 在一个 BeanFactory 中因此，我们转移（改变）了之前的 service 实例、dao 实例等等他们的生命周期。控制权从程序员转移到 BeanFactory。这个现象我们称之为控制反转</li>
</ul>
<h4 id="依赖注入"><strong>依赖注入</strong></h4>
<p><a id="markdown-**%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5**" name="**%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5**"></a></p>
<ul>
<li>
<p>之前我们在控制层出现代码：FruitService fruitService = new FruitServiceImpl()；那么，控制层和 service 层存在耦合。</p>
</li>
<li>
<p>之后，我们将代码修改成 FruitService fruitService = null ;
然后，在配置文件中配置:</p>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">       <span class="o">&lt;</span><span class="n">bean</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;fruit&#34;</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;FruitController&#34;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">property</span> <span class="n">name</span><span class="o">=</span><span class="s">&#34;fruitService&#34;</span> <span class="n">ref</span><span class="o">=</span><span class="s">&#34;fruitService&#34;</span><span class="o">/&gt;</span>
       <span class="o">&lt;/</span><span class="n">bean</span><span class="o">&gt;</span>

</code></pre></div><h3 id="qqzone-业务需求">QQZone 业务需求</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">1<span class="o">)</span> 用户登录
  2<span class="o">)</span> 登录成功，显示主界面。左侧显示好友列表；上端显示欢迎词。如果不是自己的空间，显示超链接：返回自己的空间；下端显示日志列表
  3<span class="o">)</span> 查看日志详情：
        - 日志本身的信息（作者头像、昵称、日志标题、日志内容、日志的日期）
        - 回复列表（回复者的头像、昵称、回复内容、回复日期）
        - 主人回复信息
  4<span class="o">)</span> 删除日志
  5<span class="o">)</span> 删除特定回复
  6<span class="o">)</span> 删除特定主人回复
  7<span class="o">)</span> 添加日志、添加回复、添加主人回复
  8<span class="o">)</span> 点击左侧好友链接，进入好友的空间
2.数据库设计
  1） 抽取实体 : 用户登录信息、用户详情信息 、 日志 、 回贴  、 主人回复
  2） 分析其中的属性：
    - 用户登录信息：账号、密码、头像、昵称
    - 用户详情信息：真实姓名、星座、血型、邮箱、手机号.....
    - 日志：标题、内容、日期、作者
    - 回复：内容、日期、作者、日志
    - 主人回复：内容、日期、作者、回复
  3） 分析实体之间的关系
    - 用户登录信息 ： 用户详情信息      1：1 PK
    - 用户 ： 日志                   1：N
    - 日志 ： 回复                   1：N
    - 回复 ： 主人回复                1：1 UK
    - 用户 ： 好友                   M ： N
3.数据库的范式：
  1） 第一范式：列不可再分
  2） 第二范式：一张表只表达一层含义（只描述一件事情）
  3） 第三范式：表中的每一列和主键都是直接依赖关系，而不是间接依赖
4.数据库设计的范式和数据库的查询性能很多时候是相悖的，我们需要根据实际的业务情况做一个选择：
  - 查询频次不高的情况下，我们更倾向于提高数据库的设计范式，从而提高存储效率
  - 查询频次较高的情形，我们更倾向于牺牲数据库的规范度，降低数据库设计的范式，允许特定的冗余，从而提高查询的性能

5.QQZone登录功能实现出现的四个错误：
 1<span class="o">)</span> URL没修改，用的还是fruitdb
 2）
 3）rsmd.getColumnName<span class="o">()</span> 和 rsmd.getColumnLabel<span class="o">()</span>
 4）Can not <span class="nb">set</span> com.atguigu.qqzone.pojo.UserBasic field com.atguigu.qqzone.pojo.Topic.author to java.lang.Integer
 5<span class="o">)</span> left.html页面没有样式，同时数据也不展示，原因是：我们是直接去请求的静态页面资源，那么并没有执行super.processTemplate<span class="o">()</span>，也就是thymeleaf没有起作用
    <span class="o">(</span>之前的表单也是这个原因<span class="o">)</span>
    解决方法：
    - 新增PageController，添加page方法:
    public String page<span class="o">(</span>String page<span class="o">){</span>
        <span class="k">return</span> page <span class="p">;</span>       // frames/left
    <span class="o">}</span>
    目的是执行super.processTemplate<span class="o">()</span>方法，让thymeleaf生效
</code></pre></div><h3 id="three-tier-system-of-the-project">three-tier system of the project</h3>
<p><a id="markdown-three-tier-system-of-the-project" name="three-tier-system-of-the-project"></a></p>
<h4 id="sp1-create-sql-forms">sp1. create sql forms</h4>
<p><a id="markdown-sp1.-create-sql-forms" name="sp1.-create-sql-forms"></a></p>
<ul>
<li>database book</li>
<li>t_user</li>
</ul>
<h4 id="sp2-javebean-user-id-username-password-email">sp2. JaveBean User (id, username, password, email)</h4>
<p><a id="markdown-sp2.-javebean-user-id%2C-username%2C-password%2C-email" name="sp2.-javebean-user-id%2C-username%2C-password%2C-email"></a></p>
<h4 id="sp3-jdbcutils">sp3. JdbcUtils</h4>
<p><a id="markdown-sp3.-jdbcutils" name="sp3.-jdbcutils"></a></p>
<ul>
<li>jar package</li>
<li>jdbc.properties in src dir</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">username</span><span class="o">=</span><span class="n">root</span>
<span class="n">password</span><span class="o">=</span><span class="n">root</span>
<span class="n">url</span><span class="o">=</span><span class="n">jdbc</span><span class="o">:</span><span class="n">mysql</span><span class="o">:</span><span class="c1">//localhost:3306/book
</span><span class="c1"></span><span class="n">driverClassName</span><span class="o">=</span><span class="n">com</span><span class="o">.</span><span class="na">mysql</span><span class="o">.</span><span class="na">jdbc</span><span class="o">.</span><span class="na">Driver</span>
<span class="n">initialSize</span><span class="o">=</span><span class="n">5</span>
<span class="n">maxActive</span><span class="o">=</span><span class="n">1</span>
</code></pre></div><ul>
<li>Jdbc tool</li>
</ul>
<h4 id="sp4-basedao">sp4. BaseDao</h4>
<p><a id="markdown-sp4.-basedao" name="sp4.-basedao"></a></p>
<ul>
<li>commons-dbutils jar</li>
<li>BaseDao</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">BaseDao</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">QueryRunner</span> <span class="n">queryRunner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QueryRunner</span><span class="o">();</span>

    <span class="cm">/**
</span><span class="cm">    * update() : insert/update/delete
</span><span class="cm">    *
</span><span class="cm">    */</span> 
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">update</span><span class="o">(</span><span class="n">String</span> <span class="n">sql</span><span class="o">,</span> <span class="n">Object</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">JdbcUtils</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">queryRunner</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">connection</span><span class="o">,</span> <span class="n">sql</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">JdbcUtils</span><span class="o">.</span><span class="na">close</span><span class="o">(</span><span class="n">connection</span><span class="o">);</span>
        <span class="o">}</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">1</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

     <span class="cm">/**
</span><span class="cm">    * query() : 
</span><span class="cm">    * return javaBean
</span><span class="cm">    */</span> 
    <span class="kd">public</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">queryForOne</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">,</span> <span class="n">String</span> <span class="n">sql</span><span class="o">,</span> <span class="n">Object</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Connection</span> <span class="n">con</span> <span class="o">=</span> <span class="n">JdbcUtils</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">queryRunner</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">con</span><span class="o">,</span> <span class="n">sql</span><span class="o">,</span> <span class="k">new</span> <span class="n">BeanHandler</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;(</span><span class="n">type</span><span class="o">),</span> <span class="n">args</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">JdbcUtils</span><span class="o">.</span><span class="na">close</span><span class="o">(</span><span class="n">connection</span><span class="o">);</span>
        <span class="o">}</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    
     <span class="cm">/**
</span><span class="cm">    * query() : 
</span><span class="cm">    * return multiplate javaBean
</span><span class="cm">    */</span> 
    <span class="kd">public</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">queryForList</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">,</span> <span class="n">String</span> <span class="n">sql</span><span class="o">,</span> <span class="n">Object</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Connection</span> <span class="n">con</span> <span class="o">=</span> <span class="n">JdbcUtils</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">queryRunner</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">con</span><span class="o">,</span> <span class="n">sql</span><span class="o">,</span> <span class="k">new</span> <span class="n">BeanListHandler</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;(</span><span class="n">type</span><span class="o">),</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
</span><span class="cm">    * query() : 
</span><span class="cm">    * return sql
</span><span class="cm">    */</span> 
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">queryForSingleValue</span><span class="o">(</span><span class="n">String</span> <span class="n">sql</span><span class="o">,</span> <span class="n">Object</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">JdbcUtils</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">queryRunner</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">conn</span><span class="o">,</span> <span class="n">sql</span><span class="o">,</span> <span class="k">new</span> <span class="n">ScalarHandler</span><span class="o">(),</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>

</code></pre></div><h4 id="sp5-userdao--test">sp5. UserDao &amp;&amp; test</h4>
<p><a id="markdown-sp5.-userdao-%26%26-test" name="sp5.-userdao-%26%26-test"></a></p>
<ul>
<li>UserDao interface</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="n">intercface</span> <span class="n">UserDao</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">    * @param username
</span><span class="cm">    * 
</span><span class="cm">    */</span> 
    <span class="kd">public</span> <span class="n">User</span> <span class="nf">queryUserByUsername</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">User</span> <span class="nf">queryUserByUsernameAndPassword</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">,</span> <span class="n">String</span> <span class="n">password</span><span class="o">);</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">saveUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><ul>
<li>UserDaoImpl</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDaoImpl</span> <span class="n">extend</span> <span class="n">BaseDap</span> <span class="kd">implements</span> <span class="n">UserDao</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">    * @param username
</span><span class="cm">    * 
</span><span class="cm">    */</span> 
    <span class="kd">public</span> <span class="n">User</span> <span class="nf">queryUserByUsername</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">&#34;select `id`,`username`,`password`,`email` from t_user where username = ?&#34;</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">queryForOne</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">sql</span><span class="o">,</span> <span class="n">username</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">User</span> <span class="nf">queryUserByUsernameAndPassword</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">,</span> <span class="n">String</span> <span class="n">password</span><span class="o">){</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">saveUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">){</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div><ul>
<li>UserDao test</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">UserDao</span> <span class="n">userDao</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UserDaoImpl</span><span class="o">();</span>
<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">queryUserByUsername</span><span class="o">()</span> <span class="o">{</span>
<span class="k">if</span> <span class="o">(</span><span class="n">userDao</span><span class="o">.</span><span class="na">queryUserByUsername</span><span class="o">(</span><span class="s">&#34;admin1234&#34;</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">){</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;aaaaaa！&#34;</span><span class="o">);</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;bbbbbbbbb&#34;</span><span class="o">);</span>
<span class="o">}</span>

</code></pre></div><h4 id="sp6-userservice--test">sp6. UserService &amp;&amp; test</h4>
<p><a id="markdown-sp6.-userservice-%26%26-test" name="sp6.-userservice-%26%26-test"></a></p>
<ul>
<li>UserService interface</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="n">intercface</span> <span class="n">UserService</span> <span class="o">{</span>
    <span class="cm">/**
</span><span class="cm">    * @param username
</span><span class="cm">    * 
</span><span class="cm">    */</span> 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">registUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>

    <span class="kd">public</span> <span class="n">User</span> <span class="nf">login</span><span class="o">(</span><span class="n">User</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">existsUsername</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><ul>
<li>
<p>UserServiceImpl</p>
</li>
<li>
<p>UserService test</p>
</li>
</ul>
<h4 id="sp7-web">sp7. web</h4>
<p><a id="markdown-sp7.-web" name="sp7.-web"></a></p>
<ul>
<li>
<p>regist</p>
<ul>
<li>
<p>when user finish regist, click sumbit button, send the parameter to service and save user data</p>
</li>
<li>
<p>modify regist.html and regist_success.html page</p>
</li>
<li>
<p>RegistServlet</p>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">RegistServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="n">UserService</span> <span class="n">userService</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UserServiceImpl</span><span class="o">();</span>

        <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doPost</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span>
<span class="n">IOException</span> <span class="o">{</span>

            <span class="c1">// 1. get parameter
</span><span class="c1"></span>            <span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">email</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;email&#34;</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">code</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;code&#34;</span><span class="o">);</span>

            <span class="c1">// 2. check the code
</span><span class="c1"></span>            <span class="k">if</span> <span class="o">(</span><span class="s">&#34;abcde&#34;</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">code</span><span class="o">))</span> <span class="o">{</span>
            <span class="c1">// 3、check the username
</span><span class="c1"></span>            <span class="k">if</span> <span class="o">(</span><span class="n">userService</span><span class="o">.</span><span class="na">existsUsername</span><span class="o">(</span><span class="n">username</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;username[&#34;</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s">&#34;]exist!&#34;</span><span class="o">);</span>
                <span class="c1">// back to regist page
</span><span class="c1"></span>                <span class="n">req</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="s">&#34;/pages/user/regist.html&#34;</span><span class="o">).</span><span class="na">forward</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">resp</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="c1">// available
</span><span class="c1"></span>            <span class="c1">// invoke Sservice save to SQL database
</span><span class="c1"></span>                <span class="n">userService</span><span class="o">.</span><span class="na">registUser</span><span class="o">(</span><span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="n">username</span><span class="o">,</span> <span class="n">password</span><span class="o">,</span> <span class="n">email</span><span class="o">));</span>
                <span class="c1">// go to the regist_success.html
</span><span class="c1"></span>                <span class="n">req</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="s">&#34;/pages/user/regist_success.html&#34;</span><span class="o">).</span><span class="na">forward</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">resp</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;code[&#34;</span> <span class="o">+</span> <span class="n">code</span> <span class="o">+</span> <span class="s">&#34;]error&#34;</span><span class="o">);</span>
                <span class="n">req</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="s">&#34;/pages/user/regist.html&#34;</span><span class="o">).</span><span class="na">forward</span><span class="o">(</span><span class="n">req</span><span class="o">,</span> <span class="n">resp</span><span class="o">);</span>
            <span class="o">}</span>
<span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="file-upload-and-download">file upload and download</h3>
<p><a id="markdown-file-upload-and-download" name="file-upload-and-download"></a></p>
<h4 id="file-upload">file upload</h4>
<p><a id="markdown-file-upload" name="file-upload"></a></p>
<ul>
<li>form, method = post</li>
<li>form encType: multipart/form-data</li>
<li>form input type=file</li>
<li>servlet reveice and deal with data upload</li>
</ul>
<h4 id="commos-fileuploadjar">commos-fileupload.jar</h4>
<p><a id="markdown-commos-fileupload.jar" name="commos-fileupload.jar"></a></p>
<ul>
<li>commons-fileupload-x.x.x.jar</li>
<li>commons-io-x.x.jar</li>
</ul>
<p>These two jars contains classes we can use:</p>
<ul>
<li>ServletFileUpload: decode upload data</li>
<li>boolean ServletFileUpload.isMultipartContent(HttpServletRequest request);</li>
<li>public List<FileItem> parseRequest(HttpServletRequest request);</li>
<li>boolean FileItem.isFormField(), check is ordinary form or not</li>
<li>String FileItem.getFieldName()</li>
<li>String FileItem.getString()</li>
<li>String FileItem.getName()</li>
<li>void FileItem.write(file)</li>
</ul>
<h4 id="fileupload">fileupload</h4>
<p><a id="markdown-fileupload" name="fileupload"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="o">&lt;</span><span class="nx">form</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&#34;http://192.168.1.68://8080/book/uploadServlet&#34;</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&#34;post&#34;</span> <span class="nx">enctype</span><span class="o">=</span><span class="s2">&#34;multipart/form-data&#34;</span><span class="o">&gt;</span>
<span class="nx">username</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;text&#34;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&#34;username&#34;</span> <span class="o">/&gt;&lt;</span><span class="nx">br</span><span class="o">&gt;</span>
<span class="nx">username</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;file&#34;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&#34;photo&#34;</span> <span class="o">/&gt;&lt;</span><span class="nx">br</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;submit&#34;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&#34;upload&#34;</span> <span class="o">/&gt;&lt;</span><span class="nx">br</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="err">/form&gt;</span>
</code></pre></div><p>decode data upload</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm">* @param req
</span><span class="cm">* @param resp
</span><span class="cm">* @throws ServletException
</span><span class="cm">* @throws IOException
</span><span class="cm">*/</span>
<span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doPost</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span>
<span class="n">IOException</span> <span class="o">{</span>
    <span class="c1">// 1. check the data is multipart
</span><span class="c1"></span>    <span class="k">if</span> <span class="o">(</span><span class="n">ServletFileUpload</span><span class="o">.</span><span class="na">isMultipartContent</span><span class="o">(</span><span class="n">req</span><span class="o">))</span> <span class="o">{</span>
        <span class="n">FileItemFactroy</span> <span class="n">fileItemFactroy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DiskFileItemFactory</span><span class="o">();</span>
        <span class="n">ServletFileUpload</span> <span class="n">servletFileUpload</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServletFileUpload</span><span class="o">(</span><span class="n">fileItemFactroy</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="c1">// decode data, get FileItem
</span><span class="c1"></span>            <span class="n">List</span><span class="o">&lt;</span><span class="n">FileItem</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">servletFileUpload</span><span class="o">.</span><span class="na">parseRequest</span><span class="o">(</span><span class="n">req</span><span class="o">);</span>

            <span class="k">for</span> <span class="o">(</span><span class="n">FileItem</span> <span class="n">fileItem</span> <span class="o">:</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">fileItem</span><span class="o">.</span><span class="na">isFormField</span><span class="o">())</span> <span class="o">{</span>
                  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34; name value：&#34;</span> <span class="o">+</span> <span class="n">fileItem</span><span class="o">.</span><span class="na">getFieldName</span><span class="o">());</span>
                    <span class="c1">// 参数 UTF-8.解决乱码问题
</span><span class="c1"></span>                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;form value value：&#34;</span> <span class="o">+</span> <span class="n">fileItem</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&#34;UTF-8&#34;</span><span class="o">));</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="c1">// 上传的文件
</span><span class="c1"></span>                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;name value：&#34;</span> <span class="o">+</span> <span class="n">fileItem</span><span class="o">.</span><span class="na">getFieldName</span><span class="o">());</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;upload file name：&#34;</span> <span class="o">+</span> <span class="n">fileItem</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
                <span class="n">fileItem</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&#34;e:\\&#34;</span> <span class="o">+</span> <span class="n">fileItem</span><span class="o">.</span><span class="na">getName</span><span class="o">()));</span>
            <span class="o">}</span>
        <span class="o">}</span>
<span class="o">}</span>
         
</code></pre></div><h4 id="file-download">file download</h4>
<p><a id="markdown-file-download" name="file-download"></a></p>
<ul>
<li>response.getOutputStream();</li>
<li>servletContext.getResourceAsStream();</li>
<li>servletContext.getMimeType();</li>
<li>response.getContentType();</li>
<li>response.setHeader(&ldquo;Content-Disposition&rdquo;, &ldquo;attachment;fileName=1.jpg&rdquo;);</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">String</span> <span class="n">us</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">&#34;User-Agent&#34;</span><span class="o">);</span>
<span class="c1">// whether is Fire fox web 
</span><span class="c1"></span><span class="k">if</span> <span class="o">(</span><span class="n">us</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&#34;Firefox&#34;</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">&#34;attachment;fileName&#34;</span> <span class="o">+</span> <span class="s">&#34;=?utf-8?B?&#34;</span> <span class="o">+</span> <span class="k">new</span> <span class="n">BASE64Encoder</span><span class="o">().</span><span class="na">encode</span><span class="o">(</span><span class="s">&#34;中文.jpg&#34;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s">&#34;utf-8&#34;</span><span class="o">))</span>
    <span class="o">+</span> <span class="s">&#34;?=&#34;</span><span class="o">;</span> 
    <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">&#34;Content-Disposition&#34;</span><span class="o">,</span> <span class="n">str</span><span class="o">);</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
     <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">&#34;attachment;fileName&#34;</span> <span class="o">+</span> <span class="n">URLEncode</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="s">&#34;中文.jpg&#34;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="s">&#34;utf-8&#34;</span><span class="o">))</span>
    <span class="o">+</span> <span class="s">&#34;?=&#34;</span><span class="o">;</span> 
    <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">&#34;Content-Disposition&#34;</span><span class="o">,</span> <span class="n">str</span><span class="o">);</span>
<span class="o">}</span>

</code></pre></div><h3 id="cookie--session">Cookie &amp;&amp; Session</h3>
<p><a id="markdown-cookie-%26%26-session" name="cookie-%26%26-session"></a></p>
<h4 id="use-cookie-to-save-users-information">use Cookie to save user&rsquo;s information</h4>
<p><a id="markdown-use-cookie-to-save-user's-information" name="use-cookie-to-save-user's-information"></a></p>
<p>chorme:              the first time                 tomcat</p>
<ul>
<li>
<p>usename:      〰️ ▶️        login.jsp</p>
</li>
<li>
<p>password      ◀️ 〰️
back to login page</p>
</li>
<li>
<p>submit        〰️ ▶️        LoginServlet
1. get username and password
2. validate</p>
</li>
</ul>
<p>.                                                   ❌  not allow to login
display username       Set-Cookie:username
◀️ 〰️       ✔️: save username as Cookie send to server</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="o">&lt;</span><span class="n">form</span> <span class="n">action</span><span class="o">=</span><span class="s">&#34;http://localhost:8080/13_cookie_session/loginServlet&#34;</span> <span class="n">method</span><span class="o">=</span><span class="s">&#34;get&#34;</span><span class="o">&gt;</span>
<span class="n">用户名</span><span class="err">：</span><span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="n">name</span><span class="o">=</span><span class="s">&#34;username&#34;</span> <span class="n">value</span><span class="o">=</span><span class="s">&#34;${cookie.username.value}&#34;</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span>
<span class="n">密码</span><span class="err">：</span><span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="n">name</span><span class="o">=</span><span class="s">&#34;password&#34;</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">input</span> <span class="n">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="n">value</span><span class="o">=</span><span class="s">&#34;登录&#34;</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</code></pre></div><p>LoginServlet</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span>
<span class="n">IOException</span> <span class="o">{</span>
<span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">);</span>
<span class="k">if</span> <span class="o">(</span><span class="s">&#34;wzg168&#34;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">username</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="s">&#34;123456&#34;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">password</span><span class="o">))</span> <span class="o">{</span>
<span class="c1">//login success
</span><span class="c1"></span><span class="n">Cookie</span> <span class="n">cookie</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cookie</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">,</span> <span class="n">username</span><span class="o">);</span>
<span class="n">cookie</span><span class="o">.</span><span class="na">setMaxAge</span><span class="o">(</span><span class="n">60</span> <span class="o">*</span> <span class="n">60</span> <span class="o">*</span> <span class="n">24</span> <span class="o">*</span> <span class="n">7</span><span class="o">);</span><span class="c1">// cookie is available in a week
</span><span class="c1"></span><span class="n">resp</span><span class="o">.</span><span class="na">addCookie</span><span class="o">(</span><span class="n">cookie</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;login success&#34;</span><span class="o">);</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
<span class="c1">// login fails
</span><span class="c1"></span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;login fails&#34;</span><span class="o">);</span>
<span class="o">}</span>
<span class="o">}</span>

</code></pre></div><h4 id="session-to-invalidate-the-user-infomation">Session to invalidate the user infomation</h4>
<p><a id="markdown-session-to-invalidate-the-user-infomation" name="session-to-invalidate-the-user-infomation"></a></p>
<p>UserServlet</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">logout</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span>
<span class="n">IOException</span> <span class="o">{</span>
<span class="c1">// 1、invalidate Session username
</span><span class="c1"></span><span class="n">req</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">invalidate</span><span class="o">();</span>
<span class="c1">// 2、redirect to login page
</span><span class="c1"></span><span class="n">resp</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="n">req</span><span class="o">.</span><span class="na">getContextPath</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div><h3 id="order-module">Order module</h3>
<p><a id="markdown-order-module" name="order-module"></a></p>
<h4 id="order-page">Order page</h4>
<p><a id="markdown-order-page" name="order-page"></a></p>
<p><strong>Order page</strong></p>
<ul>
<li>orderId</li>
<li>createTime</li>
<li>price</li>
<li>status</li>
<li>userId</li>
</ul>
<p><strong>Order Item</strong></p>
<ul>
<li>id</li>
<li>name</li>
<li>count</li>
<li>price</li>
<li>totalPrice</li>
<li>orderId</li>
</ul>
<p><strong>Order function</strong></p>
<ul>
<li>create order</li>
<li>show all orders</li>
<li>send order</li>
<li>show my order</li>
<li>totalPrice</li>
<li>receive order</li>
</ul>
<p><strong>Order Servlet</strong></p>
<p><strong>OrderService</strong></p>
<p><strong>OrderDao</strong></p>
<ul>
<li>saveOrder(order)</li>
<li>queryOrders()</li>
<li>changeOrderStatus(OrderId, status);</li>
<li>queryOrderByUserId(userId);</li>
</ul>
<p><strong>OrderItemDao</strong></p>
<ul>
<li>saveOrderItem(orderItem)</li>
<li>queryOrdersItemByOrderId(orderId)</li>
</ul>
<h3 id="filter">Filter</h3>
<p><a id="markdown-filter" name="filter"></a></p>
<figure><img src="/images/jwb9.png"
         alt="image"/><figcaption>
            <h4>servlets</h4>
        </figcaption>
</figure>

<blockquote>
<p>A -&gt;B -&gt; C demo3.service() -&gt; C -&gt; B -&gt; A</p>
</blockquote>
<h4 id="过滤器-filter">过滤器 Filter</h4>
<p><a id="markdown-%E8%BF%87%E6%BB%A4%E5%99%A8-filter" name="%E8%BF%87%E6%BB%A4%E5%99%A8-filter"></a></p>
<ul>
<li>
<p>Filter 也属于 Servlet 规范</p>
</li>
<li>
<p>Filter 开发步骤：新建类实现 Filter 接口，然后实现其中的三个方法：init、doFilter、destroy<br>
配置 Filter，可以用注解@WebFilter，也可以使用 xml 文件 <filter> <filter-mapping></p>
</li>
<li>
<p>Filter 在配置时，和 servlet 一样，也可以配置通配符，例如 @WebFilter(&quot;*.do&quot;)表示拦截所有以.do 结尾的请求</p>
</li>
<li>
<p>过滤器链</p>
<ul>
<li>执行的顺序依次是： A B C demo03 C2 B2 A2</li>
<li>如果采取的是注解的方式进行配置，那么过滤器链的拦截顺序是按照全类名的先后顺序排序的</li>
<li>如果采取的是 xml 的方式进行配置，那么按照配置的先后顺序进行排序</li>
</ul>
</li>
</ul>
<p>chorme:                                                               tomcat</p>
<ul>
<li>http://ip:port/project/resource  〰️ ▶️ Filter                         target rescouce
.                                                             authorized   ▶️   html, jsp, Servlet</li>
</ul>
<p>.                                 ◀️ 〰️ unauthorized</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@WebFilter</span><span class="o">(</span><span class="n">filterName</span> <span class="o">=</span><span class="s">&#34;ManagerFilter&#34;</span><span class="o">,</span> <span class="n">urlPatterns</span> <span class="o">=</span> <span class="o">{</span><span class="s">&#34;/pages/manager/*&#34;</span><span class="o">,</span> <span class="s">&#34;/manager/bookServlet&#34;</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AdminFilter</span> <span class="kd">implements</span> <span class="n">Filter</span> <span class="o">{</span>
<span class="cm">/**
</span><span class="cm">* doFilter method
</span><span class="cm">*/</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="n">ServletRequest</span> <span class="n">servletRequest</span><span class="o">,</span> <span class="n">ServletResponse</span> <span class="n">servletResponse</span><span class="o">,</span> <span class="n">FilterChain</span>
<span class="n">filterChain</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span> <span class="o">{</span>
<span class="n">HttpServletRequest</span> <span class="n">httpServletRequest</span> <span class="o">=</span> <span class="o">(</span><span class="n">HttpServletRequest</span><span class="o">)</span> <span class="n">servletRequest</span><span class="o">;</span>
<span class="n">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">httpServletRequest</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
<span class="n">Object</span> <span class="n">user</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">);</span>
<span class="c1">// 
</span><span class="c1"></span><span class="k">if</span> <span class="o">(</span><span class="n">user</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
<span class="n">servletRequest</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="s">&#34;/login.jsp&#34;</span><span class="o">).</span><span class="na">forward</span><span class="o">(</span><span class="n">servletRequest</span><span class="o">,</span><span class="n">servletResponse</span><span class="o">);</span>
<span class="k">return</span><span class="o">;</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
<span class="c1">// 
</span><span class="c1"></span><span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">servletRequest</span><span class="o">,</span><span class="n">servletResponse</span><span class="o">);</span>
<span class="o">}</span>
<span class="o">}</span>
<span class="o">}</span>
</code></pre></div><h3 id="事务管理">事务管理</h3>
<p><a id="markdown-%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86" name="%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"></a></p>
<h4 id="涉及到的组件">涉及到的组件</h4>
<p><a id="markdown-%E6%B6%89%E5%8F%8A%E5%88%B0%E7%9A%84%E7%BB%84%E4%BB%B6" name="%E6%B6%89%E5%8F%8A%E5%88%B0%E7%9A%84%E7%BB%84%E4%BB%B6"></a></p>
<ul>
<li>OpenSessionInViewFilter</li>
<li>TransactionManager</li>
<li>ThreadLocal</li>
<li>ConnUtil</li>
<li>BaseDAO</li>
</ul>
<h4 id="threadlocal">ThreadLocal</h4>
<p><a id="markdown-threadlocal" name="threadlocal"></a></p>
<ul>
<li>get() , set(obj)</li>
<li>ThreadLocal 称之为本地线程 。 我们可以通过 set 方法在当前线程上存储数据、通过 get 方法在当前线程上获取数据</li>
<li>set 方法源码分析：</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">set</span><span class="o">(</span><span class="n">T</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
         <span class="n">Thread</span> <span class="n">t</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">();</span> <span class="c1">//获取当前的线程
</span><span class="c1"></span>         <span class="n">ThreadLocalMap</span> <span class="n">map</span> <span class="o">=</span> <span class="n">getMap</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>    <span class="c1">//每一个线程都维护各自的一个容器（ThreadLocalMap）
</span><span class="c1"></span>         <span class="k">if</span> <span class="o">(</span><span class="n">map</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
             <span class="n">map</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>          <span class="c1">//这里的key对应的是ThreadLocal，因为我们的组件中需要传输（共享）的对象可能会有多个（不止Connection）
</span><span class="c1"></span>         <span class="k">else</span>
             <span class="n">createMap</span><span class="o">(</span><span class="n">t</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>           <span class="c1">//默认情况下map是没有初始化的，那么第一次往其中添加数据时，会去初始化
</span><span class="c1"></span>     <span class="o">}</span>
</code></pre></div><ul>
<li>get 方法源码分析</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">     <span class="kd">public</span> <span class="n">T</span> <span class="nf">get</span><span class="o">()</span> <span class="o">{</span>
         <span class="n">Thread</span> <span class="n">t</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">();</span> <span class="c1">//获取当前的线程
</span><span class="c1"></span>         <span class="n">ThreadLocalMap</span> <span class="n">map</span> <span class="o">=</span> <span class="n">getMap</span><span class="o">(</span><span class="n">t</span><span class="o">);</span>    <span class="c1">//获取和这个线程（企业）相关的ThreadLocalMap（也就是工作纽带的集合）
</span><span class="c1"></span>         <span class="k">if</span> <span class="o">(</span><span class="n">map</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
             <span class="n">ThreadLocalMap</span><span class="o">.</span><span class="na">Entry</span> <span class="n">e</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">getEntry</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>   <span class="c1">//this指的是ThreadLocal对象，通过它才能知道是哪一个工作纽带
</span><span class="c1"></span>             <span class="k">if</span> <span class="o">(</span><span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                 <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&#34;unchecked&#34;</span><span class="o">)</span>
                 <span class="n">T</span> <span class="n">result</span> <span class="o">=</span> <span class="o">(</span><span class="n">T</span><span class="o">)</span><span class="n">e</span><span class="o">.</span><span class="na">value</span><span class="o">;</span>     <span class="c1">//entry.value就可以获取到工具箱了
</span><span class="c1"></span>                 <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
             <span class="o">}</span>
         <span class="o">}</span>
         <span class="k">return</span> <span class="n">setInitialValue</span><span class="o">();</span>
     <span class="o">}</span>
</code></pre></div><figure><img src="/images/jwb10.png"
         alt="image"/><figcaption>
            <h4>servlets</h4>
        </figcaption>
</figure>

<figure><img src="/images/jwb11.png"
         alt="image"/><figcaption>
            <h4>servlets</h4>
        </figcaption>
</figure>

<figure><img src="/images/jwb12.png"
         alt="image"/><figcaption>
            <h4>servlets</h4>
        </figcaption>
</figure>

<h4 id="threadlocal-and-filter-manage-transactions">ThreadLocal and Filter manage transactions</h4>
<p><a id="markdown-threadlocal-and-filter-manage-transactions" name="threadlocal-and-filter-manage-transactions"></a></p>
<h4 id="modify-jdbcutils">modify JdbcUtils</h4>
<p><a id="markdown-modify-jdbcutils" name="modify-jdbcutils"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kd">static</span> <span class="n">ThreadLocal</span><span class="o">&lt;</span><span class="n">Connection</span><span class="o">&gt;</span> <span class="n">conns</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ThreadLocal</span><span class="o">&lt;&gt;();</span>
<span class="c1">//  Connection conn = null;
</span><span class="c1"></span><span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">conns</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</code></pre></div><h4 id="basedao">BaseDao</h4>
<p><a id="markdown-basedao" name="basedao"></a></p>
<h4 id="filter-add-try-catch-to-service">Filter add try-catch to Service</h4>
<p><a id="markdown-filter-add-try-catch-to-service" name="filter-add-try-catch-to-service"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@WebFilter</span><span class="o">(</span><span class="n">filterName</span> <span class="o">=</span><span class="s">&#34;TransactionFilter&#34;</span><span class="o">,</span> <span class="n">urlPatterns</span> <span class="o">=</span> <span class="s">&#34;/*&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TransactionFilter</span> <span class="kd">implements</span> <span class="n">Filter</span> <span class="o">{</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="n">ServletRequest</span> <span class="n">servletRequest</span><span class="o">,</span> <span class="n">ServletResponse</span> <span class="n">servletResponse</span><span class="o">,</span> <span class="n">FilterChain</span>
<span class="n">filterChain</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span> <span class="o">{</span>
<span class="k">try</span> <span class="o">{</span>
<span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">servletRequest</span><span class="o">,</span><span class="n">servletResponse</span><span class="o">);</span>
<span class="n">JdbcUtils</span><span class="o">.</span><span class="na">commitAndClose</span><span class="o">();</span><span class="c1">// 提交事务
</span><span class="c1"></span><span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="n">JdbcUtils</span><span class="o">.</span><span class="na">rollbackAndClose</span><span class="o">();</span><span class="c1">//回滚事务
</span><span class="c1"></span><span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="o">}</span>
<span class="o">}</span>

</code></pre></div><h4 id="throw-new-runexception-in-baseservlet-to-filter">throw new RunException() in BaseServlet to Filter</h4>
<p><a id="markdown-throw-new-runexception-in-baseservlet-to-filter" name="throw-new-runexception-in-baseservlet-to-filter"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">BaseServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>
<span class="k">try</span> <span class="o">{</span>
<span class="c1">// 
</span><span class="c1"></span><span class="n">Method</span> <span class="n">method</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredMethod</span><span class="o">(</span><span class="n">action</span><span class="o">,</span> <span class="n">HttpServletRequest</span><span class="o">.</span><span class="na">class</span><span class="o">,</span>
<span class="n">HttpServletResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="c1">// System.out.println(method);
</span><span class="c1">// 
</span><span class="c1"></span><span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">req</span><span class="o">,</span> <span class="n">resp</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
<span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span><span class="c1">// throw new RunException Filter 
</span><span class="c1"></span><span class="o">}</span>
<span class="o">}</span>

</code></pre></div><h4 id="tomcat-display-error-page">tomcat display error page</h4>
<p><a id="markdown-tomcat-display-error-page" name="tomcat-display-error-page"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="o">&lt;</span><span class="n">error</span><span class="o">-</span><span class="n">page</span><span class="o">&gt;</span>
<span class="o">&lt;!--</span><span class="n">error</span><span class="o">-</span><span class="n">code</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="n">error</span><span class="o">-</span><span class="n">code</span><span class="o">&gt;</span><span class="n">500</span><span class="o">&lt;/</span><span class="n">error</span><span class="o">-</span><span class="n">code</span><span class="o">&gt;</span>
<span class="o">&lt;!--</span><span class="n">location</span><span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="n">location</span><span class="o">&gt;/</span><span class="n">pages</span><span class="o">/</span><span class="n">error</span><span class="o">/</span><span class="n">error500</span><span class="o">.</span><span class="na">jsp</span><span class="o">&lt;/</span><span class="n">location</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">error</span><span class="o">-</span><span class="n">page</span><span class="o">&gt;</span>
<span class="o">&lt;!--</span><span class="n">error</span><span class="o">-</span><span class="n">page</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="n">error</span><span class="o">-</span><span class="n">page</span><span class="o">&gt;</span>
<span class="o">&lt;!--</span><span class="n">error</span><span class="o">-</span><span class="n">code</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="n">error</span><span class="o">-</span><span class="n">code</span><span class="o">&gt;</span><span class="n">404</span><span class="o">&lt;/</span><span class="n">error</span><span class="o">-</span><span class="n">code</span><span class="o">&gt;</span>
<span class="o">&lt;!--</span><span class="n">location</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="n">location</span><span class="o">&gt;/</span><span class="n">pages</span><span class="o">/</span><span class="n">error</span><span class="o">/</span><span class="n">error404</span><span class="o">.</span><span class="na">jsp</span><span class="o">&lt;/</span><span class="n">location</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">error</span><span class="o">-</span><span class="n">page</span><span class="o">&gt;</span>
</code></pre></div><h3 id="listener">listener</h3>
<p><a id="markdown-listener" name="listener"></a></p>
<ul>
<li>ServletContextListener - 监听 ServletContext 对象的创建和销毁的过程</li>
<li>HttpSessionListener - 监听 HttpSession 对象的创建和销毁的过程</li>
<li>ServletRequestListener - 监听 ServletRequest 对象的创建和销毁的过程</li>
<li>ServletContextAttributeListener - 监听 ServletContext 的保存作用域的改动(add,remove,replace)</li>
<li>HttpSessionAttributeListener - 监听 HttpSession 的保存作用域的改动(add,remove,replace)</li>
<li>ServletRequestAttributeListener - 监听 ServletRequest 的保存作用域的改动(add,remove,replace)</li>
<li>HttpSessionBindingListener - 监听某个对象在 Session 域中的创建与移除</li>
<li>HttpSessionActivationListener - 监听某个对象在 Session 域中的序列化和反序列化</li>
</ul>
<h4 id="contextloaderlistener">ContextLoaderListener</h4>
<p><a id="markdown-contextloaderlistener" name="contextloaderlistener"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">
<span class="c1">//监听上下文启动，在上下文启动的时候去创建IOC容器,然后将其保存到application作用域
</span><span class="c1">//后面中央控制器再从application作用域中去获取IOC容器
</span><span class="c1"></span><span class="nd">@WebListener</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ContextLoaderListener</span> <span class="kd">implements</span> <span class="n">ServletContextListener</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">contextInitialized</span><span class="o">(</span><span class="n">ServletContextEvent</span> <span class="n">servletContextEvent</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//1.获取ServletContext对象
</span><span class="c1"></span>        <span class="n">ServletContext</span> <span class="n">application</span> <span class="o">=</span> <span class="n">servletContextEvent</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">();</span>
        <span class="c1">//2.获取上下文的初始化参数
</span><span class="c1"></span>        <span class="n">String</span> <span class="n">path</span> <span class="o">=</span> <span class="n">application</span><span class="o">.</span><span class="na">getInitParameter</span><span class="o">(</span><span class="s">&#34;contextConfigLocation&#34;</span><span class="o">);</span>
        <span class="c1">//3.创建IOC容器
</span><span class="c1"></span>        <span class="n">BeanFactory</span> <span class="n">beanFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>
        <span class="c1">//4.将IOC容器保存到application作用域
</span><span class="c1"></span>        <span class="n">application</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;beanFactory&#34;</span><span class="o">,</span><span class="n">beanFactory</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">contextDestroyed</span><span class="o">(</span><span class="n">ServletContextEvent</span> <span class="n">servletContextEvent</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div><figure><img src="/images/jwb13.png"
         alt="image"/><figcaption>
            <h4>servlets</h4>
        </figcaption>
</figure>

<h3 id="json">JSON</h3>
<p><a id="markdown-json" name="json"></a></p>
<h4 id="json--javabean">JSON &amp;&amp; JavaBean</h4>
<p><a id="markdown-json-%26%26-javabean" name="json-%26%26-javabean"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="n">1</span><span class="o">,</span><span class="s">&#34;AA&#34;</span><span class="o">);</span>
<span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Gson</span><span class="o">();</span>
<span class="n">String</span> <span class="n">personJsonString</span> <span class="o">=</span> <span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">person</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">personJsonString</span><span class="o">);</span>

<span class="n">Person</span> <span class="n">person1</span> <span class="o">=</span> <span class="n">gson</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">personJsonString</span><span class="o">,</span> <span class="n">Person</span><span class="o">.</span><span class="na">class</span>
</code></pre></div><h4 id="json--list">JSON &amp;&amp; List</h4>
<p><a id="markdown-json-%26%26-list" name="json-%26%26-list"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">personList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
<span class="n">personList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="s">&#34;AA&#34;</span><span class="o">));</span>
<span class="n">personList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="n">2</span><span class="o">,</span> <span class="s">&#34;BB&#34;</span><span class="o">));</span>

<span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Gson</span><span class="o">();</span>
<span class="c1">// transfer to json string
</span><span class="c1"></span><span class="n">String</span> <span class="n">personJsonString</span> <span class="o">=</span> <span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">personList</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">personJsonString</span><span class="o">);</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">gson</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">personJsonString</span><span class="o">,</span> <span class="k">new</span> <span class="n">PersonListType</span><span class="o">().</span><span class="na">getType</span><span class="o">());</span>
</code></pre></div><h4 id="json--map">JSON &amp;&amp; Map</h4>
<p><a id="markdown-json-%26%26-map" name="json-%26%26-map"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">personMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;()</span>
<span class="n">personList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="s">&#34;AA&#34;</span><span class="o">));</span>
<span class="n">personList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="n">2</span><span class="o">,</span> <span class="s">&#34;BB&#34;</span><span class="o">));</span>

<span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Gson</span><span class="o">();</span>
<span class="c1">// transfer to json string
</span><span class="c1"></span><span class="n">String</span> <span class="n">personJsonString</span> <span class="o">=</span> <span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">personMap</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">personJsonString</span><span class="o">);</span>

<span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Person</span><span class="o">&gt;</span> <span class="n">personMap2</span> <span class="o">=</span> <span class="n">gson</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">personJsonString</span><span class="o">,</span> <span class="k">new</span> <span class="n">TypeToken</span><span class="o">&lt;</span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span><span class="n">Person</span><span class="o">&gt;&gt;(){}.</span><span class="na">getType</span><span class="o">());</span>
</code></pre></div><h3 id="ajax">AJAX</h3>
<p><a id="markdown-ajax" name="ajax"></a></p>
<h3 id="use-ajax-invalidate-the-username">use AJAX invalidate the username</h3>
<p><a id="markdown-use-ajax-invalidate-the-username" name="use-ajax-invalidate-the-username"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">ajaxExistsUsername</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span>
<span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
<span class="c1">// get username
</span><span class="c1"></span><span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">);</span>
<span class="c1">//  userService.existsUsername();
</span><span class="c1"></span><span class="kt">boolean</span> <span class="n">existsUsername</span> <span class="o">=</span> <span class="n">userService</span><span class="o">.</span><span class="na">existsUsername</span><span class="o">(</span><span class="n">username</span><span class="o">);</span>
<span class="c1">// 
</span><span class="c1"></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">resultMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
<span class="n">resultMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;existsUsername&#34;</span><span class="o">,</span><span class="n">existsUsername</span><span class="o">);</span>
<span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Gson</span><span class="o">();</span>
<span class="n">String</span> <span class="n">json</span> <span class="o">=</span> <span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">resultMap</span><span class="o">);</span>
<span class="n">resp</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="n">json</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="n">$</span><span class="o">(</span><span class="s">&#34;#username&#34;</span><span class="o">).</span><span class="na">blur</span><span class="o">(</span><span class="n">function</span> <span class="o">()</span> <span class="o">{</span>
<span class="c1">//1 get username
</span><span class="c1"></span><span class="n">var</span> <span class="n">username</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">value</span><span class="o">;</span>
<span class="n">$</span><span class="o">.</span><span class="na">getJSON</span><span class="o">(</span><span class="s">&#34;http://localhost:8080/book/userServlet&#34;</span><span class="o">,</span><span class="s">&#34;action=ajaxExistsUsername&amp;username=&#34;</span> <span class="o">+</span>
<span class="n">username</span><span class="o">,</span><span class="n">function</span> <span class="o">(</span><span class="n">data</span><span class="o">)</span> <span class="o">{</span>
<span class="k">if</span> <span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">existsUsername</span><span class="o">)</span> <span class="o">{</span>
<span class="n">$</span><span class="o">(</span><span class="s">&#34;span.errorMsg&#34;</span><span class="o">).</span><span class="na">text</span><span class="o">(</span><span class="s">&#34;xxxx！&#34;</span><span class="o">);</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
<span class="n">$</span><span class="o">(</span><span class="s">&#34;span.errorMsg&#34;</span><span class="o">).</span><span class="na">text</span><span class="o">(</span><span class="s">&#34;xxxx！&#34;</span><span class="o">);</span>
<span class="o">}</span>
<span class="o">});</span>
<span class="o">});</span>
</code></pre></div><h3 id="use-ajax-to-add-the-item-to-the-cart">use AJAX to add the item to the cart</h3>
<p><a id="markdown-use-ajax-to-add-the-item-to-the-cart" name="use-ajax-to-add-the-item-to-the-cart"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">addItem</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>

<span class="c1">//        System.out.println(&#34;bookId: &#34; + request.getParameter(&#34;id&#34;));
</span><span class="c1"></span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;request head reference value: &#34;</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">&#34;Referer&#34;</span><span class="o">));</span>
<span class="c1">//        2.1 : 获取请求的参数，商品编号
</span><span class="c1"></span>        <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">WebUtils</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">),</span> <span class="n">0</span><span class="o">);</span>
<span class="c1">//        2.2： 调用bookService.queryBookById(id): Book得到图书的信息
</span><span class="c1"></span>        <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="n">bookService</span><span class="o">.</span><span class="na">queryBookById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
<span class="c1">//        2.3： 把图书信息，转换成CartItem商品项
</span><span class="c1"></span>        <span class="n">CartItem</span> <span class="n">cartItem</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CartItem</span><span class="o">(</span><span class="n">book</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">book</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">1</span><span class="o">,</span> <span class="n">book</span><span class="o">.</span><span class="na">getPrice</span><span class="o">(),</span> <span class="n">book</span><span class="o">.</span><span class="na">getPrice</span><span class="o">());</span>
<span class="c1">//        2.4: 调用Cart.addItem(CartItem);添加商品项
</span><span class="c1"></span>        <span class="n">Cart</span> <span class="n">cart</span> <span class="o">=</span> <span class="o">(</span><span class="n">Cart</span><span class="o">)</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;cart&#34;</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">cart</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">cart</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cart</span><span class="o">();</span>
            <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;cart&#34;</span><span class="o">,</span> <span class="n">cart</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">cart</span><span class="o">.</span><span class="na">addItem</span><span class="o">(</span><span class="n">cartItem</span><span class="o">);</span>

<span class="c1">//        2.5: 重定向回商品列表页面
</span><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">cart</span><span class="o">);</span>
        <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;lastName&#34;</span><span class="o">,</span> <span class="n">cartItem</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
        <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getContextPath</span><span class="o">());</span>

<span class="c1">//use AJAX to add the item to the cart
</span><span class="c1"></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">resultMap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;();</span>
<span class="n">resultMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;totalCount&#34;</span><span class="o">,</span> <span class="n">cart</span><span class="o">.</span><span class="na">getTotalCount</span><span class="o">());</span>
<span class="n">resultMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;lastName&#34;</span><span class="o">,</span><span class="n">cartItem</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
<span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Gson</span><span class="o">();</span>
<span class="n">String</span> <span class="n">resultMapJsonString</span> <span class="o">=</span> <span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">resultMap</span><span class="o">);</span>
<span class="n">resp</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="n">resultMapJsonString</span><span class="o">);</span>

    <span class="o">}</span>
</code></pre></div><hr>
<p><a href="https://rileyshen.github.io/post/spring/" >spring</a>
<a href="https://rileyshen.github.io/post/springmvc/" >springmvc</a></p></div>
    <div class="post-footer">
        <div class="info">
            
            <span class="separator"><a class="tag" href="/tags/javaee-project/">javaEE project</a><a class="tag" href="/tags/javaee-web/">javaEE web</a><a class="tag" href="/tags/three-tier-system/">Three-tier system</a><a class="tag" href="/tags/thymeleaf/">Thymeleaf</a><a class="tag" href="/tags/templateengine%2eprocess/">TemplateEngine.process</a></span>
        </div>
    </div>

    
</div>


        </div>
    </div>
</div>

<script type="text/javascript"
        src="/js/medium-zoom.min.83cb1dd5fea8d42d87d1e601a07faa73089ad0ef9ccfe5daf6041289ebcc4e46.js"
        integrity="sha256-g8sd1f6o1C2H0eYBoH&#43;qcwia0O&#43;cz&#43;Xa9gQSievMTkY="
        crossorigin="anonymous"></script>
<script async defer src="//latest.js"></script>
<noscript><img src="//noscript.gif" alt=""/></noscript>

</body>

</html>
