<!DOCTYPE html>
<html  dir="ltr" lang="en" data-theme=""><head>
    <title> Riley Shen | MyBatis for Beginners 1 </title>

    
    <meta charset="utf-8"><meta name="generator" content="Hugo 0.83.1" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <meta name="description"
        content="MyBatis 简易教程">
    <meta name="google-site-verification" content="Nac1UrFTdr1E1F48JLe7XQhIbKn2_WtF4VnJI8KOtew" />
    

    
    
    
    <link rel="stylesheet" href="/css/main.min.a7c9793b97840076bef76d2743ee1c90b13bd21c18674076a0cccd5dd54c723b.css" integrity="sha256-p8l5O5eEAHa&#43;920nQ&#43;4ckLE70hwYZ0B2oMzNXdVMcjs="
        crossorigin="anonymous" type="text/css">
    
    
    <link rel="stylesheet" href="/css/markupHighlight.min.f798cbda9aaa38f89eb38be6414bd082cfd71a6780375cbf67b6d2fb2b96491e.css"
        integrity="sha256-95jL2pqqOPies4vmQUvQgs/XGmeAN1y/Z7bS&#43;yuWSR4=" crossorigin="anonymous" type="text/css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
        integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA=="
        crossorigin="anonymous" />

    
    <link rel="shortcut icon" href="/favicons/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">

    <link rel="canonical" href="/post/mybatis1/">

    <link rel="preconnect" href="https://fonts.gstatic.com">



    
    
    
    
    <script type="text/javascript" src="/js/anatole-header.min.0c05c0a90d28c968a1cad4fb31abd0b8e1264e788ccefed022ae1d3b6f627514.js"
        integrity="sha256-DAXAqQ0oyWihytT7MavQuOEmTniMzv7QIq4dO29idRQ=" crossorigin="anonymous"></script>


    
    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://rileyshen.github.io/images/site-feature-image.png"/>

<meta name="twitter:title" content="MyBatis for Beginners 1"/>
<meta name="twitter:description" content="MyBatis 简易教程"/>


    
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,300;0,400;0,500;0,600;0,700;1,500;1,600;1,700&display=swap"
        rel="stylesheet">

</head><body><div class="sidebar animated fadeInDown ">
    <div class="logo-title">
        <div class="title">
            <img src="/images/profileS.jpg" alt="profile picture">
            <h3 title=""><a href="/">I&#39;m Riley Shen</a></h3>
            <div class="description">
                <p><br>Riley likes to push her limits <br>and always keep learning new things. <br>She shares her weekly learnings <br>because "if you can't explain it simply,<br>it means you didn't understand it well enough".<br></p>
            </div>
        </div>
    </div>
    <ul class="social-links">
        
            <li>
                <a href="mailto:ripple.shen31@gmail.com" rel="me" aria-label="e-mail">
                    <i class="fas fa-envelope fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="https://github.com/rileyshen" rel="me" aria-label="GitHub">
                    <i class="fab fa-github fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
    </ul>
    <div class="footer">
        <div class="by_farbox">&copy;  Riley Shen 2022 </div>
    </div>
</div>
<div class="main">
    <div class="page-top  animated fadeInDown ">
    <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
    </a>
    <ul class="nav" id="navMenu">
        
        
            
            <li><a 
                   href="/"
                        
                   title="">Home</a></li>
        
            
            <li><a 
                   href="/post/"
                        
                   title="">Posts</a></li>
        
            
            <li><a 
                   href="/about/"
                        
                   title="">About Me</a></li>
        
            
            <li><a 
                   href="/contact/"
                        
                   title="">Contact</a></li>
        
        
        
    </ul>
</div>

    <div class="autopagerize_page_element">
        <div class="content">
<div class="post  animated fadeInDown ">
    <div class="post-content">
        
        <div class="post-title">
            <h2>MyBatis for Beginners 1</h2>
            
            <div class="info">
                <em class="fas fa-calendar-day"></em>
                <span class="date">
                    Wed, Jul 15, 2020
                    </span>
                <em class="fas fa-stopwatch"></em>
                <span class="reading-time">13-minute read</span>
            </div>
            
        </div>

        <p>This tutorial is for newbies who want to learn MyBatis in a quite easy way.</p>
<!-- TOC depthfrom:1 depthto:6 orderedlist:false -->
<ul>
<li><a href="#mybatis" >MyBatis</a>
<ul>
<li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8-mybatis--%E7%8E%B0%E6%9C%89%E6%8C%81%E4%B9%85%E5%8C%96%E6%8A%80%E6%9C%AF%E7%9A%84%E5%AF%B9%E6%AF%94" >为什么要使用 MyBatis – 现有持久化技术的对比</a></li>
<li><a href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E5%87%86%E5%A4%87" >开发环境的准备</a>
<ul>
<li><a href="#mysql-%E4%B8%AD%E5%88%9B%E5%BB%BA%E8%A1%A8" >mysql 中创建表</a></li>
<li><a href="#maven-%E5%B7%A5%E7%A8%8B-%E6%8A%8A-src-%E6%96%87%E4%BB%B6%E5%A4%B9%E5%88%A0%E6%8E%89%E5%8F%98%E6%88%90%E7%88%B6%E5%B7%A5%E7%A8%8B-%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96" >maven 工程， 把 src 文件夹删掉，变成父工程, 导入依赖</a></li>
<li><a href="#maven-%E5%AD%90%E5%B7%A5%E7%A8%8B" >maven 子工程</a></li>
<li><a href="#%E5%88%9B%E5%BB%BA-mybatis-%E7%9A%84%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%B9%B6%E9%85%8D%E7%BD%AE%E5%A6%82%E4%BD%95%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93mybatis-configxml" >创建 MyBatis 的全局配置文件并配置（如何连接数据库）mybatis-config.xml</a></li>
<li><a href="#%E7%BC%96%E5%86%99-mybatis-%E5%B7%A5%E5%85%B7%E7%B1%BB" >编写 mybatis 工具类</a></li>
<li><a href="#%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81" >编写代码</a></li>
<li><a href="#%E6%B5%8B%E8%AF%95" >测试</a>
<ul>
<li><a href="#orgapacheibatisbindingbindingexception-type-interface-daouserdao-is-not-known-to-the-mapperregistry" >org.apache.ibatis.binding.BindingException: Type interface dao.UserDao is not known to the MapperRegistry</a></li>
<li><a href="#%E6%AF%8F%E4%B8%80%E4%B8%AA-mapperxml-%E9%83%BD%E9%9C%80%E8%A6%81%E5%9C%A8-mybatis-%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E6%B3%A8%E5%86%8C" >每一个 Mapper.xml 都需要在 Mybatis 核心配置文件中注册</a></li>
<li><a href="#could-not-find-mapperxml-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%97%A0%E6%B3%95%E5%AF%BC%E5%87%BA%E7%94%9F%E6%95%88%E7%9A%84%E6%97%B6%E5%80%99%E5%9C%A8-pom-%E6%96%87%E4%BB%B6%E4%B8%AD-build-%E9%87%8C%E9%9D%A2%E9%85%8D%E7%BD%AE" >could not find Mapper.xml 配置文件无法导出生效的时候在 pom 文件中 build 里面配置</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#idea-%E4%B8%AD%E6%A8%A1%E6%9D%BF%E8%AE%BE%E7%BD%AE" >idea 中模板设置</a>
<ul>
<li><a href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" >配置文件</a></li>
<li><a href="#%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6%E6%A8%A1%E6%9D%BF" >映射文件模板</a></li>
<li><a href="#mybatis-%E8%8E%B7%E5%8F%96%E5%8F%82%E6%95%B0%E5%80%BC%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F" >MyBatis 获取参数值的两种方式</a>
<ul>
<li><a href="#%E5%8D%95%E4%B8%AA%E5%AD%97%E9%9D%A2%E9%87%8F%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0" >单个字面量类型的参数</a></li>
<li><a href="#%E5%A4%9A%E4%B8%AA%E5%AD%97%E9%9D%A2%E9%87%8F%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0" >多个字面量类型的参数</a></li>
<li><a href="#map-%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0" >map 集合类型的参数</a></li>
<li><a href="#%E5%AE%9E%E4%BD%93%E7%B1%BB%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0" >实体类类型的参数</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8param-%E6%A0%87%E8%AF%86%E5%8F%82%E6%95%B0" >使用@Param 标识参数</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#crud" >CRUD</a>
<ul>
<li><a href="#%E6%9F%A5%E8%AF%A2%E4%B8%80%E4%B8%AA%E5%AE%9E%E4%BD%93%E7%B1%BB%E5%AF%B9%E8%B1%A1" >查询一个实体类对象</a></li>
<li><a href="#%E6%9F%A5%E8%AF%A2%E4%B8%80%E4%B8%AA-list-%E9%9B%86%E5%90%88" >查询一个 list 集合</a></li>
<li><a href="#%E6%9F%A5%E8%AF%A2%E5%8D%95%E4%B8%AA%E6%95%B0%E6%8D%AE" >查询单个数据</a></li>
<li><a href="#%E6%9F%A5%E8%AF%A2%E4%B8%80%E6%9D%A1%E6%95%B0%E6%8D%AE%E4%B8%BA-map-%E9%9B%86%E5%90%88" >查询一条数据为 map 集合</a></li>
<li><a href="#%E6%9F%A5%E8%AF%A2%E5%A4%9A%E6%9D%A1%E6%95%B0%E6%8D%AE%E4%B8%BA-map-%E9%9B%86%E5%90%88" >查询多条数据为 map 集合</a></li>
</ul>
</li>
<li><a href="#sql-%E7%89%B9%E6%AE%8A%E6%89%A7%E8%A1%8C" >SQL 特殊执行</a>
<ul>
<li><a href="#%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2" >模糊查询</a></li>
<li><a href="#%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4" >批量删除</a></li>
<li><a href="#%E5%8A%A8%E6%80%81%E8%AE%BE%E7%BD%AE%E8%A1%A8%E5%90%8D" >动态设置表名</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0%E5%8A%9F%E8%83%BD%E8%8E%B7%E5%8F%96%E8%87%AA%E5%A2%9E%E7%9A%84%E4%B8%BB%E9%94%AE" >添加功能获取自增的主键</a></li>
<li><a href="#namespace" >namespace</a>
<ul>
<li><a href="#namespace-%E4%B8%AD%E7%9A%84%E5%8C%85%E5%90%8D%E8%A6%81%E5%92%8C-daomapper-%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%8C%85%E5%90%8D%E4%B8%80%E8%87%B4" >namespace 中的包名要和 Dao/Mapper 接口的包名一致</a></li>
</ul>
</li>
<li><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" >注意事项</a></li>
<li><a href="#%E6%B3%A8%E6%84%8F%E5%A2%9E%E5%88%A0%E6%94%B9%E9%9C%80%E8%A6%81%E6%8F%90%E4%BA%A4%E4%BA%8B%E5%8A%A1" >&lt;em&gt;&lt;strong&gt;注意：增删改需要提交事务&lt;/strong&gt;&lt;/em&gt;</a></li>
<li><a href="#%E7%BC%96%E5%86%99%E6%8E%A5%E5%8F%A3" >编写接口</a></li>
<li><a href="#mapper-%E7%9A%84-sql-%E8%AF%AD%E5%8F%A5" >mapper 的 sql 语句</a></li>
<li><a href="#%E6%B5%8B%E8%AF%95" >测试</a></li>
<li><a href="#%E5%81%87%E8%AE%BE%E6%88%91%E4%BB%AC%E7%9A%84%E5%AE%9E%E4%BD%93%E7%B1%BB%E6%88%96%E8%80%85%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84%E8%A1%A8%E5%AD%97%E6%AE%B5%E6%88%96%E8%80%85%E5%8F%82%E6%95%B0%E8%BF%87%E5%A4%9A%E6%88%91%E4%BB%AC%E5%BA%94%E5%BD%93%E8%80%83%E8%99%91%E4%BD%BF%E7%94%A8-map" >假设，我们的实体类，或者数据库中的表，字段或者参数过多，我们应当考虑使用 Map</a></li>
</ul>
</li>
<li><a href="#%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2" >模糊查询</a></li>
<li><a href="#%E9%85%8D%E7%BD%AE%E8%A7%A3%E6%9E%90" >配置解析</a></li>
<li><a href="#%E7%B1%BB%E5%9E%8B%E5%88%AB%E5%90%8D-typealiases" >类型别名 typeAliases</a></li>
<li><a href="#%E6%98%A0%E5%B0%84%E5%99%A8" >映射器</a></li>
<li><a href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F" >生命周期和作用域</a></li>
<li><a href="#resultmap-%E7%BB%93%E6%9E%9C%E9%9B%86%E6%98%A0%E5%B0%84" >ResultMap 结果集映射</a>
<ul>
<li><a href="#resultmap-%E8%BF%99%E9%87%8Cresultmap-idusermap-typepojouser%E8%A6%81%E5%86%99%E5%AE%8C%E5%8C%85%E5%90%8D%E4%B8%8D%E7%84%B6%E4%BC%9A%E5%87%BA%E9%94%99" >resultmap 这里&lt;resultMap id=&#34;UserMap&#34; type=&#34;pojo.User&#34;&gt;要写完包名，不然会出错</a></li>
</ul>
</li>
<li><a href="#%E6%97%A5%E5%BF%97" >日志</a>
<ul>
<li><a href="#stdout_logging" >STDOUT_LOGGING</a></li>
<li><a href="#log4j" >LOG4J</a></li>
</ul>
</li>
<li><a href="#%E5%88%86%E9%A1%B5" >分页</a>
<ul>
<li><a href="#%E8%AF%AD%E6%B3%95" >语法</a></li>
<li><a href="#mybatis-%E5%AE%9E%E7%8E%B0%E5%88%86%E9%A1%B5-%E6%A0%B8%E5%BF%83-sql" >mybatis 实现分页， 核心 SQL</a></li>
</ul>
</li>
<li><a href="#%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91" >注解开发</a>
<ul>
<li><a href="#%E9%9D%A2%E5%90%91%E6%8E%A5%E5%8F%A3%E7%BC%96%E7%A8%8B" >面向接口编程</a></li>
</ul>
</li>
<li><a href="#%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%89%96%E6%9E%90" >执行流程剖析</a>
<ul>
<li><a href="#resources-%E8%8E%B7%E5%8F%96%E5%8A%A0%E8%BD%BD%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" >Resources 获取加载全局配置文件</a></li>
<li><a href="#%E5%AE%9E%E4%BE%8B%E5%8C%96-sqlsessionfactorybuilder-%E5%AF%B9%E8%B1%A1" >实例化 sqlsessionfactoryBuilder 对象</a></li>
<li><a href="#%E8%A7%A3%E6%9E%90%E6%96%87%E4%BB%B6%E6%B5%81-xmlconfigbuilder" >解析文件流 XMLConfigBuilder</a></li>
<li><a href="#configuration-%E6%89%80%E6%9C%89%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF" >Configuration 所有的配置信息</a></li>
<li><a href="#%E5%AE%9E%E4%BE%8B%E5%8C%96-sqlsessionfactory-%E5%AF%B9%E8%B1%A1" >实例化 sqlsessionfactory 对象</a></li>
<li><a href="#transactioncaches" >transactionCaches</a></li>
<li><a href="#%E5%88%9B%E5%BB%BA-executor-%E6%89%A7%E8%A1%8C%E5%99%A8" >创建 executor 执行器</a></li>
<li><a href="#%E5%88%9B%E5%BB%BA-sqlsession" >创建 sqlsession</a></li>
<li><a href="#%E5%AE%9E%E7%8E%B0-crud-%E4%BC%9A%E5%92%8C-6-%E8%BF%9E%E6%8E%A5-%E5%9B%9E%E6%BB%9A" >实现 CRUD 会和 6 连接， 回滚</a></li>
<li><a href="#%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F-%E4%BC%9A%E5%92%8C-6-%E8%BF%9E%E6%8E%A5-%E5%9B%9E%E6%BB%9A" >查看是否成功 会和 6 连接， 回滚</a></li>
<li><a href="#%E6%8F%90%E4%BA%A4%E4%BA%8B%E5%8A%A1" >提交事务</a></li>
<li><a href="#%E5%85%B3%E9%97%AD" >关闭</a></li>
</ul>
</li>
<li><a href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA" >环境搭建</a>
<ul>
<li><a href="#mybatis-%E9%80%9A%E8%BF%87%E5%AD%97%E6%AE%B5%E5%88%AB%E5%90%8D%E8%A7%A3%E5%86%B3%E5%AD%97%E6%AE%B5%E5%90%8D%E5%92%8C%E5%B1%9E%E6%80%A7%E5%90%8D%E7%9A%84%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB" >MyBatis 通过字段别名解决字段名和属性名的映射关系</a></li>
<li><a href="#method-1-%E5%88%AB%E5%90%8D" >method 1 别名</a></li>
<li><a href="#method-2-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE-mapunderscoretocamelcase" >method 2 全局配置 mapUnderscoreToCamelCase</a></li>
<li><a href="#method-3-resultmap" >method 3 resultMap</a></li>
</ul>
</li>
<li><a href="#could-not-find-resource-daoxml" >Could not find resource dao/*.xml</a></li>
<li><a href="#%E5%A4%9A%E5%AF%B9%E4%B8%80%E5%A4%84%E7%90%86" >多对一处理</a>
<ul>
<li><a href="#a-%E7%BA%A7%E8%81%94%E6%96%B9%E5%BC%8F%E5%A4%84%E7%90%86%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB" >a. 级联方式处理映射关系</a></li>
<li><a href="#b-%E4%BD%BF%E7%94%A8-association-%E5%A4%84%E7%90%86%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB" >b. 使用 association 处理映射关系</a></li>
<li><a href="#c-%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2" >c. 分步查询</a>
<ul>
<li><a href="#%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2%E7%9A%84%E4%BC%98%E7%82%B9" >分步查询的优点</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E4%B8%80%E5%AF%B9%E5%A4%9A%E5%A4%84%E7%90%86" >一对多处理</a>
<ul>
<li><a href="#a-collection" >a. collection</a></li>
<li><a href="#b-%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2" >b. 分步查询</a></li>
</ul>
</li>
<li><a href="#%E5%8A%A8%E6%80%81-sql" >动态 SQL</a>
<ul>
<li><a href="#if" >if</a></li>
<li><a href="#where" >where</a></li>
<li><a href="#trim" >trim</a></li>
<li><a href="#choosewhenotherwise" >choose、when、otherwise</a></li>
<li><a href="#foreach" >foreach</a></li>
<li><a href="#sql-%E7%89%87%E6%AE%B5" >SQL 片段</a></li>
</ul>
</li>
<li><a href="#mybatis-%E7%BC%93%E5%AD%98" >MyBatis 缓存</a>
<ul>
<li><a href="#%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98" >一级缓存</a>
<ul>
<li><a href="#%E4%BD%BF%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98%E5%A4%B1%E6%95%88%E7%9A%84%E5%9B%9B%E7%A7%8D%E6%83%85%E5%86%B5" >使一级缓存失效的四种情况</a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98" >二级缓存</a>
<ul>
<li><a href="#%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E5%BC%80%E5%90%AF%E7%9A%84%E6%9D%A1%E4%BB%B6" >二级缓存开启的条件</a></li>
<li><a href="#%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E5%A4%B1%E6%95%88%E7%9A%84%E6%83%85%E5%86%B5" >二级缓存失效的情况</a></li>
</ul>
</li>
<li><a href="#mybatis-%E7%BC%93%E5%AD%98%E6%9F%A5%E8%AF%A2%E7%9A%84%E9%A1%BA%E5%BA%8F" >MyBatis 缓存查询的顺序</a></li>
</ul>
</li>
<li><a href="#%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B" >逆向工程</a>
<ul>
<li><a href="#%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96%E5%92%8C%E6%8F%92%E4%BB%B6" >添加依赖和插件</a></li>
<li><a href="#%E5%88%9B%E5%BB%BA-mybatis-%E7%9A%84%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" >创建 MyBatis 的核心配置文件</a></li>
<li><a href="#%E5%88%9B%E5%BB%BA%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" >创建逆向工程的配置文件</a></li>
<li><a href="#%E6%89%A7%E8%A1%8C-mbg-%E6%8F%92%E4%BB%B6%E7%9A%84-generate-%E7%9B%AE%E6%A0%87" >执行 MBG 插件的 generate 目标</a></li>
</ul>
</li>
<li><a href="#%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6" >分页插件</a>
<ul>
<li><a href="#%E4%BE%9D%E8%B5%96" >依赖</a></li>
<li><a href="#%E9%85%8D%E7%BD%AE%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6" >配置分页插件</a></li>
<li><a href="#%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8" >分页插件的使用</a>
<ul>
<li><a href="#%E5%9C%A8%E6%9F%A5%E8%AF%A2%E5%8A%9F%E8%83%BD%E4%B9%8B%E5%89%8D%E4%BD%BF%E7%94%A8-pagehelperstartpageint-pagenum-int-pagesize%E5%BC%80%E5%90%AF%E5%88%86%E9%A1%B5%E5%8A%9F%E8%83%BD" >在查询功能之前使用 PageHelper.startPageint pageNum, int pageSize开启分页功能</a></li>
<li><a href="#%E5%9C%A8%E6%9F%A5%E8%AF%A2%E8%8E%B7%E5%8F%96-list-%E9%9B%86%E5%90%88%E4%B9%8B%E5%90%8E%E4%BD%BF%E7%94%A8-pageinfot-pageinfo--new-pageinfolistt-list-int" >在查询获取 list 集合之后，使用 PageInfo&lt;T&gt; pageInfo = new PageInfo&amp;lt;&amp;gt;List&lt;T&gt; list, int</a></li>
<li><a href="#%E5%88%86%E9%A1%B5%E7%9B%B8%E5%85%B3%E6%95%B0%E6%8D%AE" >分页相关数据</a></li>
</ul>
</li>
<li><a href="#ok-its-time-for-mybatis2" >Ok, It&amp;rsquo;s time for mybatis2</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- /TOC -->
<h2 id="mybatis">MyBatis</h2>
<p><a id="markdown-mybatis" name="mybatis"></a></p>
<h3 id="为什么要使用-mybatis--现有持久化技术的对比">为什么要使用 MyBatis – 现有持久化技术的对比</h3>
<p><a id="markdown-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8-mybatis-%E2%80%93-%E7%8E%B0%E6%9C%89%E6%8C%81%E4%B9%85%E5%8C%96%E6%8A%80%E6%9C%AF%E7%9A%84%E5%AF%B9%E6%AF%94" name="%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8-mybatis-%E2%80%93-%E7%8E%B0%E6%9C%89%E6%8C%81%E4%B9%85%E5%8C%96%E6%8A%80%E6%9C%AF%E7%9A%84%E5%AF%B9%E6%AF%94"></a></p>
<ul>
<li>
<p><strong>JDBC</strong></p>
</li>
<li>
<p>SQL 夹在 Java 代码块里，耦合度高导致硬编码内伤</p>
</li>
<li>
<p>维护不易且实际开发需求中 sql 有变化，频繁修改的情况多见</p>
</li>
<li>
<p><strong>Hibernate 和 JPA</strong></p>
</li>
<li>
<p>长难复杂 SQL，对于 Hibernate 而言处理也不容易</p>
</li>
<li>
<p>内部自动生产的 SQL，不容易做特殊优化</p>
</li>
<li>
<p>基于全映射的全自动框架，大量字段的 POJO 进行部分映射时比较困难。导致数据库性能下降</p>
</li>
<li>
<p><strong>MyBatis</strong></p>
</li>
<li>
<p>对开发人员而言，核心 sql 还是需要自己优化</p>
</li>
<li>
<p>sql 和 java 编码分开，功能边界清晰，一个专注业务、一个专注数据</p>
</li>
</ul>
<h3 id="开发环境的准备">开发环境的准备</h3>
<p><a id="markdown-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E5%87%86%E5%A4%87" name="%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E5%87%86%E5%A4%87"></a></p>
<p><strong>思路：搭建环境——》导入 Mybatis——》编写代码——》测试</strong></p>
<h4 id="1-mysql-中创建表">1 mysql 中创建表</h4>
<p><a id="markdown-mysql-%E4%B8%AD%E5%88%9B%E5%BB%BA%E8%A1%A8" name="mysql-%E4%B8%AD%E5%88%9B%E5%BB%BA%E8%A1%A8"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">存储引擎是innodb。innoDB 是 MySQL 上第一个提供外键约束的数据存储引擎，除了提供事务处理外，InnoDB 还支持行锁，提供和 Oracle 一样的一致性的不加锁读取，能增加并发读的用户数量并提高性能，不会增加锁的数量。InnoDB 的设计目标是处理大容量数据时最大化性能，它的 CPU 利用率是其他所有基于磁盘的关系数据库引擎中最有效率的。

InnoDB 是一套放在 MySQL 后台的完整数据库系统，InnoDB 有它自己的缓冲池，能缓冲数据和索引，InnoDB 还把数据和索引存放在表空间里面，可能包含好几个文件，这和 MyISAM 表完全不同，在 MyISAM 中，表被存放在单独的文件中，InnoDB 表的大小只受限于操作系统文件的大小，一般为 2GB

What is engine InnoDB?
InnoDB is a general-purpose storage engine that balances high reliability and high performance. In MySQL 5.6, InnoDB is the default MySQL storage engine. Unless you have configured a different default storage engine, issuing a CREATE TABLE statement without an ENGINE clause creates an InnoDB table.
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">create</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="o">`</span><span class="n">mybatis</span><span class="o">`</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="p">(</span><span class="w">
</span><span class="w"></span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="w"> </span><span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="o">`</span><span class="n">pwd</span><span class="o">`</span><span class="nb">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">null</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="p">)</span><span class="w">
</span></code></pre></div><p>插入三个属性</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">Insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="o">`</span><span class="k">user</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">name</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">pwd</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w">
</span><span class="w"></span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;aa&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;1234556&#39;</span><span class="p">),</span><span class="w">
</span><span class="w"></span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;bb&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;123e56&#39;</span><span class="p">),</span><span class="w">
</span><span class="w"></span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;cc&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;1234gg6&#39;</span><span class="p">)</span><span class="w">
</span></code></pre></div><h4 id="2-maven-工程-把-src-文件夹删掉变成父工程-导入依赖">2 maven 工程， 把 src 文件夹删掉，变成父工程, 导入依赖</h4>
<p><a id="markdown-maven-%E5%B7%A5%E7%A8%8B%EF%BC%8C-%E6%8A%8A-src-%E6%96%87%E4%BB%B6%E5%A4%B9%E5%88%A0%E6%8E%89%EF%BC%8C%E5%8F%98%E6%88%90%E7%88%B6%E5%B7%A5%E7%A8%8B%2C-%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96" name="maven-%E5%B7%A5%E7%A8%8B%EF%BC%8C-%E6%8A%8A-src-%E6%96%87%E4%BB%B6%E5%A4%B9%E5%88%A0%E6%8E%89%EF%BC%8C%E5%8F%98%E6%88%90%E7%88%B6%E5%B7%A5%E7%A8%8B%2C-%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"></a></p>
<p><strong>导入 MyBatis 框架的 jar 包、Mysql 驱动包、log4j 的 jar 包</strong></p>
<ul>
<li>myBatis-3.4.1.jar</li>
<li>mysql-connector-java-5.1.37-bin.jar</li>
<li>log4j.jar</li>
<li>junit</li>
</ul>
<h4 id="3-maven-子工程">3 maven 子工程</h4>
<p><a id="markdown-maven-%E5%AD%90%E5%B7%A5%E7%A8%8B" name="maven-%E5%AD%90%E5%B7%A5%E7%A8%8B"></a></p>
<h4 id="4-创建-mybatis-的全局配置文件并配置如何连接数据库mybatis-configxml">4. 创建 MyBatis 的全局配置文件并配置（如何连接数据库）mybatis-config.xml</h4>
<p><a id="markdown-%E5%88%9B%E5%BB%BA-mybatis-%E7%9A%84%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%B9%B6%E9%85%8D%E7%BD%AE%EF%BC%88%E5%A6%82%E4%BD%95%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%89mybatis-config.xml" name="%E5%88%9B%E5%BB%BA-mybatis-%E7%9A%84%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%B9%B6%E9%85%8D%E7%BD%AE%EF%BC%88%E5%A6%82%E4%BD%95%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%89mybatis-config.xml"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE configuration
</span><span class="cp">        PUBLIC &#34;-//mybatis.org//DTD Config 3.0//EN&#34;
</span><span class="cp">        &#34;http://mybatis.org/dtd/mybatis-3-config.dtd&#34;&gt;</span>
<span class="c">&lt;!--configuration 核心配置文件--&gt;</span>
<span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;environments</span> <span class="na">default=</span><span class="s">&#34;development&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;environment</span> <span class="na">id=</span><span class="s">&#34;development&#34;</span><span class="nt">&gt;</span>
            <span class="c">&lt;!--事务管理--&gt;</span>
            <span class="nt">&lt;transactionManager</span> <span class="na">type=</span><span class="s">&#34;JDBC&#34;</span><span class="nt">/&gt;</span>
            <span class="c">&lt;!--配置数据源--&gt;</span>
            <span class="nt">&lt;dataSource</span> <span class="na">type=</span><span class="s">&#34;POOLED&#34;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;driver&#34;</span> <span class="na">value=</span><span class="s">&#34;com.mysql.cj.jdbc.Driver&#34;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;url&#34;</span> <span class="na">value=</span><span class="s">&#34;jdbc:mysql://192.168.56.10:3306/mybatis?useSSL=true&amp;amp;useUnicode=true&amp;amp;characterEncoding=UTF-8&#34;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;username&#34;</span> <span class="na">value=</span><span class="s">&#34;root&#34;</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;password&#34;</span> <span class="na">value=</span><span class="s">&#34;root&#34;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/dataSource&gt;</span>
        <span class="nt">&lt;/environment&gt;</span>
    <span class="nt">&lt;/environments&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>

</code></pre></div><p><strong>transactionManager type=&ldquo;JDBC&rdquo;/</strong></p>
<p>type：设置事务管理方式，type=&ldquo;JDBC|MANAGED&rdquo;</p>
<p>type=&ldquo;JDBC&rdquo;：设置当前环境的事务管理都必须手动处理</p>
<p>type=&ldquo;MANAGED&rdquo;：设置事务被管理，例如 spring 中的 AOP</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">mysql数据库用的是gbk编码，而项目数据库用的是utf-8编码。这时候如果添加了useUnicode<span class="o">=</span>true<span class="p">&amp;</span><span class="nv">characterEncoding</span><span class="o">=</span>UTF-8 ，那么作用有如下两个方面：

1. 存数据时：

数据库在存放项目数据的时候会先用UTF-8格式将数据解码成字节码，然后再将解码后的字节码重新使用GBK编码存放到数据库中。

2.取数据时：

在从数据库中取数据的时候，数据库会先将数据库中的数据按GBK格式解码成字节码，然后再将解码后的字节码重新按UTF-8格式编码数据，最后再将数据返回给客户端。

</code></pre></div><h4 id="5-编写-mybatis-工具类">5. 编写 mybatis 工具类</h4>
<p><a id="markdown-%E7%BC%96%E5%86%99-mybatis-%E5%B7%A5%E5%85%B7%E7%B1%BB" name="%E7%BC%96%E5%86%99-mybatis-%E5%B7%A5%E5%85%B7%E7%B1%BB"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MybatisUtils</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">SqlSessionFactory</span> <span class="n">sqlSessionFactory</span><span class="o">;</span>


    <span class="kd">static</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="c1">// 官网 获取sqlsession对象
</span><span class="c1"></span>            <span class="n">String</span> <span class="n">resource</span> <span class="o">=</span> <span class="s">&#34;mybatis-config.xml&#34;</span><span class="o">;</span>
            <span class="n">InputStream</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="n">inputStream</span> <span class="o">=</span> <span class="n">Resources</span><span class="o">.</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="n">resource</span><span class="o">);</span>
            <span class="n">sqlSessionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SqlSessionFactoryBuilder</span><span class="o">().</span><span class="na">build</span><span class="o">(</span><span class="n">inputStream</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span>  <span class="kd">static</span> <span class="n">SqlSession</span> <span class="nf">getSqlSession</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div><h4 id="6-编写代码">6. 编写代码</h4>
<p><a id="markdown-%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81" name="%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81"></a></p>
<ul>
<li>
<p><strong>JDBC 时期</strong></p>
</li>
<li>
<p>实体类 （pojo -》 user 实体类）</p>
</li>
<li>
<p>Dao 接口 （UserDao）</p>
</li>
<li>
<p>接口实现类 （UserDaoImpl）</p>
</li>
<li>
<p><strong>mybatis</strong></p>
</li>
<li>
<p>实体类 （pojo -》 user 实体类）</p>
</li>
<li>
<p>Dao 接口 （UserDao）</p>
</li>
<li>
<p>XxxMapper.xml 映射文件 （如何操作数据库）</p>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper
</span><span class="cp">        PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;
</span><span class="cp">        &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>

<span class="c">&lt;!--namespace=绑定一个对应的Dao/ Mapper接口--&gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&#34;dao.UserDao&#34;</span><span class="nt">&gt;</span>
<span class="c">&lt;!--    select 查询语句--&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getUserList&#34;</span> <span class="na">resultType=</span><span class="s">&#34;pojo.User&#34;</span><span class="nt">&gt;</span>
         select * from mybatis.user
    <span class="nt">&lt;/select&gt;</span>
<span class="nt">&lt;/mapper&gt;</span>

</code></pre></div><h4 id="7-测试">7. 测试</h4>
<p><a id="markdown-%E6%B5%8B%E8%AF%95" name="%E6%B5%8B%E8%AF%95"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDaoTest</span> <span class="o">{</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// step1: 获取 sqlsession对象
</span><span class="c1"></span>        <span class="n">SqlSession</span> <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">MybatisUtils</span><span class="o">.</span><span class="na">getSqlSession</span><span class="o">();</span>
        <span class="c1">// step2: 执行
</span><span class="c1"></span>        <span class="n">UserDao</span> <span class="n">mapper</span> <span class="o">=</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">getMapper</span><span class="o">(</span><span class="n">UserDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">userList</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">getUserList</span><span class="o">();</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">User</span> <span class="n">user</span> <span class="o">:</span> <span class="n">userList</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">sqlSession</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>

    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div><h5 id="orgapacheibatisbindingbindingexception-type-interface-daouserdao-is-not-known-to-the-mapperregistry">org.apache.ibatis.binding.BindingException: Type interface dao.UserDao is not known to the MapperRegistry</h5>
<p><a id="markdown-org.apache.ibatis.binding.bindingexception%3A-type-interface-dao.userdao-is-not-known-to-the-mapperregistry" name="org.apache.ibatis.binding.bindingexception%3A-type-interface-dao.userdao-is-not-known-to-the-mapperregistry"></a></p>
<h5 id="每一个-mapperxml-都需要在-mybatis-核心配置文件中注册">每一个 Mapper.xml 都需要在 Mybatis 核心配置文件中注册</h5>
<p><a id="markdown-%E6%AF%8F%E4%B8%80%E4%B8%AA-mapper.xml-%E9%83%BD%E9%9C%80%E8%A6%81%E5%9C%A8-mybatis-%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E6%B3%A8%E5%86%8C" name="%E6%AF%8F%E4%B8%80%E4%B8%AA-mapper.xml-%E9%83%BD%E9%9C%80%E8%A6%81%E5%9C%A8-mybatis-%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E6%B3%A8%E5%86%8C"></a></p>
<figure><img src="/images/batis1.png"
         alt="image"/><figcaption>
            <h4>mapper 配置</h4>
        </figcaption>
</figure>

<h5 id="could-not-find-mapperxml-配置文件无法导出生效的时候在-pom-文件中-build-里面配置">could not find Mapper.xml 配置文件无法导出生效的时候在 pom 文件中 build 里面配置</h5>
<p><a id="markdown-could-not-find-mapper.xml-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%97%A0%E6%B3%95%E5%AF%BC%E5%87%BA%E7%94%9F%E6%95%88%E7%9A%84%E6%97%B6%E5%80%99%E5%9C%A8-pom-%E6%96%87%E4%BB%B6%E4%B8%AD-build-%E9%87%8C%E9%9D%A2%E9%85%8D%E7%BD%AE" name="could-not-find-mapper.xml-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%97%A0%E6%B3%95%E5%AF%BC%E5%87%BA%E7%94%9F%E6%95%88%E7%9A%84%E6%97%B6%E5%80%99%E5%9C%A8-pom-%E6%96%87%E4%BB%B6%E4%B8%AD-build-%E9%87%8C%E9%9D%A2%E9%85%8D%E7%BD%AE"></a></p>
<figure><img src="/images/batis2.png"
         alt="image"/><figcaption>
            <h4>pom 配置</h4>
        </figcaption>
</figure>

<h3 id="idea-中模板设置">idea 中模板设置</h3>
<p><a id="markdown-idea-%E4%B8%AD%E6%A8%A1%E6%9D%BF%E8%AE%BE%E7%BD%AE" name="idea-%E4%B8%AD%E6%A8%A1%E6%9D%BF%E8%AE%BE%E7%BD%AE"></a></p>
<h4 id="配置文件">配置文件</h4>
<p><a id="markdown-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" name="%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"></a></p>
<figure><img src="/images/batis12.png"
         alt="image"/><figcaption>
            <h4>模板设置</h4>
        </figcaption>
</figure>

<p>以后直接右键会出现 new mybatis.xml</p>
<h4 id="映射文件模板">映射文件模板</h4>
<p><a id="markdown-%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6%E6%A8%A1%E6%9D%BF" name="%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6%E6%A8%A1%E6%9D%BF"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="o">&lt;?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s">&#34;1.0&#34;</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span> <span class="o">?&gt;</span>
<span class="o">&lt;!</span><span class="n">DOCTYPE</span> <span class="n">mapper</span>
        <span class="n">PUBLIC</span> <span class="s">&#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;</span>
        <span class="s">&#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;</span><span class="o">&gt;</span>


   <span class="o">&lt;</span><span class="n">mapper</span> <span class="n">namespace</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="o">&gt;</span>

   <span class="o">&lt;/</span><span class="n">mapper</span><span class="o">&gt;</span>

</code></pre></div><h4 id="mybatis-获取参数值的两种方式">MyBatis 获取参数值的两种方式</h4>
<p><a id="markdown-mybatis-%E8%8E%B7%E5%8F%96%E5%8F%82%E6%95%B0%E5%80%BC%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F" name="mybatis-%E8%8E%B7%E5%8F%96%E5%8F%82%E6%95%B0%E5%80%BC%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F"></a></p>
<p>MyBatis 获取参数值的两种方式：${}和#{}</p>
<p>${}的本质就是字符串拼接，#{}的本质就是占位符赋值</p>
<p>${}使用字符串拼接的方式拼接 sql，若为字符串类型或日期类型的字段进行赋值时，需要手动加单引号；但是#{}使用占位符赋值的方式拼接 sql，此时为字符串类型或日期类型的字段进行赋值时，可以自动添加单引号</p>
<blockquote>
<p>select * from t_user where username = #{username}</p>
</blockquote>
<blockquote>
<p>select * from t_user where username = &lsquo;${username}&rsquo;</p>
</blockquote>
<h5 id="1-单个字面量类型的参数">1. 单个字面量类型的参数</h5>
<p><a id="markdown-%E5%8D%95%E4%B8%AA%E5%AD%97%E9%9D%A2%E9%87%8F%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0" name="%E5%8D%95%E4%B8%AA%E5%AD%97%E9%9D%A2%E9%87%8F%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0"></a></p>
<p>若 mapper 接口中的方法参数为单个的字面量类型
此时可以使用${}和#{}以任意的名称获取参数的值，注意${}需要手动加单引号</p>
<h5 id="2-多个字面量类型的参数">2. 多个字面量类型的参数</h5>
<p><a id="markdown-%E5%A4%9A%E4%B8%AA%E5%AD%97%E9%9D%A2%E9%87%8F%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0" name="%E5%A4%9A%E4%B8%AA%E5%AD%97%E9%9D%A2%E9%87%8F%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0"></a>
若 mapper 接口中的方法参数为多个时</p>
<p>此时 MyBatis 会自动将这些参数放在一个 map 集合中，以 arg0,arg1&hellip;为键，以参数为值;</p>
<p>以 param1,param2&hellip;为键，以参数为值；因此只需要通过${}和#{}访问 map 集合的键就可以获取相对应的</p>
<p>值，注意${}需要手动加单引号</p>
<blockquote>
<p>User checkLogin(String username, String password);</p>
</blockquote>
<p>错误的方法</p>
<blockquote>
<p>select * from t_user where username = #{username} and password = #{password}</p>
</blockquote>
<p>正确的, 可以把 arg0 替换为 param1</p>
<blockquote>
<select id = "checkLogin" resultType="User">
select * from t_user where username = #{arg0} and password = #{arg01}
</blockquote>
<h5 id="3-map-集合类型的参数">3. map 集合类型的参数</h5>
<p><a id="markdown-map-%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0" name="map-%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0"></a></p>
<p>第二种是 mybatis 设置键</p>
<p>若 mapper 接口中的方法需要的参数为多个时，此时可以手动创建 map 集合，将这些数据放在 map 中只需要通过${}和#{}访问 map 集合的键就可以获取相对应的值，注意${}需要手动加单引号</p>
<blockquote>
<select id = "checkLoginByMap" resultType="User">
select * from t_user where username = #{username} and password = #{password}
</blockquote>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"> <span class="n">SqlSession</span> <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">MybatisUtils</span><span class="o">.</span><span class="na">getSqlSession</span><span class="o">();</span>
        <span class="c1">// step2: 执行
</span><span class="c1"></span>        <span class="n">StudentMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">getMapper</span><span class="o">(</span><span class="n">StudentMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">,</span> <span class="s">&#34;admin&#34;</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">,</span> <span class="s">&#34;admin&#34;</span><span class="o">);</span>
        <span class="n">Student</span> <span class="n">stu</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">checkLoginByMap</span><span class="o">();</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">allStudent</span><span class="o">);</span>


        <span class="n">sqlSession</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</code></pre></div><h5 id="4-实体类类型的参数">4. 实体类类型的参数</h5>
<p><a id="markdown-%E5%AE%9E%E4%BD%93%E7%B1%BB%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0" name="%E5%AE%9E%E4%BD%93%E7%B1%BB%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0"></a></p>
<p>若 mapper 接口中的方法参数为实体类对象时 (从游览器中得到实体信息)
此时可以使用${}和#{}，通过访问实体类对象中的属性名获取属性值，注意${}需要手动加单引号</p>
<p><em><strong>int insertUser(User user);</strong></em></p>
<blockquote>
<select id = "insertUser" resultType="User">
insert into t_user values(null, #{username}, #{password})
</select>
</blockquote>
<h5 id="5-使用param-标识参数">5. 使用@Param 标识参数</h5>
<p><a id="markdown-%E4%BD%BF%E7%94%A8%40param-%E6%A0%87%E8%AF%86%E5%8F%82%E6%95%B0" name="%E4%BD%BF%E7%94%A8%40param-%E6%A0%87%E8%AF%86%E5%8F%82%E6%95%B0"></a></p>
<p>可以通过@Param 注解标识 mapper 接口中的方法参数. 此时，会将这些参数放在 map 集合中，以@Param 注解的 value 属性值为键，以参数为值；以 param1,param2&hellip;为键，以参数为值；只需要通过${}和#{}访问 map 集合的键就可以获取相对应的值，
注意${}需要手动加单引号</p>
<p><strong>mybatis 会把 @Param 里面的键放进 map,相当于第二第三种情况</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TeacherMapper</span> <span class="o">{</span>
    
    <span class="n">Teacher</span> <span class="nf">getTeacher</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">&#34;tid&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">var1</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div><blockquote>
<select id = "getTeacher" resultType="Teacher">
select * from t_user where username = #{username} and password = #{password}
</select>
</blockquote>
<p><strong>建议就分两种情况,一种就是获取实体类的时候, 另一个种全部加上 @Param</strong></p>
<h3 id="crud">CRUD</h3>
<p><a id="markdown-crud" name="crud"></a></p>
<h4 id="查询一个实体类对象">查询一个实体类对象</h4>
<p><a id="markdown-%E6%9F%A5%E8%AF%A2%E4%B8%80%E4%B8%AA%E5%AE%9E%E4%BD%93%E7%B1%BB%E5%AF%B9%E8%B1%A1" name="%E6%9F%A5%E8%AF%A2%E4%B8%80%E4%B8%AA%E5%AE%9E%E4%BD%93%E7%B1%BB%E5%AF%B9%E8%B1%A1"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">    <span class="c1">// 根据用户id查询用户信息
</span><span class="c1"></span>    <span class="n">Student</span> <span class="nf">getStudentById</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">)</span> <span class="kt">int</span> <span class="n">id</span><span class="o">);</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">   <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getStudentById&#34;</span> <span class="na">resultType=</span><span class="s">&#34;Student&#34;</span><span class="nt">&gt;</span>
      select * from Student where id = #{id};
   <span class="nt">&lt;/select&gt;</span>
</code></pre></div><h4 id="查询一个-list-集合">查询一个 list 集合</h4>
<p><a id="markdown-%E6%9F%A5%E8%AF%A2%E4%B8%80%E4%B8%AA-list-%E9%9B%86%E5%90%88" name="%E6%9F%A5%E8%AF%A2%E4%B8%80%E4%B8%AA-list-%E9%9B%86%E5%90%88"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// 查询所有的学生信息
</span><span class="c1"></span>    <span class="n">List</span><span class="o">&lt;</span><span class="n">Student</span><span class="o">&gt;</span> <span class="nf">getAllStudent</span><span class="o">();</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">   <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getAllStudent&#34;</span> <span class="na">resultType=</span><span class="s">&#34;Student&#34;</span><span class="nt">&gt;</span>
      select * from student;
   <span class="nt">&lt;/select&gt;</span>
</code></pre></div><h4 id="查询单个数据">查询单个数据</h4>
<p><a id="markdown-%E6%9F%A5%E8%AF%A2%E5%8D%95%E4%B8%AA%E6%95%B0%E6%8D%AE" name="%E6%9F%A5%E8%AF%A2%E5%8D%95%E4%B8%AA%E6%95%B0%E6%8D%AE"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">    <span class="c1">// 根据用户信息总记录是
</span><span class="c1"></span>    <span class="kt">int</span> <span class="nf">getCount</span><span class="o">();</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">   <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getCount&#34;</span> <span class="na">resultType=</span><span class="s">&#34;Integer&#34;</span><span class="nt">&gt;</span>
     select count(*) from student;
   <span class="nt">&lt;/select&gt;</span>
</code></pre></div><h4 id="查询一条数据为-map-集合">查询一条数据为 map 集合</h4>
<p><a id="markdown-%E6%9F%A5%E8%AF%A2%E4%B8%80%E6%9D%A1%E6%95%B0%E6%8D%AE%E4%B8%BA-map-%E9%9B%86%E5%90%88" name="%E6%9F%A5%E8%AF%A2%E4%B8%80%E6%9D%A1%E6%95%B0%E6%8D%AE%E4%B8%BA-map-%E9%9B%86%E5%90%88"></a></p>
<blockquote>
<p>Map&lt;String, Object&gt; getUserToMap(@Param(&ldquo;id&rdquo;) int id);</p>
</blockquote>
<blockquote>
<!--Map<String, Object> getUserToMap(@Param("id") int id);-->
<select id="getUserToMap" resultType="map">
</blockquote>
<p>select * from t_user where id = #{id}</p>
<blockquote>
</select>
</blockquote>
<h4 id="查询多条数据为-map-集合">查询多条数据为 map 集合</h4>
<p><a id="markdown-%E6%9F%A5%E8%AF%A2%E5%A4%9A%E6%9D%A1%E6%95%B0%E6%8D%AE%E4%B8%BA-map-%E9%9B%86%E5%90%88" name="%E6%9F%A5%E8%AF%A2%E5%A4%9A%E6%9D%A1%E6%95%B0%E6%8D%AE%E4%B8%BA-map-%E9%9B%86%E5%90%88"></a></p>
<p><strong>method 1</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="c1">// * 查询所有用户信息为map集合
</span><span class="c1">// * @return
</span><span class="c1">// * 将表中的数据以map集合的方式查询，一条数据对应一个map；若有多条数据，就会产生多个map集合，此
</span><span class="c1">// 时可以将这些map放在一个list集合中获取
</span><span class="c1">// */
</span><span class="c1"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;</span> <span class="nf">getAllUserToMap</span><span class="o">();</span>

</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">// <span class="c">&lt;!--Map&lt;String, Object&gt; getAllUserToMap();--&gt;</span>
<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getAllUserToMap&#34;</span> <span class="na">resultType=</span><span class="s">&#34;map&#34;</span><span class="nt">&gt;</span>
select * from t_user
<span class="nt">&lt;/select&gt;</span>
</code></pre></div><p><strong>method 2</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@MapKey</span><span class="o">(</span><span class="s">&#34;id&#34;</span><span class="o">)</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">getAllUserToMap</span><span class="o">();</span>

</code></pre></div><h3 id="sql-特殊执行">SQL 特殊执行</h3>
<p><a id="markdown-sql-%E7%89%B9%E6%AE%8A%E6%89%A7%E8%A1%8C" name="sql-%E7%89%B9%E6%AE%8A%E6%89%A7%E8%A1%8C"></a></p>
<h4 id="模糊查询">模糊查询</h4>
<p><a id="markdown-%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2" name="%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">    <span class="c1">// 测试模糊查询
</span><span class="c1"></span>    <span class="n">List</span><span class="o">&lt;</span><span class="n">Student</span><span class="o">&gt;</span> <span class="nf">getStudentByLike</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">username</span><span class="o">);</span>
</code></pre></div><p>不可以</p>
<blockquote>
<p>select * from student where <code>name</code> like &lsquo;%#{username}%&rsquo;</p>
</blockquote>
<p><strong>method 1</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getStudentByLike&#34;</span> <span class="na">resultType=</span><span class="s">&#34;Student&#34;</span><span class="nt">&gt;</span>
      select * from student where `name` like &#39;%${username}%&#39;
   <span class="nt">&lt;/select&gt;</span>
</code></pre></div><p><strong>method 2</strong></p>
<blockquote>
<p>select * from student where <code>name</code> like concat('%', #{username}, &lsquo;%')</p>
</blockquote>
<p><strong>method 3</strong></p>
<blockquote>
<p>select * from student where <code>name</code> like &ldquo;%&quot;#{username}&quot;%&rdquo;</p>
</blockquote>
<h4 id="批量删除">批量删除</h4>
<p><a id="markdown-%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4" name="%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">    <span class="c1">// 批量删除
</span><span class="c1"></span>    <span class="kt">int</span> <span class="nf">deleteMore</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">&#34;ids&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">ids</span><span class="o">);</span>
</code></pre></div><p>不能用 #{}, 会自动加单引号</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">   <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;deleteMore&#34;</span><span class="nt">&gt;</span>
    delete from student where id in (${ids})
   <span class="nt">&lt;/select&gt;</span>
</code></pre></div><blockquote>
<p>mapper.deleteMore(&ldquo;1, 2, 3&rdquo;);</p>
</blockquote>
<h4 id="动态设置表名">动态设置表名</h4>
<p><a id="markdown-%E5%8A%A8%E6%80%81%E8%AE%BE%E7%BD%AE%E8%A1%A8%E5%90%8D" name="%E5%8A%A8%E6%80%81%E8%AE%BE%E7%BD%AE%E8%A1%A8%E5%90%8D"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">    <span class="c1">// 动态设置表名，查询所有的用户信息
</span><span class="c1"></span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="nf">getAllUser</span><span class="o">(</span><span class="nd">@Param</span><span class="o">(</span><span class="s">&#34;tableName&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">tableName</span><span class="o">);</span>

</code></pre></div><p>这里也只能用 ${}, 会出现错误 <strong>preparing : select * from ? (BaseJdbcLogger.java)</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">   <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getAllUsert&#34;</span> <span class="na">resultType=</span><span class="s">&#34;User&#34;</span><span class="nt">&gt;</span>
     select * from ${tableName};
   <span class="nt">&lt;/select&gt;</span>
</code></pre></div><h4 id="添加功能获取自增的主键">添加功能获取自增的主键</h4>
<p><a id="markdown-%E6%B7%BB%E5%8A%A0%E5%8A%9F%E8%83%BD%E8%8E%B7%E5%8F%96%E8%87%AA%E5%A2%9E%E7%9A%84%E4%B8%BB%E9%94%AE" name="%E6%B7%BB%E5%8A%A0%E5%8A%9F%E8%83%BD%E8%8E%B7%E5%8F%96%E8%87%AA%E5%A2%9E%E7%9A%84%E4%B8%BB%E9%94%AE"></a></p>
<ul>
<li>
<p>t_clazz(clazz_id,clazz_name)</p>
</li>
<li>
<p>t_student(student_id,student_name,clazz_id)</p>
</li>
<li>
<p>添加班级信息</p>
</li>
<li>
<p>获取新添加的班级的 id</p>
</li>
<li>
<p>为班级分配学生，即将某学的班级 id 修改为新添加的班级的 id</p>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">    <span class="c1">//  添加用户信息
</span><span class="c1"></span>    <span class="kt">int</span> <span class="nf">insertUser</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">);</span>

</code></pre></div><p><strong>useGeneratedKeys: 设置使用自增的主键</strong></p>
<p><strong>keyProperty：因为增删改有统一的返回值是受影响的行数，因此只能将获取的自增的主键放在传输的参数 user 对象的某个属性中</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">// <span class="c">&lt;!--int insertUser(User user);--&gt;</span>
   <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;insertUser&#34;</span> <span class="na">useGeneratedKeys=</span><span class="s">&#34;true&#34;</span> <span class="na">keyProperty=</span><span class="s">&#34;id&#34;</span><span class="nt">&gt;</span>
     insert into t_user values(null,#{username},#{password},#{age},#{sex})
   <span class="nt">&lt;/select&gt;</span>
</code></pre></div><h4 id="namespace">namespace</h4>
<p><a id="markdown-namespace" name="namespace"></a></p>
<h5 id="namespace-中的包名要和-daomapper-接口的包名一致">namespace 中的包名要和 Dao/Mapper 接口的包名一致</h5>
<p><a id="markdown-namespace-%E4%B8%AD%E7%9A%84%E5%8C%85%E5%90%8D%E8%A6%81%E5%92%8C-dao%2Fmapper-%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%8C%85%E5%90%8D%E4%B8%80%E8%87%B4" name="namespace-%E4%B8%AD%E7%9A%84%E5%8C%85%E5%90%8D%E8%A6%81%E5%92%8C-dao%2Fmapper-%E6%8E%A5%E5%8F%A3%E7%9A%84%E5%8C%85%E5%90%8D%E4%B8%80%E8%87%B4"></a></p>
<h4 id="注意事项">注意事项</h4>
<p><a id="markdown-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" name="%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"></a></p>
<ul>
<li>
<p>id ：就是对应的 namespace 接口中的方法名</p>
</li>
<li>
<p>resuleType ：SQL 语句执行的返回值</p>
</li>
<li>
<p>parameterType ：参数类型</p>
</li>
</ul>
<h4 id="注意增删改需要提交事务"><em><strong>注意：增删改需要提交事务</strong></em></h4>
<p><a id="markdown-***%E6%B3%A8%E6%84%8F%EF%BC%9A%E5%A2%9E%E5%88%A0%E6%94%B9%E9%9C%80%E8%A6%81%E6%8F%90%E4%BA%A4%E4%BA%8B%E5%8A%A1***" name="***%E6%B3%A8%E6%84%8F%EF%BC%9A%E5%A2%9E%E5%88%A0%E6%94%B9%E9%9C%80%E8%A6%81%E6%8F%90%E4%BA%A4%E4%BA%8B%E5%8A%A1***"></a>
<figure><img src="/images/batis3.png"
         alt="image"/><figcaption>
            <h4>提交事务</h4>
        </figcaption>
</figure>
</p>
<h4 id="编写接口">编写接口</h4>
<p><a id="markdown-%E7%BC%96%E5%86%99%E6%8E%A5%E5%8F%A3" name="%E7%BC%96%E5%86%99%E6%8E%A5%E5%8F%A3"></a>
<figure><img src="/images/batis4.png"
         alt="image"/><figcaption>
            <h4>编写接口</h4>
        </figcaption>
</figure>
</p>
<h4 id="mapper-的-sql-语句">mapper 的 sql 语句</h4>
<p><a id="markdown-mapper-%E7%9A%84-sql-%E8%AF%AD%E5%8F%A5" name="mapper-%E7%9A%84-sql-%E8%AF%AD%E5%8F%A5"></a></p>
<figure><img src="/images/batis5.png"
         alt="image"/><figcaption>
            <h4>mapper</h4>
        </figcaption>
</figure>

<h4 id="测试">测试</h4>
<p><a id="markdown-%E6%B5%8B%E8%AF%95" name="%E6%B5%8B%E8%AF%95"></a></p>
<h4 id="假设我们的实体类或者数据库中的表字段或者参数过多我们应当考虑使用-map">假设，我们的实体类，或者数据库中的表，字段或者参数过多，我们应当考虑使用 Map</h4>
<p><a id="markdown-%E5%81%87%E8%AE%BE%EF%BC%8C%E6%88%91%E4%BB%AC%E7%9A%84%E5%AE%9E%E4%BD%93%E7%B1%BB%EF%BC%8C%E6%88%96%E8%80%85%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84%E8%A1%A8%EF%BC%8C%E5%AD%97%E6%AE%B5%E6%88%96%E8%80%85%E5%8F%82%E6%95%B0%E8%BF%87%E5%A4%9A%EF%BC%8C%E6%88%91%E4%BB%AC%E5%BA%94%E5%BD%93%E8%80%83%E8%99%91%E4%BD%BF%E7%94%A8-map" name="%E5%81%87%E8%AE%BE%EF%BC%8C%E6%88%91%E4%BB%AC%E7%9A%84%E5%AE%9E%E4%BD%93%E7%B1%BB%EF%BC%8C%E6%88%96%E8%80%85%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84%E8%A1%A8%EF%BC%8C%E5%AD%97%E6%AE%B5%E6%88%96%E8%80%85%E5%8F%82%E6%95%B0%E8%BF%87%E5%A4%9A%EF%BC%8C%E6%88%91%E4%BB%AC%E5%BA%94%E5%BD%93%E8%80%83%E8%99%91%E4%BD%BF%E7%94%A8-map"></a></p>
<h3 id="模糊查询-1">模糊查询</h3>
<p><a id="markdown-%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2" name="%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"></a></p>
<blockquote>
<p>List<User> userLike = userMapper.getUserLike(&quot;%li%&quot;);</p>
</blockquote>
<h3 id="配置解析">配置解析</h3>
<p><a id="markdown-%E9%85%8D%E7%BD%AE%E8%A7%A3%E6%9E%90" name="%E9%85%8D%E7%BD%AE%E8%A7%A3%E6%9E%90"></a></p>
<h3 id="类型别名-typealiases">类型别名 typeAliases</h3>
<p><a id="markdown-%E7%B1%BB%E5%9E%8B%E5%88%AB%E5%90%8D-typealiases" name="%E7%B1%BB%E5%9E%8B%E5%88%AB%E5%90%8D-typealiases"></a></p>
<p>存在别名的是为 Java 类型设置一个短的名字</p>
<p>存在的意义仅用来减少类完全限定的冗余</p>
<p><strong>alias：设置此类型的别名，若不设置此属性，该类型拥有默认的别名，即类名且不区分大小</strong></p>
<!--<typeAlias type="com.learn.mybatis.bean.User"></typeAlias>-->
<!--<typeAlias type="com.learn.mybatis.bean.User" alias="user">
</typeAlias>-->
<p><strong>更常用： 以包为单位，设置改包下所有的类型都拥有默认的别名，即类名且不区分大小写</strong></p>
<package name="com.learn.mybatis.bean"/>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;typeAliases&gt;</span>
    <span class="nt">&lt;typeAlias</span> <span class="na">type=</span><span class="s">&#34;pojo.User&#34;</span> <span class="na">alias=</span><span class="s">&#34;user&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/typeAliases&gt;</span>
</code></pre></div><p>  也可以指定一个包名，Mybatis 会在包名下面搜索 java Bean ，比如：
  扫描实体类的包，它的默认别名就是为这个类的类型，首字母小写</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;typeAliases&gt;</span>
    <span class="nt">&lt;package</span> <span class="na">name=</span><span class="s">&#34;pojo&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/typeAliases&gt;</span>
</code></pre></div><p>  在实体类比较少的时候，使用第一种方式</p>
<p>  如果实体类十分多，建议使用第二种</p>
<p>  第一种可以 DIY 别名，第二种则不行，如果非要改，需要在实体上增加注解</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Alias</span><span class="o">(</span><span class="s">&#34;user&#34;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
</code></pre></div><h3 id="映射器">映射器</h3>
<p><a id="markdown-%E6%98%A0%E5%B0%84%E5%99%A8" name="%E6%98%A0%E5%B0%84%E5%99%A8"></a></p>
<blockquote>
<p>MyBatis 中的 mapper 接口相当于以前的 dao。但是区别在于，mapper 仅仅是接口，我们不需要
提供实现类。</p>
</blockquote>
<blockquote>
<p>MapperRegistry：注册绑定我们的 Mapper 文件；</p>
</blockquote>
<p>方式一：</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;mappers&gt;</span>
    <span class="nt">&lt;mapper</span> <span class="na">resource=</span><span class="s">&#34;dao/UserMapper.xml&#34;</span><span class="nt">/&gt;</span>
    <span class="c">&lt;!--通配方式--&gt;</span>
    <span class="nt">&lt;mapper</span> <span class="na">resource=</span><span class="s">&#34;dao/*Mapper.xml&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/mappers&gt;</span>
</code></pre></div><p>方式二：使用 class 文件绑定注册</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!--每一个Mapper.xml都需要在Mybatis核心配置文件中注册--&gt;</span>
<span class="nt">&lt;mappers&gt;</span>
    <span class="nt">&lt;mapper</span> <span class="na">class=</span><span class="s">&#34;dao.UserMapper&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/mappers&gt;</span>
</code></pre></div><p>注意点：</p>
<p>  接口和他的 mapper 文件都需要在 Mybatis 核心配置文件中注册</p>
<p>  接口和他的 mapper 文件配置文件必须再同一包下</p>
<p>方式三：使用扫描包注册</p>
<p>  接口和他的 mapper 文件配置文件必须再同一包下</p>
<p>放在 resources 下面的时候，要和 mapper 文件类名字一一对应</p>
<p>比如 java 下面的 com.learn.mybatis.mapper</p>
<p>那 resources 下要把 xml 文件 放进 com.learn.mybatis.mapper 中</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!--每一个Mapper.xml都需要在Mybatis核心配置文件中注册--&gt;</span>
<span class="nt">&lt;package</span> <span class="na">name=</span><span class="s">&#34;dao&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;mappers&gt;</span>
    <span class="nt">&lt;package</span> <span class="na">name=</span><span class="s">&#34;dao&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/mappers&gt;</span>
</code></pre></div><p>注意点：</p>
<p>  接口和他的 Mapper 配置文件必须同名！
  接口和他的 mapper 文件配置文件必须再同一包下！</p>
<blockquote>
<p>1、映射文件的命名规则：<br>
表所对应的实体类的类名+Mapper.xml<br>
例如：表 t_user，映射的实体类为 User，所对应的映射文件为 UserMapper.xml<br>
因此一个映射文件对应一个实体类，对应一张表的操作<br>
MyBatis 映射文件用于编写 SQL，访问以及操作表中的数据<br>
MyBatis 映射文件存放的位置是 src/main/resources/mappers 目录下<br>
2、MyBatis 中可以面向接口操作数据，要保证两个一致：<br>
a&gt;mapper 接口的全类名和映射文件的命名空间（namespace）保持一致<br>
b&gt;mapper 接口中方法的方法名和映射文件中编写 SQL 的标签的 id 属性保持一致</p>
</blockquote>
<h3 id="生命周期和作用域">生命周期和作用域</h3>
<p><a id="markdown-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F" name="%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F"></a></p>
<blockquote>
<p>SqlSession：代表 Java 程序和数据库之间的会话。（HttpSession 是 Java 程序和浏览器之间的会话）<br>
SqlSessionFactory：是“生产”SqlSession 的“工厂”。
工厂模式：如果创建某一个对象，使用的过程基本固定，那么我们就可以把创建这个对象的
相关代码封装到一个“工厂类”中，以后都使用这个工厂类来“生产”我们需要的对象。</p>
</blockquote>
<p><strong>SqlSessionFactory</strong></p>
<ul>
<li>SqlSessionFactory 一旦被创建就应该在应用的运行期间一直存在，没有任何理由丢弃它或重新创建另一个实例。</li>
<li>SqlSessionFactory 的最佳作用域是应用作用域。</li>
<li>最简单的就是使用单例模式或者静态单例模式</li>
</ul>
<p><strong>SqlSession（相当于从连接池中获取一个连接）</strong></p>
<ul>
<li>连接到连接池的请求</li>
<li>关闭</li>
<li>SqlSession 的实例不是线程安全的，因此是不能被共享的，它的最佳的作用域是请求或方法作用域</li>
<li>用完之后需要赶紧关闭，</li>
<li>一个 SQLSession 可以多次使用它的 getMapper 方法，获取多个 mapper 接口实例</li>
</ul>
<h3 id="resultmap-结果集映射">ResultMap 结果集映射</h3>
<p><a id="markdown-resultmap-%E7%BB%93%E6%9E%9C%E9%9B%86%E6%98%A0%E5%B0%84" name="resultmap-%E7%BB%93%E6%9E%9C%E9%9B%86%E6%98%A0%E5%B0%84"></a></p>
<p>查询的标签 select 必须设置属性 resultType 或 resultMap，用于设置实体类和数据库表的映射
关系</p>
<p>resultType：自动映射，用于属性名和表中字段名一致的情况
resultMap：自定义映射，用于一对多或多对一或字段名和属性名不一致的情况</p>
<p>resultMap 元素是 MyBatis 中最重要最强大的元素。
  ResultMap 的设计思想是，对简单的语句做到零配置，对于复杂一点的语句，只需要描述语句之间的关系就行了。
  MyBatis 会在幕后自动创建一个 ResultMap，再根据属性名来映射列到 JavaBean 的属性上。</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&#34;UserMap&#34;</span> <span class="na">type=</span><span class="s">&#34;pojo.User&#34;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&#34;id&#34;</span> <span class="na">column=</span><span class="s">&#34;id&#34;</span><span class="nt">/&gt;</span>
    <span class="c">&lt;!--column 数据库的字段, property JavaBean中的属性--&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;name&#34;</span> <span class="na">column=</span><span class="s">&#34;name&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;password&#34;</span> <span class="na">column=</span><span class="s">&#34;pwd&#34;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>
</code></pre></div><figure><img src="/images/batis6.png"
         alt="image"/><figcaption>
            <h4>ResultMap 配置</h4>
        </figcaption>
</figure>

<figure><img src="/images/batis7.png"
         alt="image"/><figcaption>
            <h4>ResultMap 配置</h4>
        </figcaption>
</figure>

<h4 id="resultmap-这里resultmap-idusermap-typepojouser要写完包名不然会出错">resultmap 这里<resultMap id="UserMap" type="pojo.User">要写完包名，不然会出错</h4>
<p><a id="markdown-resultmap-%E8%BF%99%E9%87%8C%3Cresultmap-id%3D%22usermap%22-type%3D%22pojo.user%22%3E%E8%A6%81%E5%86%99%E5%AE%8C%E5%8C%85%E5%90%8D%EF%BC%8C%E4%B8%8D%E7%84%B6%E4%BC%9A%E5%87%BA%E9%94%99" name="resultmap-%E8%BF%99%E9%87%8C%3Cresultmap-id%3D%22usermap%22-type%3D%22pojo.user%22%3E%E8%A6%81%E5%86%99%E5%AE%8C%E5%8C%85%E5%90%8D%EF%BC%8C%E4%B8%8D%E7%84%B6%E4%BC%9A%E5%87%BA%E9%94%99"></a></p>
<figure><img src="/images/batis8.png"
         alt="image"/><figcaption>
            <h4>ResultMap 配置</h4>
        </figcaption>
</figure>

<h3 id="日志">日志</h3>
<p><a id="markdown-%E6%97%A5%E5%BF%97" name="%E6%97%A5%E5%BF%97"></a></p>
<h4 id="stdout_logging">STDOUT_LOGGING</h4>
<p><a id="markdown-stdout_logging" name="stdout_logging"></a>
<figure><img src="/images/batis9.png"
         alt="image"/><figcaption>
            <h4>ResultMap 配置</h4>
        </figcaption>
</figure>
</p>
<h4 id="log4j">LOG4J</h4>
<p><a id="markdown-log4j" name="log4j"></a></p>
<ul>
<li>导入 log4j 包</li>
</ul>
<blockquote>
<setting name="logImpl" value="LOG4J"/>
</blockquote>
<ul>
<li>搜索 log4j.properties 文件配置</li>
</ul>
<p>参数为当前类的 class</p>
<blockquote>
<p>static Logger logger = Logger.getLogger(UserTest.class);</p>
</blockquote>
<figure><img src="/images/batis10.png"
         alt="image"/><figcaption>
            <h4>ResultMap 配置</h4>
        </figcaption>
</figure>

<h3 id="分页">分页</h3>
<p><a id="markdown-%E5%88%86%E9%A1%B5" name="%E5%88%86%E9%A1%B5"></a></p>
<p>思考：为什么要分页？</p>
<p>减少数据的处理量</p>
<h4 id="语法">语法</h4>
<p><a id="markdown-%E8%AF%AD%E6%B3%95" name="%E8%AF%AD%E6%B3%95"></a></p>
<blockquote>
<p>select * from users limit startIndex, PageSize;</p>
</blockquote>
<blockquote>
<p>select * from users limit 0, 2;</p>
</blockquote>
<h4 id="mybatis-实现分页-核心-sql">mybatis 实现分页， 核心 SQL</h4>
<p><a id="markdown-mybatis-%E5%AE%9E%E7%8E%B0%E5%88%86%E9%A1%B5%EF%BC%8C-%E6%A0%B8%E5%BF%83-sql" name="mybatis-%E5%AE%9E%E7%8E%B0%E5%88%86%E9%A1%B5%EF%BC%8C-%E6%A0%B8%E5%BF%83-sql"></a></p>
<ul>
<li>
<ol>
<li>接口</li>
</ol>
</li>
</ul>
<blockquote>
<p>List<User> getUserByLimit(Map&lt;String, Integer&gt; map);</p>
</blockquote>
<ul>
<li>
<ol start="2">
<li>Mapper.xml
<figure><img src="/images/batis11.png"
         alt="image"/><figcaption>
            <h4>ResultMap 配置</h4>
        </figcaption>
</figure>
</li>
</ol>
</li>
<li>
<ol start="3">
<li>测试</li>
</ol>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java">   <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test3</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">SqlSession</span> <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">MybatisUtils</span><span class="o">.</span><span class="na">getSqlSession</span><span class="o">();</span>
        <span class="n">UserMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">getMapper</span><span class="o">(</span><span class="n">UserMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;startIndex&#34;</span><span class="o">,</span> <span class="n">0</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;pageSize&#34;</span><span class="o">,</span> <span class="n">2</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">limit</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">getUserByLimit</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">User</span> <span class="n">user</span> <span class="o">:</span> <span class="n">limit</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
        <span class="o">}</span>

    <span class="o">}</span>
</code></pre></div><h3 id="注解开发">注解开发</h3>
<p><a id="markdown-%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91" name="%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91"></a></p>
<p><strong>对稍微复杂一点的语句，最好使用 xml 配映射语句</strong></p>
<h4 id="面向接口编程">面向接口编程</h4>
<p><a id="markdown-%E9%9D%A2%E5%90%91%E6%8E%A5%E5%8F%A3%E7%BC%96%E7%A8%8B" name="%E9%9D%A2%E5%90%91%E6%8E%A5%E5%8F%A3%E7%BC%96%E7%A8%8B"></a></p>
<p>在真正的开发中，很多时候我们会选择面向 <em><strong>接口编程</strong></em>。</p>
<p><em><strong>根本原因:解耦，可拓展，提高复用，分层开发中，上层不用管具体的实现，大家都遵守共同的标准，使得开发变得容易，规范性更好</strong></em></p>
<p>在一个面向对象的系统中，系统的各种功能是由许许多多的不同对象协作完成的。在这种情况下，各个对象内部是如何实现自己的, <em><strong>对系统设计人员来讲就不那么重要了</strong></em> ;</p>
<p>而各个对象之间的协作关系则成为系统设计的关键。小到不同类之间的通信，大到各模块之间的交互，在系统设计之初都是要着重考虑的，这也是系统设计的主要工作内容。面向接口编程就是指按照这种思想来编程。</p>
<p>关于接口的理解</p>
<ul>
<li>接口从更深层次的理解，应是 <em><strong>定义</strong></em>(规范，约束)与 <em><strong>实现</strong></em>(名实分离的原则）的分离。</li>
<li>接口的本身反映了系统设计人员对 <em><strong>系统</strong></em> 的抽象理解。</li>
</ul>
<p>接口应有两类:</p>
<ul>
<li>第一类是对一个 <em><strong>个体的抽象</strong></em>，它可对应为一个 <em><strong>抽象体(abstract class)</strong></em>;</li>
<li>第二类是对 <em><strong>一个个体某一方面的抽象</strong></em>，即形成 <em><strong>一个抽象面(interface)</strong></em> ;
一个体有可能有多个抽象面。抽象体与抽象面是有区别的。</li>
</ul>
<p>三个面向区别:</p>
<ul>
<li>面向对象是指，我们考虑问题时，以 <em><strong>对象</strong></em>为单位，考虑它的属性及方法．</li>
<li>面向过程是指，我们考虑问题时，以 ***一个具体的流程（事务过程)***为单位，考虑它的实现.</li>
<li>接口设计与非接口设计是针对复用技术而言的，与面向对象（过程)不是一个问题.更多的体现就是对系统整体的架构</li>
</ul>
<h3 id="执行流程剖析">执行流程剖析</h3>
<p><a id="markdown-%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%89%96%E6%9E%90" name="%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%89%96%E6%9E%90"></a></p>
<h4 id="1-resources-获取加载全局配置文件">1. Resources 获取加载全局配置文件</h4>
<p><a id="markdown-resources-%E8%8E%B7%E5%8F%96%E5%8A%A0%E8%BD%BD%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" name="resources-%E8%8E%B7%E5%8F%96%E5%8A%A0%E8%BD%BD%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"></a></p>
<h4 id="2-实例化-sqlsessionfactorybuilder-对象">2. 实例化 sqlsessionfactoryBuilder 对象</h4>
<p><a id="markdown-%E5%AE%9E%E4%BE%8B%E5%8C%96-sqlsessionfactorybuilder-%E5%AF%B9%E8%B1%A1" name="%E5%AE%9E%E4%BE%8B%E5%8C%96-sqlsessionfactorybuilder-%E5%AF%B9%E8%B1%A1"></a></p>
<h4 id="3-解析文件流-xmlconfigbuilder">3. 解析文件流 XMLConfigBuilder</h4>
<p><a id="markdown-%E8%A7%A3%E6%9E%90%E6%96%87%E4%BB%B6%E6%B5%81-xmlconfigbuilder" name="%E8%A7%A3%E6%9E%90%E6%96%87%E4%BB%B6%E6%B5%81-xmlconfigbuilder"></a></p>
<h4 id="4-configuration-所有的配置信息">4. Configuration 所有的配置信息</h4>
<p><a id="markdown-configuration-%E6%89%80%E6%9C%89%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF" name="configuration-%E6%89%80%E6%9C%89%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF"></a></p>
<h4 id="5-实例化-sqlsessionfactory-对象">5. 实例化 sqlsessionfactory 对象</h4>
<p><a id="markdown-%E5%AE%9E%E4%BE%8B%E5%8C%96-sqlsessionfactory-%E5%AF%B9%E8%B1%A1" name="%E5%AE%9E%E4%BE%8B%E5%8C%96-sqlsessionfactory-%E5%AF%B9%E8%B1%A1"></a></p>
<h4 id="6-transactioncaches">6. transactionCaches</h4>
<p><a id="markdown-transactioncaches" name="transactioncaches"></a></p>
<h4 id="7-创建-executor-执行器">7. 创建 executor 执行器</h4>
<p><a id="markdown-%E5%88%9B%E5%BB%BA-executor-%E6%89%A7%E8%A1%8C%E5%99%A8" name="%E5%88%9B%E5%BB%BA-executor-%E6%89%A7%E8%A1%8C%E5%99%A8"></a></p>
<h4 id="8-创建-sqlsession">8. 创建 sqlsession</h4>
<p><a id="markdown-%E5%88%9B%E5%BB%BA-sqlsession" name="%E5%88%9B%E5%BB%BA-sqlsession"></a></p>
<h4 id="9-实现-crud-会和-6-连接-回滚">9. 实现 CRUD (会和 6 连接， 回滚)</h4>
<p><a id="markdown-%E5%AE%9E%E7%8E%B0-crud-%E4%BC%9A%E5%92%8C-6-%E8%BF%9E%E6%8E%A5%EF%BC%8C-%E5%9B%9E%E6%BB%9A" name="%E5%AE%9E%E7%8E%B0-crud-%E4%BC%9A%E5%92%8C-6-%E8%BF%9E%E6%8E%A5%EF%BC%8C-%E5%9B%9E%E6%BB%9A"></a></p>
<h4 id="10-查看是否成功-会和-6-连接-回滚">10. 查看是否成功 (会和 6 连接， 回滚)</h4>
<p><a id="markdown-%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F-%E4%BC%9A%E5%92%8C-6-%E8%BF%9E%E6%8E%A5%EF%BC%8C-%E5%9B%9E%E6%BB%9A" name="%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F-%E4%BC%9A%E5%92%8C-6-%E8%BF%9E%E6%8E%A5%EF%BC%8C-%E5%9B%9E%E6%BB%9A"></a></p>
<h4 id="11-提交事务">11. 提交事务</h4>
<p><a id="markdown-%E6%8F%90%E4%BA%A4%E4%BA%8B%E5%8A%A1" name="%E6%8F%90%E4%BA%A4%E4%BA%8B%E5%8A%A1"></a></p>
<h4 id="12-关闭">12. 关闭</h4>
<p><a id="markdown-%E5%85%B3%E9%97%AD" name="%E5%85%B3%E9%97%AD"></a></p>
<h3 id="环境搭建">环境搭建</h3>
<p><a id="markdown-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA" name="%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"></a></p>
<ul>
<li>mybatis01
<ul>
<li>src
<ul>
<li>main
<ul>
<li>java
<ul>
<li>com.demo.mybatis
<ul>
<li>mapper
<ul>
<li>DeptMapper</li>
</ul>
</li>
<li>pojo</li>
<li>utils</li>
</ul>
</li>
</ul>
</li>
<li>resources
<ul>
<li>com/demo/mybatis
<ul>
<li>DeptMapper.xml</li>
</ul>
</li>
<li>jdbc.properties</li>
<li>log4j.xml</li>
<li>mybatis-config.xml</li>
</ul>
</li>
<li>test
<ul>
<li>java
<ul>
<li>com.demo.mybatis</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="mybatis-通过字段别名解决字段名和属性名的映射关系">MyBatis 通过字段别名解决字段名和属性名的映射关系</h4>
<p><a id="markdown-mybatis-%E9%80%9A%E8%BF%87%E5%AD%97%E6%AE%B5%E5%88%AB%E5%90%8D%E8%A7%A3%E5%86%B3%E5%AD%97%E6%AE%B5%E5%90%8D%E5%92%8C%E5%B1%9E%E6%80%A7%E5%90%8D%E7%9A%84%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB" name="mybatis-%E9%80%9A%E8%BF%87%E5%AD%97%E6%AE%B5%E5%88%AB%E5%90%8D%E8%A7%A3%E5%86%B3%E5%AD%97%E6%AE%B5%E5%90%8D%E5%92%8C%E5%B1%9E%E6%80%A7%E5%90%8D%E7%9A%84%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB"></a></p>
<p><strong>实体类</strong></p>
<blockquote>
<p>private String empName;</p>
</blockquote>
<p><strong>mysql</strong></p>
<blockquote>
<p>emp_name</p>
</blockquote>
<h4 id="method-1-别名">method 1 别名</h4>
<p><a id="markdown-method-1-%E5%88%AB%E5%90%8D" name="method-1-%E5%88%AB%E5%90%8D"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getAllEmp&#34;</span> <span class="na">resultType=</span><span class="s">&#34;Emp&#34;</span><span class="nt">&gt;</span>
    select * from t_emp
<span class="nt">&lt;/select&gt;</span>
</code></pre></div><p>改为</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getAllEmp&#34;</span> <span class="na">resultType=</span><span class="s">&#34;Emp&#34;</span><span class="nt">&gt;</span>
    select eid, emp_name empName, age, sex, email from t_emp
<span class="nt">&lt;/select&gt;</span>
</code></pre></div><figure><img src="/images/batis13.png"
         alt="image"/><figcaption>
            <h4>ResultMap 配置</h4>
        </figcaption>
</figure>

<h4 id="method-2-全局配置-mapunderscoretocamelcase">method 2 全局配置 mapUnderscoreToCamelCase</h4>
<p><a id="markdown-method-2-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE-mapunderscoretocamelcase" name="method-2-%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE-mapunderscoretocamelcase"></a></p>
<p><strong>将下划线自动映射为驼峰</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">    <span class="nt">&lt;settings&gt;</span>
<span class="c">&lt;!--        将下划线自动映射为驼峰， emp_name : empName--&gt;</span>
        <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&#34;mapUnderscoreToCamelCase&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/settings&gt;</span>
</code></pre></div><h4 id="method-3-resultmap">method 3 resultMap</h4>
<p><a id="markdown-method-3-resultmap" name="method-3-resultmap"></a></p>
<h3 id="could-not-find-resource-daoxml">Could not find resource dao/*.xml</h3>
<p><a id="markdown-could-not-find-resource-dao%2F*.xml" name="could-not-find-resource-dao%2F*.xml"></a></p>
<ul>
<li>pom 里面</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"> <span class="o">&lt;</span><span class="n">directory</span><span class="o">&gt;</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">resources</span><span class="o">&lt;/</span><span class="n">directory</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">includes</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">include</span><span class="o">&gt;**</span><span class="cm">/*.properties&lt;/include&gt;
</span><span class="cm">                    &lt;include&gt;**/</span><span class="o">*.</span><span class="na">xml</span><span class="o">&lt;/</span><span class="n">include</span><span class="o">&gt;</span>

</code></pre></div><ul>
<li>target 里面 classes 下面的 dao 都存在 mapper 和 mapper.xml</li>
</ul>
<p>但是就是无法读取，所以改为 package 或者 class 才可以</p>
<h3 id="多对一处理">多对一处理</h3>
<p><a id="markdown-%E5%A4%9A%E5%AF%B9%E4%B8%80%E5%A4%84%E7%90%86" name="%E5%A4%9A%E5%AF%B9%E4%B8%80%E5%A4%84%E7%90%86"></a></p>
<p>多个学生<strong>关联</strong>一个老师 ： <strong>多对一</strong></p>
<p>老师， <strong>集合</strong>， 集合里面很多学生， <strong>一对多</strong></p>
<p><strong>要把表关系设置在多的这一方</strong></p>
<p><strong>Emp 实体类</strong></p>
<blockquote>
<p>private Dept dept;</p>
</blockquote>
<p><strong>在实体类中是 Dept 实体类，在表格中是 int 类</strong></p>
<h4 id="a-级联方式处理映射关系">a. 级联方式处理映射关系</h4>
<p><a id="markdown-a.-%E7%BA%A7%E8%81%94%E6%96%B9%E5%BC%8F%E5%A4%84%E7%90%86%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB" name="a.-%E7%BA%A7%E8%81%94%E6%96%B9%E5%BC%8F%E5%A4%84%E7%90%86%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">
    <span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&#34;empAndDeptResultMapOne&#34;</span> <span class="na">type=</span><span class="s">&#34;Emp&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&#34;eid&#34;</span> <span class="na">column=</span><span class="s">&#34;eid&#34;</span><span class="nt">&gt;&lt;/id&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;empName&#34;</span> <span class="na">column=</span><span class="s">&#34;emp_name&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;age&#34;</span> <span class="na">column=</span><span class="s">&#34;age&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;sex&#34;</span> <span class="na">column=</span><span class="s">&#34;sex&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;email&#34;</span> <span class="na">column=</span><span class="s">&#34;email&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;dept.did&#34;</span> <span class="na">column=</span><span class="s">&#34;did&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;dept.deptName&#34;</span> <span class="na">column=</span><span class="s">&#34;dept_name&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
    <span class="nt">&lt;/resultMap&gt;</span>


<span class="c">&lt;!--  级联方式处理映射关系 多对一处理--&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getEmpAndDept&#34;</span> <span class="na">resultMap=</span><span class="s">&#34;empAndDeptResultMapOne&#34;</span><span class="nt">&gt;</span>
        select * from t_emp left join t_dept on t_emp.did = t_dept.did where t_emp.eid = #{eid};
    <span class="nt">&lt;/select&gt;</span>
</code></pre></div><h4 id="b-使用-association-处理映射关系">b. 使用 association 处理映射关系</h4>
<p><a id="markdown-b.-%E4%BD%BF%E7%94%A8-association-%E5%A4%84%E7%90%86%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB" name="b.-%E4%BD%BF%E7%94%A8-association-%E5%A4%84%E7%90%86%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">    <span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&#34;empAndDeptResultMapOne&#34;</span> <span class="na">type=</span><span class="s">&#34;Emp&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&#34;eid&#34;</span> <span class="na">column=</span><span class="s">&#34;eid&#34;</span><span class="nt">&gt;&lt;/id&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;empName&#34;</span> <span class="na">column=</span><span class="s">&#34;emp_name&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;age&#34;</span> <span class="na">column=</span><span class="s">&#34;age&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;sex&#34;</span> <span class="na">column=</span><span class="s">&#34;sex&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;email&#34;</span> <span class="na">column=</span><span class="s">&#34;email&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
        <span class="nt">&lt;association</span> <span class="na">property=</span><span class="s">&#34;dept&#34;</span> <span class="na">javaType=</span><span class="s">&#34;Dept&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&#34;did&#34;</span> <span class="na">column=</span><span class="s">&#34;did&#34;</span><span class="nt">&gt;&lt;/id&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;deptName&#34;</span> <span class="na">column=</span><span class="s">&#34;dept_name&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
        <span class="nt">&lt;/association&gt;</span>
    <span class="nt">&lt;/resultMap&gt;</span>

<span class="c">&lt;!--  association 处理映射关系 多对一处理--&gt;</span>
<span class="c">&lt;!--  javaType 该属性类型--&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getEmpAndDept&#34;</span> <span class="na">resultMap=</span><span class="s">&#34;empAndDeptResultMapOne&#34;</span><span class="nt">&gt;</span>
        select * from t_emp left join t_dept on t_emp.did = t_dept.did where t_emp.eid = #{eid};
    <span class="nt">&lt;/select&gt;</span>
</code></pre></div><h4 id="c-分步查询">c. 分步查询</h4>
<p><a id="markdown-c.-%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2" name="c.-%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">
    
       <span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&#34;empAndDeptResultMapThree&#34;</span> <span class="na">type=</span><span class="s">&#34;Emp&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&#34;eid&#34;</span> <span class="na">column=</span><span class="s">&#34;eid&#34;</span><span class="nt">&gt;&lt;/id&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;empName&#34;</span> <span class="na">column=</span><span class="s">&#34;emp_name&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;age&#34;</span> <span class="na">column=</span><span class="s">&#34;age&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;sex&#34;</span> <span class="na">column=</span><span class="s">&#34;sex&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;email&#34;</span> <span class="na">column=</span><span class="s">&#34;email&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
        <span class="nt">&lt;association</span> <span class="na">property=</span><span class="s">&#34;dept&#34;</span>
                     <span class="na">select=</span><span class="s">&#34;com.demo.mybatis.mapper.DeptMapper.getEmpAndDeptByStepTwo&#34;</span>
                        <span class="na">column=</span><span class="s">&#34;did&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/association&gt;</span>
    <span class="nt">&lt;/resultMap&gt;</span>
<span class="c">&lt;!-- select 是 deptMapper 上面id 的reference --&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getEmpAndDeptByStep&#34;</span> <span class="na">resultMap=</span><span class="s">&#34;empAndDeptResultMapThree&#34;</span><span class="nt">&gt;</span>
        select * from t_emp where eid = #{eid};
    <span class="nt">&lt;/select&gt;</span>
</code></pre></div><p><strong>DeptMapper</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&#34;com.demo.mybatis.mapper.DeptMapper&#34;</span><span class="nt">&gt;</span>
<span class="c">&lt;!--    Dept getEmpAndDeptByStepTwo(@Param(&#34;did&#34;) Integer did);--&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getEmpAndDeptByStepTwo&#34;</span> <span class="na">resultType=</span><span class="s">&#34;Dept&#34;</span><span class="nt">&gt;</span>
        select * from t_dept where did = #{did}
    <span class="nt">&lt;/select&gt;</span>
<span class="nt">&lt;/mapper&gt;</span>
</code></pre></div><p><strong>结果是 2 个 sql 语句</strong></p>
<blockquote>
<p>DEBUG 03-23 15:44:26,621 ==&gt;  Preparing: select * from t_emp where eid = ?;<br>
DEBUG 03-23 15:44:26,730 ====&gt;  Preparing: select * from t_dept where did = ?<br>
Emp(eid=3, empName=cc, age=22, sex=女, <a href="mailto:email=123@qq.com">email=123@qq.com</a>, dept=Dept(did=3, deptName=C))</p>
</blockquote>
<p><strong>select: 设置分布查询的 sql 的唯一标识(namespace.SQLId 或 mapper 接口的全类名)</strong></p>
<h5 id="分步查询的优点">分步查询的优点</h5>
<p><a id="markdown-%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2%E7%9A%84%E4%BC%98%E7%82%B9" name="%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2%E7%9A%84%E4%BC%98%E7%82%B9"></a></p>
<p>分步查询的优点：可以实现延迟加载，但是必须在核心配置文件中设置全局配置信息：</p>
<p><strong>lazyLoadingEnabled</strong>：延迟加载的全局开关。当开启时，所有关联对象都会延迟加载</p>
<p><strong>aggressiveLazyLoading</strong>：当开启时，任何方法的调用都会加载该对象的所有属性。 否则，每个
属性会按需加载</p>
<p>此时就可以实现按需加载，获取的数据是什么，就只会执行相应的 sql。此时可通过 <strong>association</strong> 和
<strong>collection</strong>中的 <strong>fetchType</strong> 属性设置当前的分步查询是否使用延迟加载，fetchType=&ldquo;lazy(延迟加
载)|eager(立即加载)&rdquo;</p>
<p><strong>mybatis-config.xml</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!--    设计mybatis全局配置--&gt;</span>
    <span class="nt">&lt;settings&gt;</span>
<span class="c">&lt;!--        将下划线自动映射为驼峰， emp_name : empName--&gt;</span>
        <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&#34;mapUnderscoreToCamelCase&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
<span class="c">&lt;!--       延迟加载--&gt;</span>
        <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">&#34;lazyLoadingEnabled&#34;</span> <span class="na">value=</span><span class="s">&#34;true&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/settings&gt;</span>
</code></pre></div><p><strong>结果</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testGetAllEmpAndDept2</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">SqlSession</span> <span class="n">sqlSession</span> <span class="o">=</span> <span class="n">MybatisUtils</span><span class="o">.</span><span class="na">getSqlSession</span><span class="o">();</span>

        <span class="n">EmpMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="n">sqlSession</span><span class="o">.</span><span class="na">getMapper</span><span class="o">(</span><span class="n">EmpMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="n">Emp</span> <span class="n">emp</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">getEmpAndDeptByStep</span><span class="o">(</span><span class="n">3</span><span class="o">);</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">emp</span><span class="o">.</span><span class="na">getEmpName</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;++++++++++++++++++++++++++++++&#34;</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">emp</span><span class="o">.</span><span class="na">getDept</span><span class="o">());</span>
    <span class="o">}</span>
</code></pre></div><blockquote>
<p>DEBUG 03-23 16:00:38,203 ==&gt;  Preparing: select * from t_emp where eid = ?;  (BaseJdbcLogger.java:143) 
DEBUG 03-23 16:00:38,257 ==&gt; Parameters: 3(Integer) (BaseJdbcLogger.java:143) 
DEBUG 03-23 16:00:38,331 &lt;==      Total: 1 (BaseJdbcLogger.java:143)</p>
</blockquote>
<blockquote>
<p>cc</p>
</blockquote>
<blockquote>
<p>++++++++++++++++++++++++++++++</p>
</blockquote>
<blockquote>
<p>DEBUG 03-23 16:00:38,332 ==&gt;  Preparing: select * from t_dept where did = ?  (BaseJdbcLogger.java:143) 
DEBUG 03-23 16:00:38,333 ==&gt; Parameters: 3(Integer) (BaseJdbcLogger.java:143) 
DEBUG 03-23 16:00:38,335 &lt;==      Total: 1 (BaseJdbcLogger.java:143)</p>
</blockquote>
<blockquote>
<p>Dept(did=3, deptName=C)</p>
</blockquote>
<blockquote>
<p>Process finished with exit code 0</p>
</blockquote>
<p><strong>没有延迟加载</strong></p>
<blockquote>
<p>DEBUG 03-23 16:05:20,189 ==&gt;  Preparing: select * from t_emp where eid = ?;  (BaseJdbcLogger.java:143) 
DEBUG 03-23 16:05:20,239 ==&gt; Parameters: 3(Integer) (BaseJdbcLogger.java:143) 
DEBUG 03-23 16:05:20,278 ====&gt;  Preparing: select * from t_dept where did = ?  (BaseJdbcLogger.java:143) 
DEBUG 03-23 16:05:20,279 ====&gt; Parameters: 3(Integer) (BaseJdbcLogger.java:143) 
DEBUG 03-23 16:05:20,283 &lt;====      Total: 1 (BaseJdbcLogger.java:143) 
DEBUG 03-23 16:05:20,284 &lt;==      Total: 1 (BaseJdbcLogger.java:143)</p>
</blockquote>
<blockquote>
<p>cc</p>
</blockquote>
<blockquote>
<p>++++++++++++++++++++++++++++++</p>
</blockquote>
<blockquote>
<p>Dept(did=3, deptName=C)</p>
</blockquote>
<blockquote>
<p>Process finished with exit code 0</p>
</blockquote>
<h3 id="一对多处理">一对多处理</h3>
<p><a id="markdown-%E4%B8%80%E5%AF%B9%E5%A4%9A%E5%A4%84%E7%90%86" name="%E4%B8%80%E5%AF%B9%E5%A4%9A%E5%A4%84%E7%90%86"></a></p>
<h4 id="a-collection">a. collection</h4>
<p><a id="markdown-a.-collection" name="a.-collection"></a></p>
<p><strong>部门实体类</strong></p>
<blockquote>
<p>List<Emp> emps;</p>
</blockquote>
<p><strong>ofType:表示该属性对应的集合中存储数据类型</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&#34;deptAndEmpResultMap&#34;</span> <span class="na">type=</span><span class="s">&#34;Dept&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&#34;did&#34;</span> <span class="na">column=</span><span class="s">&#34;did&#34;</span><span class="nt">&gt;&lt;/id&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;deptName&#34;</span> <span class="na">column=</span><span class="s">&#34;dept_name&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>

        <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&#34;emps&#34;</span> <span class="na">ofType=</span><span class="s">&#34;Emp&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&#34;eid&#34;</span> <span class="na">column=</span><span class="s">&#34;eid&#34;</span><span class="nt">&gt;&lt;/id&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;empName&#34;</span> <span class="na">column=</span><span class="s">&#34;emp_name&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;age&#34;</span> <span class="na">column=</span><span class="s">&#34;age&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;sex&#34;</span> <span class="na">column=</span><span class="s">&#34;sex&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
            <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;email&#34;</span> <span class="na">column=</span><span class="s">&#34;email&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>
        <span class="nt">&lt;/collection&gt;</span>
    <span class="nt">&lt;/resultMap&gt;</span>

<span class="c">&lt;!--     Dept getDeptAndEmp(@Param(&#34;did&#34;) Integer did);--&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getDeptAndEmp&#34;</span> <span class="na">resultMap=</span><span class="s">&#34;deptAndEmpResultMap&#34;</span><span class="nt">&gt;</span>
        select * from t_dept left join t_emp on t_dept.did = t_emp.did where t_dept.did = #{did}
    <span class="nt">&lt;/select&gt;</span>
</code></pre></div><h4 id="b-分步查询">b. 分步查询</h4>
<p><a id="markdown-b.-%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2" name="b.-%E5%88%86%E6%AD%A5%E6%9F%A5%E8%AF%A2"></a></p>
<blockquote>
<p>Dept getDeptByStepOne(@Param(&ldquo;did&rdquo;) Integer did);</p>
</blockquote>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">    <span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&#34;deptAndEmpResultMapOne&#34;</span> <span class="na">type=</span><span class="s">&#34;Dept&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">property=</span><span class="s">&#34;did&#34;</span> <span class="na">column=</span><span class="s">&#34;did&#34;</span><span class="nt">&gt;&lt;/id&gt;</span>
        <span class="nt">&lt;result</span> <span class="na">property=</span><span class="s">&#34;deptName&#34;</span> <span class="na">column=</span><span class="s">&#34;dept_name&#34;</span><span class="nt">&gt;&lt;/result&gt;</span>

        <span class="nt">&lt;collection</span> <span class="na">property=</span><span class="s">&#34;emps&#34;</span>
                    <span class="na">select=</span><span class="s">&#34;com.demo.mybatis.mapper.EmpMapper.getDeptAndEmpByStepTwo&#34;</span>
                    <span class="na">column=</span><span class="s">&#34;did&#34;</span>
                    <span class="nt">&gt;</span>

        <span class="nt">&lt;/collection&gt;</span>
    <span class="nt">&lt;/resultMap&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getDeptByStepOne&#34;</span> <span class="na">resultMap=</span><span class="s">&#34;deptAndEmpResultMapOne&#34;</span><span class="nt">&gt;</span>
        select * from t_dept where did = #{did}
    <span class="nt">&lt;/select&gt;</span>
</code></pre></div><blockquote>
<p>List<Emp> getDeptAndEmpByStepTwo(@Param(&ldquo;did&rdquo;) Integer did);</p>
</blockquote>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getDeptAndEmpByStepTwo&#34;</span> <span class="na">resultType=</span><span class="s">&#34;Emp&#34;</span><span class="nt">&gt;</span>
        select * from t_emp where did = #{did};
    <span class="nt">&lt;/select&gt;</span>
</code></pre></div><p><strong>分布查询中第二步 resultMap 不需要，直接用 resultType， 但是多对多除外</strong></p>
<h3 id="动态-sql">动态 SQL</h3>
<p><a id="markdown-%E5%8A%A8%E6%80%81-sql" name="%E5%8A%A8%E6%80%81-sql"></a></p>
<h4 id="if">if</h4>
<p><a id="markdown-if" name="if"></a></p>
<p><strong>这个是查询，不是插入</strong></p>
<blockquote>
<p>List<Emp> getEmpByCondition(Emp emp);</p>
</blockquote>
<p><strong>where 1=1 是为了当输入的资料不全时还可以有结果</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"> <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getEmpByCondition&#34;</span> <span class="na">resultType=</span><span class="s">&#34;Emp&#34;</span><span class="nt">&gt;</span>
        select * from t_emp where 1=1
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&#34;empName != &#39;&#39; and empName != null&#34;</span><span class="nt">&gt;</span>
            and emp_name = #{empName}
        <span class="nt">&lt;/if&gt;</span>
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&#34;age != &#39;&#39; and age != null&#34;</span><span class="nt">&gt;</span>
            and age = #{age}
        <span class="nt">&lt;/if&gt;</span>
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&#34;sex != &#39;&#39; and sex != null&#34;</span><span class="nt">&gt;</span>
            and sex = #{sex}
        <span class="nt">&lt;/if&gt;</span>
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&#34;email != &#39;&#39; and email != null&#34;</span><span class="nt">&gt;</span>
            and email = #{email}
        <span class="nt">&lt;/if&gt;</span>

    <span class="nt">&lt;/select&gt;</span>
</code></pre></div><h4 id="where">where</h4>
<p><a id="markdown-where" name="where"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getEmpByCondition&#34;</span> <span class="na">resultType=</span><span class="s">&#34;Emp&#34;</span><span class="nt">&gt;</span>
    select * from t_emp 
        <span class="nt">&lt;where&gt;</span>
            <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&#34;empName != &#39;&#39; and empName != null&#34;</span><span class="nt">&gt;</span>
                 emp_name = #{empName}
            <span class="nt">&lt;/if&gt;</span>
            <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&#34;age != &#39;&#39; and age != null&#34;</span><span class="nt">&gt;</span>
                and age = #{age}
            <span class="nt">&lt;/if&gt;</span>
            <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&#34;sex != &#39;&#39; and sex != null&#34;</span><span class="nt">&gt;</span>
                and sex = #{sex}
            <span class="nt">&lt;/if&gt;</span>
            <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&#34;email != &#39;&#39; and email != null&#34;</span><span class="nt">&gt;</span>
                and email = #{email}
            <span class="nt">&lt;/if&gt;</span>
    <span class="nt">&lt;/where&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</code></pre></div><h4 id="trim">trim</h4>
<p><a id="markdown-trim" name="trim"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"> <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getEmpByCondition&#34;</span> <span class="na">resultType=</span><span class="s">&#34;Emp&#34;</span><span class="nt">&gt;</span>
        select * from t_emp
        <span class="nt">&lt;trim</span> <span class="na">prefix=</span><span class="s">&#34;where&#34;</span> <span class="na">suffixOverrides=</span><span class="s">&#34;and|or&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&#34;empName != &#39;&#39; and empName != null&#34;</span><span class="nt">&gt;</span>
             emp_name = #{empName} and
        <span class="nt">&lt;/if&gt;</span>
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&#34;age != &#39;&#39; and age != null&#34;</span><span class="nt">&gt;</span>
            age = #{age} or
        <span class="nt">&lt;/if&gt;</span>
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&#34;sex != &#39;&#39; and sex != null&#34;</span><span class="nt">&gt;</span>
             sex = #{sex} and
        <span class="nt">&lt;/if&gt;</span>
        <span class="nt">&lt;if</span> <span class="na">test=</span><span class="s">&#34;email != &#39;&#39; and email != null&#34;</span><span class="nt">&gt;</span>
             email = #{email}
        <span class="nt">&lt;/if&gt;</span>
        <span class="nt">&lt;/trim&gt;</span>
    <span class="nt">&lt;/select&gt;</span>
</code></pre></div><blockquote>
<p>trim 若标签中有内容，否则就没效果</p>
</blockquote>
<blockquote>
<p>prefix：在 trim 标签中的内容的前面添加某些内容</p>
</blockquote>
<p>prefixOverrides：在 trim 标签中的内容的前面去掉某些内容</p>
<blockquote>
<p>suffix：在 trim 标签中的内容的后面添加某些内容</p>
</blockquote>
<blockquote>
<p>suffixOverrides：在 trim 标签中的内容的后面去掉某些内容</p>
</blockquote>
<blockquote>
<p>注意：where 标签不能去掉条件最后多余的 and</p>
</blockquote>
<h4 id="choosewhenotherwise">choose、when、otherwise</h4>
<p><a id="markdown-choose%E3%80%81when%E3%80%81otherwise" name="choose%E3%80%81when%E3%80%81otherwise"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&#34;getEmpByChoose&#34;</span> <span class="na">resultType=</span><span class="s">&#34;Emp&#34;</span><span class="nt">&gt;</span>
        select * from t_emp
        <span class="nt">&lt;where&gt;</span>
            <span class="nt">&lt;choose&gt;</span>
                <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">&#34;empName != &#39;&#39; and empName != null&#34;</span><span class="nt">&gt;</span>
                emp_name = #{empName}
                <span class="nt">&lt;/when&gt;</span>
            <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">&#34;age != &#39;&#39; and age != null&#34;</span><span class="nt">&gt;</span>
                age = #{age}
            <span class="nt">&lt;/when&gt;</span>
            <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">&#34;sex != &#39;&#39; and sex != null&#34;</span><span class="nt">&gt;</span>
                sex = #{sex}
            <span class="nt">&lt;/when&gt;</span>
            <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">&#34;email != &#39;&#39; and email != null&#34;</span><span class="nt">&gt;</span>
                email = #{email}
            <span class="nt">&lt;/when&gt;</span>
            <span class="nt">&lt;otherwise&gt;</span>
                did = 1;
            <span class="nt">&lt;/otherwise&gt;</span>
            <span class="nt">&lt;/choose&gt;</span>
        <span class="nt">&lt;/where&gt;</span>
    <span class="nt">&lt;/select&gt;</span>
</code></pre></div><blockquote>
<p>when 至少有一个</p>
</blockquote>
<blockquote>
<p>otherwise 至多有一个</p>
</blockquote>
<h4 id="foreach">foreach</h4>
<p><a id="markdown-foreach" name="foreach"></a></p>
<p><strong>通过数组实现批量删除</strong></p>
<blockquote>
<p>int deleteMoreByArray(@Param(&ldquo;eids&rdquo;) Integer[] eids);</p>
</blockquote>
<blockquote>
<p>@Param(&ldquo;eids&rdquo;) 要写，不然结果是 Parameter <code>eids</code> not found. Available parameters are [array, arg[0]]</p>
</blockquote>
<p><strong>第一种</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="c">&lt;!--     int deleteMoreByArray(Integer eids);--&gt;</span>
    <span class="nt">&lt;delete</span> <span class="na">id=</span><span class="s">&#34;deleteMoreByArray&#34;</span><span class="nt">&gt;</span>
        delete from t_emp where eid in
    (
    <span class="nt">&lt;foreach</span> <span class="na">collection=</span><span class="s">&#34;eids&#34;</span> <span class="na">item=</span><span class="s">&#34;eid&#34;</span> <span class="na">separator=</span><span class="s">&#34;,&#34;</span><span class="nt">&gt;</span>
        #{eid}
    <span class="nt">&lt;/foreach&gt;</span>
    )

    <span class="c">&lt;!-- （）都可以去掉 --&gt;</span>
     
    <span class="nt">&lt;foreach</span> <span class="na">collection=</span><span class="s">&#34;eids&#34;</span> <span class="na">item=</span><span class="s">&#34;eid&#34;</span> <span class="na">separator=</span><span class="s">&#34;,&#34;</span> <span class="na">open=</span><span class="s">&#34;(&#34;</span><span class="err">,</span> <span class="na">close=</span><span class="s">&#34;)&#34;</span><span class="nt">&gt;</span>
        #{eid}
    <span class="nt">&lt;/foreach&gt;</span>
   
    <span class="nt">&lt;/delete&gt;</span>
</code></pre></div><p><strong>通过 list 实现批量插入</strong></p>
<blockquote>
<p>int insertMoreByList(@Param(&ldquo;emps&rdquo;) List<Emp> emps);</p>
</blockquote>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml">  <span class="c">&lt;!--     int deleteMoreByArray(Integer eids);--&gt;</span>
    <span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&#34;insertMoreByList&#34;</span><span class="nt">&gt;</span>
        insert into t_emp values 
        <span class="nt">&lt;foreach</span> <span class="na">collection=</span><span class="s">&#34;emps&#34;</span> <span class="na">item=</span><span class="s">&#34;emp&#34;</span> <span class="na">separator=</span><span class="s">&#34;,&#34;</span><span class="nt">&gt;</span>
            (null, #{emp.empName}, #{emp.age}, #{emp.sex}, #{emp.email}, null)
        <span class="nt">&lt;/foreach&gt;</span>
    <span class="nt">&lt;/insert&gt;</span>
</code></pre></div><blockquote>
<p>DEBUG &lt;==    Updates: 1 (BaseJdbcLogger.java:143)</p>
</blockquote>
<p><strong>出现程序执行， 数据库没更新， 因为 mybatis 默认不是自动提交事务的， openSession() 的括号里写 true, 设定自动提交事务,</strong></p>
<blockquote>
<p>collection：设置要循环的数组或集合</p>
</blockquote>
<blockquote>
<p>item：表示集合或数组中的每一个数据</p>
</blockquote>
<blockquote>
<p>separator：设置循环体之间的分隔符</p>
</blockquote>
<blockquote>
<p>open：设置 foreach 标签中的内容的开始符</p>
</blockquote>
<blockquote>
<p>close：设置 foreach 标签中的内容的结束符</p>
</blockquote>
<h4 id="sql-片段">SQL 片段</h4>
<p><a id="markdown-sql-%E7%89%87%E6%AE%B5" name="sql-%E7%89%87%E6%AE%B5"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;sql</span> <span class="na">id=</span><span class="s">&#34;empColumns&#34;</span><span class="nt">&gt;</span>
eid,ename,age,sex,did
<span class="nt">&lt;/sql&gt;</span>
select <span class="nt">&lt;include</span> <span class="na">refid=</span><span class="s">&#34;empColumns&#34;</span><span class="nt">&gt;&lt;/include&gt;</span> from t_emp
</code></pre></div><p><strong>把常用的属性设置为片段，下面就直接引用了</strong></p>
<h3 id="mybatis-缓存">MyBatis 缓存</h3>
<p><a id="markdown-mybatis-%E7%BC%93%E5%AD%98" name="mybatis-%E7%BC%93%E5%AD%98"></a></p>
<h4 id="一级缓存">一级缓存</h4>
<p><a id="markdown-%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98" name="%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98"></a></p>
<p>一级缓存是 SqlSession 级别的，通过同一个 SqlSession 查询的数据会被缓存，下次查询相同的数据，就
会从缓存中直接获取，不会从数据库重新访问</p>
<h5 id="使一级缓存失效的四种情况">使一级缓存失效的四种情况</h5>
<p><a id="markdown-%E4%BD%BF%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98%E5%A4%B1%E6%95%88%E7%9A%84%E5%9B%9B%E7%A7%8D%E6%83%85%E5%86%B5" name="%E4%BD%BF%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98%E5%A4%B1%E6%95%88%E7%9A%84%E5%9B%9B%E7%A7%8D%E6%83%85%E5%86%B5"></a></p>
<ul>
<li>
<ol>
<li>不同的 SqlSession 对应不同的一级缓存</li>
</ol>
</li>
<li>
<ol start="2">
<li>同一个 SqlSession 但是查询条件不同</li>
</ol>
</li>
<li>
<ol start="3">
<li>同一个 SqlSession 两次查询期间执行了任何一次增删改操作</li>
</ol>
</li>
<li>
<ol start="4">
<li>同一个 SqlSession 两次查询期间手动清空了缓存</li>
</ol>
</li>
</ul>
<h4 id="二级缓存">二级缓存</h4>
<p><a id="markdown-%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98" name="%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98"></a></p>
<p>二级缓存是 SqlSessionFactory 级别，通过同一个 SqlSessionFactory 创建的 SqlSession 查询的结果会被缓存；此后若再次执行相同的查询语句，结果就会从缓存中获取</p>
<h5 id="二级缓存开启的条件">二级缓存开启的条件</h5>
<p><a id="markdown-%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E5%BC%80%E5%90%AF%E7%9A%84%E6%9D%A1%E4%BB%B6" name="%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E5%BC%80%E5%90%AF%E7%9A%84%E6%9D%A1%E4%BB%B6"></a></p>
<ul>
<li>a&gt;在核心配置文件中，设置全局配置属性 cacheEnabled=&ldquo;true&rdquo;，默认为 true，不需要设置</li>
<li>b&gt;在映射文件中设置标签**<cache />**</li>
<li>c&gt;二级缓存必须在 SqlSession 关闭或提交之后有效</li>
<li>d&gt;查询的数据所转换的实体类类型必须实现序列化的接口</li>
</ul>
<h5 id="二级缓存失效的情况">二级缓存失效的情况</h5>
<p><a id="markdown-%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E5%A4%B1%E6%95%88%E7%9A%84%E6%83%85%E5%86%B5" name="%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E5%A4%B1%E6%95%88%E7%9A%84%E6%83%85%E5%86%B5"></a></p>
<p>两次查询之间执行了任意的增删改，会使一级和二级缓存同时失效</p>
<h4 id="mybatis-缓存查询的顺序">MyBatis 缓存查询的顺序</h4>
<p><a id="markdown-mybatis-%E7%BC%93%E5%AD%98%E6%9F%A5%E8%AF%A2%E7%9A%84%E9%A1%BA%E5%BA%8F" name="mybatis-%E7%BC%93%E5%AD%98%E6%9F%A5%E8%AF%A2%E7%9A%84%E9%A1%BA%E5%BA%8F"></a></p>
<ul>
<li>先查询二级缓存，因为二级缓存中可能会有其他程序已经查出来的数据，可以拿来直接使用。</li>
<li>如果二级缓存没有命中，再查询一级缓存</li>
<li>如果一级缓存也没有命中，则查询数据库</li>
<li>SqlSession 关闭之后，一级缓存中的数据会写入二级缓存</li>
</ul>
<h3 id="逆向工程">逆向工程</h3>
<p><a id="markdown-%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B" name="%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B"></a></p>
<h4 id="1-添加依赖和插件">1. 添加依赖和插件</h4>
<p><a id="markdown-%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96%E5%92%8C%E6%8F%92%E4%BB%B6" name="%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96%E5%92%8C%E6%8F%92%E4%BB%B6"></a></p>
<h4 id="2-创建-mybatis-的核心配置文件">2. 创建 MyBatis 的核心配置文件</h4>
<p><a id="markdown-%E5%88%9B%E5%BB%BA-mybatis-%E7%9A%84%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" name="%E5%88%9B%E5%BB%BA-mybatis-%E7%9A%84%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"></a></p>
<h4 id="3-创建逆向工程的配置文件">3. 创建逆向工程的配置文件</h4>
<p><a id="markdown-%E5%88%9B%E5%BB%BA%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" name="%E5%88%9B%E5%BB%BA%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"></a></p>
<blockquote>
<p>文件名必须是：generatorConfig.xml</p>
</blockquote>
<h4 id="4执行-mbg-插件的-generate-目标">4.执行 MBG 插件的 generate 目标</h4>
<p><a id="markdown-%E6%89%A7%E8%A1%8C-mbg-%E6%8F%92%E4%BB%B6%E7%9A%84-generate-%E7%9B%AE%E6%A0%87" name="%E6%89%A7%E8%A1%8C-mbg-%E6%8F%92%E4%BB%B6%E7%9A%84-generate-%E7%9B%AE%E6%A0%87"></a></p>
<blockquote>
<p>Plugins -&gt; mybatis-generator</p>
</blockquote>
<h3 id="分页插件">分页插件</h3>
<p><a id="markdown-%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6" name="%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6"></a></p>
<h4 id="1-依赖">1. 依赖</h4>
<p><a id="markdown-%E4%BE%9D%E8%B5%96" name="%E4%BE%9D%E8%B5%96"></a></p>
<blockquote>
<p>pagehelper</p>
</blockquote>
<h4 id="2-配置分页插件">2. 配置分页插件</h4>
<p><a id="markdown-%E9%85%8D%E7%BD%AE%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6" name="%E9%85%8D%E7%BD%AE%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6"></a></p>
<p>在 MyBatis 的核心配置文件中配置插件</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;plugins&gt;</span>
<span class="c">&lt;!--设置分页插件--&gt;</span>
<span class="nt">&lt;plugin</span> <span class="na">interceptor=</span><span class="s">&#34;com.github.pagehelper.PageInterceptor&#34;</span><span class="nt">&gt;&lt;/plugin&gt;</span>
<span class="nt">&lt;/plugins&gt;</span>
</code></pre></div><h4 id="3-分页插件的使用">3. 分页插件的使用</h4>
<p><a id="markdown-%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8" name="%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8"></a></p>
<h5 id="在查询功能之前使用-pagehelperstartpageint-pagenum-int-pagesize开启分页功能">在查询功能之前使用 PageHelper.startPage(int pageNum, int pageSize)开启分页功能</h5>
<p><a id="markdown-%E5%9C%A8%E6%9F%A5%E8%AF%A2%E5%8A%9F%E8%83%BD%E4%B9%8B%E5%89%8D%E4%BD%BF%E7%94%A8-pagehelper.startpageint-pagenum%2C-int-pagesize%E5%BC%80%E5%90%AF%E5%88%86%E9%A1%B5%E5%8A%9F%E8%83%BD" name="%E5%9C%A8%E6%9F%A5%E8%AF%A2%E5%8A%9F%E8%83%BD%E4%B9%8B%E5%89%8D%E4%BD%BF%E7%94%A8-pagehelper.startpageint-pagenum%2C-int-pagesize%E5%BC%80%E5%90%AF%E5%88%86%E9%A1%B5%E5%8A%9F%E8%83%BD"></a></p>
<blockquote>
<p>pageNum：当前页的页码</p>
</blockquote>
<blockquote>
<p>pageSize：每页显示的条数</p>
</blockquote>
<h5 id="在查询获取-list-集合之后使用-pageinfot-pageinfo--new-pageinfolistt-list-int">在查询获取 list 集合之后，使用 PageInfo<T> pageInfo = new PageInfo&lt;&gt;(List<T> list, int</h5>
<p><a id="markdown-%E5%9C%A8%E6%9F%A5%E8%AF%A2%E8%8E%B7%E5%8F%96-list-%E9%9B%86%E5%90%88%E4%B9%8B%E5%90%8E%EF%BC%8C%E4%BD%BF%E7%94%A8-pageinfo%3Ct%3E-pageinfo-%3D-new-pageinfo%3C%3Elist%3Ct%3E-list%2C-int" name="%E5%9C%A8%E6%9F%A5%E8%AF%A2%E8%8E%B7%E5%8F%96-list-%E9%9B%86%E5%90%88%E4%B9%8B%E5%90%8E%EF%BC%8C%E4%BD%BF%E7%94%A8-pageinfo%3Ct%3E-pageinfo-%3D-new-pageinfo%3C%3Elist%3Ct%3E-list%2C-int"></a></p>
<p>navigatePages)获取分页相关数据</p>
<blockquote>
<p>list：分页之后的数据</p>
</blockquote>
<blockquote>
<p>navigatePages：导航分页的页码数</p>
</blockquote>
<h5 id="分页相关数据">分页相关数据</h5>
<p><a id="markdown-%E5%88%86%E9%A1%B5%E7%9B%B8%E5%85%B3%E6%95%B0%E6%8D%AE" name="%E5%88%86%E9%A1%B5%E7%9B%B8%E5%85%B3%E6%95%B0%E6%8D%AE"></a></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">PageInfo<span class="o">{</span>
<span class="nv">pageNum</span><span class="o">=</span>8, <span class="nv">pageSize</span><span class="o">=</span>4, <span class="nv">size</span><span class="o">=</span>2, <span class="nv">startRow</span><span class="o">=</span>29, <span class="nv">endRow</span><span class="o">=</span>30, <span class="nv">total</span><span class="o">=</span>30, <span class="nv">pages</span><span class="o">=</span>8,

<span class="nv">list</span><span class="o">=</span>Page<span class="o">{</span><span class="nv">count</span><span class="o">=</span>true, <span class="nv">pageNum</span><span class="o">=</span>8, <span class="nv">pageSize</span><span class="o">=</span>4, <span class="nv">startRow</span><span class="o">=</span>28, <span class="nv">endRow</span><span class="o">=</span>32, <span class="nv">total</span><span class="o">=</span>30,
<span class="nv">pages</span><span class="o">=</span>8, <span class="nv">reasonable</span><span class="o">=</span>false, <span class="nv">pageSizeZero</span><span class="o">=</span>false<span class="o">}</span>,

<span class="nv">prePage</span><span class="o">=</span>7, <span class="nv">nextPage</span><span class="o">=</span>0, <span class="nv">isFirstPage</span><span class="o">=</span>false, <span class="nv">isLastPage</span><span class="o">=</span>true, <span class="nv">hasPreviousPage</span><span class="o">=</span>true,
<span class="nv">hasNextPage</span><span class="o">=</span>false, <span class="nv">navigatePages</span><span class="o">=</span>5, navigateFirstPage4, navigateLastPage8,

<span class="nv">navigatepageNums</span><span class="o">=[</span>4, 5, 6, 7, 8<span class="o">]</span>
<span class="o">}</span>
</code></pre></div><p>常用数据：</p>
<blockquote>
<p>pageNum：当前页的页码</p>
</blockquote>
<blockquote>
<p>pageSize：每页显示的条数</p>
</blockquote>
<blockquote>
<p>size：当前页显示的真实条数</p>
</blockquote>
<blockquote>
<p>total：总记录数</p>
</blockquote>
<blockquote>
<p>pages：总页数</p>
</blockquote>
<blockquote>
<p>prePage：上一页的页码</p>
</blockquote>
<blockquote>
<p>nextPage：下一页的页码</p>
</blockquote>
<blockquote>
<p>isFirstPage/isLastPage：是否为第一页/最后一页</p>
</blockquote>
<blockquote>
<p>hasPreviousPage/hasNextPage：是否存在上一页/下一页</p>
</blockquote>
<blockquote>
<p>navigatePages：导航分页的页码数</p>
</blockquote>
<blockquote>
<p>navigatepageNums：导航分页的页码，[1,2,3,4,5]</p>
</blockquote>
<p>☕☕☕☕</p>
<hr>
<h4 id="ok-its-time-for-mybatis2hahahugoshortcode-s13-hbhb">Ok, It&rsquo;s time for <a href="https://rileyshen.github.io/post/mybatis2/" >mybatis2</a></h4>
<p><a id="markdown-ok%2C-it's-time-for-mybatis2" name="ok%2C-it's-time-for-mybatis2"></a></p></div>
    <div class="post-footer">
        <div class="info">
            
            <span class="separator"><a class="tag" href="/tags/mybatis/">MyBatis</a><a class="tag" href="/tags/crud/">CRUD</a><a class="tag" href="/tags/mapper/">mapper</a><a class="tag" href="/tags/service/">service</a></span>
        </div>
    </div>

    
</div>


        </div>
    </div>
</div>

<script type="text/javascript"
        src="/js/medium-zoom.min.83cb1dd5fea8d42d87d1e601a07faa73089ad0ef9ccfe5daf6041289ebcc4e46.js"
        integrity="sha256-g8sd1f6o1C2H0eYBoH&#43;qcwia0O&#43;cz&#43;Xa9gQSievMTkY="
        crossorigin="anonymous"></script>
<script async defer src="//latest.js"></script>
<noscript><img src="//noscript.gif" alt=""/></noscript>

</body>

</html>
